function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"+ooL":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i("XNiG"),a=i("fXoL"),s=function(){var t=function(){function t(){_classCallCheck(this,t),this.colorSource=new n.a,this.blobSource=new n.a,this.color$=this.colorSource.asObservable(),this.blob$=this.blobSource.asObservable()}return _createClass(t,[{key:"setColor",value:function(t){this.colorSource.next(t)}},{key:"setBlob",value:function(){this.blobSource.next(!0)}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=a.Gb({token:t,factory:t.\u0275fac}),t}()},"/1T7":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function t(e){_classCallCheck(this,t),this.tracks=[],this.discs=[],this.sortedDiscs=[],this.modified=0,this.isContinues=!0,e.album&&e.title&&(this.name=e.album,this.sortName=this.name.toUpperCase(),this.year=e.year,this.modified=e.modified,this.year&&-1!==this.year.indexOf("-")&&(this.year=this.year.split("-")[0]))}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.artist.letter.escapedLetter,"/artist/").concat(encodeURIComponent(this.artist.name),"/album/").concat(encodeURIComponent(this.name))}}]),t}()},0:function(t,e,i){t.exports=i("zUnb")},"1gFc":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("fXoL"),a=function(){var t=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"requestAnimation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"enter",e=arguments.length>1?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&(e.classList.contains(t)&&e.classList.remove(t),setTimeout((function(){e.classList.add(t)}),10),i&&setTimeout((function(){e.classList.remove(t)}),150))}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=n.Gb({token:t,factory:t.\u0275fac}),t}()},Gcu2:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n=i("XNiG"),a=i("LNEh"),s=i("ktVm"),r=i("t083"),o=i("KI15"),c=i("fXoL"),l=function(){var t=function(){function t(e,i){_classCallCheck(this,t),this.coreService=e,this.lastfmservice=i,this.playlistSubject=new n.a,this.playlistAnnounced$=this.playlistSubject.asObservable(),this.numberOfTracksInAPlaylist=100,this.username=localStorage.getItem("lastfm-username"),this.core=this.coreService.getCore()}return _createClass(t,[{key:"generateRandom",value:function(){var t=this,e=Object.keys(this.core.tracks),i=this.shuffle(e).splice(0,this.numberOfTracksInAPlaylist),n=new o.a;return n.name="".concat(this.numberOfTracksInAPlaylist," random tracks"),i.map((function(e){n.tracks.push(t.core.tracks[e])})),n}},{key:"generateRadio",value:function(){var t=this;this.lastfmservice.getTopArtists(this.username).subscribe((function(e){t.playlistSubject.next(t.extractArtists(e))}))}},{key:"extractTracks",value:function(t){var e=this,i=new o.a;return i.name="Loved tracks on Last.FM",t.map((function(t){var n=e.core.getTrackByArtistAndName(t.artist.name,t.name);n&&i.tracks.push(n)})),i}},{key:"extractArtists",value:function(t){var e=this,i=[],n=[];return t.forEach((function(t,s){t.dummy=!0;var r=new a.a(t),o=e.core.artists[r.sortName];o&&s<10?i.push(o):n.push(o)})),this.generateRadioList(i,n)}},{key:"generateRadioList",value:function(t,e){var i=new o.a;i.name="".concat(this.numberOfTracksInAPlaylist," random tracks based on your recently listened tracks");for(var n=0;n<this.numberOfTracksInAPlaylist;n++)i.tracks.push(this.getRandomTrackFromList(n%3==0||n%5==0?t:n%4==0||n%7==0?e:this.core.artistsList()));return i}},{key:"getRandomTrackFromList",value:function(t){var e=this.shuffle(t)[0];if(e){var i=this.shuffle(e.albums)[0],n=this.shuffle(i.tracks)[0];return n.duration<=6e5?n:this.getRandomTrackFromList(t)}return this.getRandomTrackFromList(t)}},{key:"shuffle",value:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t}},{key:"getNextTrackForPlaylist",value:function(t,e){var i=this.getRandomTrackFromList(t);if(i){var n=i.artist;return e.tracks.length>1&&e.tracks[e.tracks.length-1].artist===n&&t.length>1?this.getNextTrackForPlaylist(t,e):i}return null}}]),t}();return t.\u0275fac=function(e){return new(e||t)(c.Rb(s.a),c.Rb(r.a))},t.\u0275prov=c.Gb({token:t,factory:t.\u0275fac}),t}()},KI15:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function t(){_classCallCheck(this,t),this.tracks=[],this.isOwn=!1,this.isContinues=!1}},LNEh:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function t(e){_classCallCheck(this,t),this.albums=[],(e.album&&e.title||e.dummy)&&(this.name=e.name||e.artist||"",this.albumArtist=e.albumartist||e.albumArtist||"",this.sortName=this.stripFromName(this.albumArtist?this.albumArtist.toUpperCase():e.sortName?e.sortName.toUpperCase():this.name.toUpperCase(),["the ",'"',"a "]),this.bio=e.bio,this.isCollection=!!this.albumArtist&&this.name!==this.albumArtist)}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.letter.escapedLetter,"/artist/").concat(encodeURIComponent(this.albumArtist||this.name),"/")}},{key:"sortAlbumsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",i=new Intl.Collator("en");this.albums.sort((function(n,a){var s,r;if(-1!==t.indexOf(".")){var o=t.split(".");s=n[o[0]][o[1]],r=a[o[0]][o[1]]}else s="year"!==t?n[t].toUpperCase():n[t],r="year"!==t?a[t].toUpperCase():a[t];var c=i.compare(s,r);return"asc"===e?c:-1*c}))}},{key:"sortAndReturnAlbumsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return this.sortAlbumsBy(t,e),this.albums}},{key:"stripFromName",value:function(t,e){var i=t?t.toUpperCase():"";return i=i.trim(),e.forEach((function(t){var e=t.toUpperCase();0===i.indexOf(e)&&(i=i.substring(e.length))})),i}}]),t}()},MDLy:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("z6cu"),a=i("JIr8"),s=i("Kj3r"),r=i("fXoL"),o=i("tk/3"),c=function(){var t=function(){function t(e){_classCallCheck(this,t),this.http=e,this.collectionUrl="/data/node-music.json",this.reloadUrl="/rescan",this.pollUrl="/progress",this.dsm=localStorage.getItem("dsm")}return _createClass(t,[{key:"getCollection",value:function(){return this.dsm=localStorage.getItem("dsm"),this.http.get(this.dsm+this.collectionUrl).pipe(Object(a.a)(this.handleError))}},{key:"reload",value:function(){var t=this.dsm+this.reloadUrl,e=localStorage.getItem("jwt");return this.http.get("".concat(t,"?_ts=").concat((new Date).getTime(),"&jwt=").concat(e)).pipe(Object(a.a)(this.handleError))}},{key:"poll",value:function(){var t=this.dsm+this.pollUrl,e=localStorage.getItem("jwt");return this.http.get("".concat(t,"?_ts=").concat((new Date).getTime(),"&jwt=").concat(e)).pipe(Object(s.a)(300),Object(a.a)(this.handleError))}},{key:"handleError",value:function(t){var e=t.message?t.message:t.status?"".concat(t.status," - ").concat(t.statusText):"Server error";return Object(n.a)(e)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(r.Rb(o.a))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t}()},OgP6:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("XNiG"),a=i("z6cu"),s=i("JIr8"),r=i("fXoL"),o=i("tk/3"),c=function(){var t=function(){function t(e){_classCallCheck(this,t),this.http=e,this.geoSource=new n.a,this.themeSource=new n.a,this.modeSource=new n.a,this.theme$=this.themeSource.asObservable(),this.mode$=this.modeSource.asObservable(),this.geo$=this.geoSource.asObservable(),this._theme=localStorage.getItem("theme")||"light",this._mode="light",this.counter=0,this.COUNTERTIMER=6e4}return _createClass(t,[{key:"getSunriseInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:51,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return this.http.get("https://api.sunrise-sunset.org/json?lat=".concat(t,"&lng=").concat(e,"&formatted=0")).pipe(Object(s.a)(this.handleError))}},{key:"applyTheme",value:function(){var t=this;"auto"===this._theme?(this.counter||(this.counter=setInterval((function(){t.checkTheme()}),this.COUNTERTIMER)),this.checkTheme(!0)):this.setStyleSheet(this._theme)}},{key:"checkTheme",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=new Date;e<this.stopDate&&e>this.startDate&&"dark"!==this._mode?(this._mode="dark",this.setStyleSheet(this._mode)):(e>this.stopDate||e<this.startDate)&&"light"!==this._mode&&(this._mode="light",this.setStyleSheet(this._mode)),t&&this.setStyleSheet(this._mode)}},{key:"handleError",value:function(t){return Object(a.a)(null)}},{key:"setStyleSheet",value:function(t){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","prod"!==window.ENV&&window.ENV?"/dist/sass/".concat(t,".css"):"global/css/".concat(t,".css")),e.setAttribute("id","customStylesheet");var i=document.getElementById("customStylesheet");i&&document.getElementsByTagName("head")[0].removeChild(i),document.getElementsByTagName("head")[0].appendChild(e),localStorage.setItem("theme",this._theme),localStorage.setItem("style",t),this.themeSource.next(this._theme),this.modeSource.next(t)}},{key:"theme",get:function(){return this._theme},set:function(t){var e=this;this._theme!==t&&(this._theme=t),"auto"!==this._theme||this.counter?"auto"===this._theme||(this.setStyleSheet(this._theme),clearInterval(this.counter),this.counter=0,this._mode=this._theme):(this.counter=setInterval((function(){e.checkTheme()}),this.COUNTERTIMER),this.checkTheme())}},{key:"mode",get:function(){return this._mode}}]),t}();return t.\u0275fac=function(e){return new(e||t)(r.Rb(o.a))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t}()},XNvx:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i("z6cu"),a=i("tk/3"),s=i("JIr8"),r=i("fXoL"),o=function(){var t=function(){function t(e){_classCallCheck(this,t),this.http=e,this.hasToken=!1,localStorage.getItem("jwt")&&(this.hasToken=!0)}return _createClass(t,[{key:"doLogin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t;if(!e)throw new Error("You should log in via the webcrypto flow; contact me");var n={headers:new a.c({"X-Cred":i})};return this.http.post("".concat(localStorage.getItem("dsm"),"/login"),null,n).pipe(Object(s.a)(this.handleError))}},{key:"autoLogin",value:function(){var t=localStorage.getItem("jwt");return t?this.doLogin(t,!0):(localStorage.removeItem("jwt"),Object(n.a)(null))}},{key:"versionCheck",value:function(t){return this.http.get("".concat(t,"/version"))}},{key:"getPublicKey",value:function(t){return this.http.get("".concat(t,"/public-key"))}},{key:"authenticate",value:function(t,e){return this.http.post("".concat(t,"/authenticate"),{encryptedPayload:this.arrayBufferToBase64(e)})}},{key:"handleError",value:function(t){return Object(n.a)(null)}},{key:"arrayBufferToBase64",value:function(t){return btoa(new Uint8Array(t).reduce((function(t,e){return t+String.fromCharCode(e)}),""))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(r.Rb(a.a))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t}()},XtVx:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i("XNiG"),a=i("fXoL"),s=function(){var t=function(){function t(){_classCallCheck(this,t),this.pathAnnouncementSource=new n.a,this.pageAnnouncementSource=new n.a,this.pathAnnounced$=this.pathAnnouncementSource.asObservable(),this.pageAnnounced$=this.pageAnnouncementSource.asObservable()}return _createClass(t,[{key:"announcePath",value:function(t){this.pathAnnouncementSource.next(t)}},{key:"announcePage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pageAnnouncementSource.next({page:t,letter:e})}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=a.Gb({token:t,factory:t.\u0275fac}),t}()},crnd:function(t,e){function i(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id="crnd"},hDf6:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i("ofXK"),a=i("fXoL"),s=function(){var t=function t(){_classCallCheck(this,t)};return t.\u0275mod=a.Ib({type:t}),t.\u0275inj=a.Hb({factory:function(e){return new(e||t)},imports:[[n.b]]}),t}()},ktVm:function(t,e,i){"use strict";var n=i("XNiG"),a=i("/1T7"),s=i("LNEh"),r=i("o8Y7"),o=function(){function t(e){_classCallCheck(this,t),this.artists=[],this.active=!1,e.album&&e.title&&(this.letter=e.letter||this.getFirstLetterOf(e.albumArtist||e.albumartist||e.artist),"1"===this.letter&&(this.letter="#"),this.escapedLetter=encodeURIComponent(this.letter))}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.escapedLetter,"/")}},{key:"sortArtistsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sortName",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";if("albums"===t)this.artists.sort((function(t,i){return t.albums.length>i.albums.length?"asc"===e?-1:1:t.albums.length<i.albums.length?"asc"===e?1:-1:0}));else{var i=new Intl.Collator("en");this.artists.sort((function(n,a){var s,r;if(-1!==t.indexOf(".")){var o=t.split(".");s=n[o[0]][o[1]],r=a[o[0]][o[1]]}else s=n[t].toUpperCase(),r=a[t].toUpperCase();var c=i.compare(s,r);return"asc"===e?c:-1*c}))}}},{key:"sortAndReturnArtistsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return this.sortArtistsBy(t,e),this.artists}},{key:"getFirstLetterOf",value:function(t){var e="";return e=this.stripFromName(t,["the ",'"',"a "]),this.groupIfSpecialChar(e.substr(0,1))}},{key:"stripFromName",value:function(t,e){var i=t?t.toUpperCase():"";return i=i.trim(),e.forEach((function(t){var e=t.toUpperCase();0===i.indexOf(e)&&(i=i.substring(e.length))})),Object(r.a)(i)}},{key:"groupIfSpecialChar",value:function(t){return-1!==["1","2","3","4","5","6","7","8","9","0","(",")","[","]","{","}","_","-","."].indexOf(t)?"#":t}}]),t}(),c=i("/+cc"),l=i.n(c),u=function t(){var e=this;_classCallCheck(this,t),this.doSearch=function(t){var i=t.query,n=t.keys,a=void 0===n?["name"]:n,s=t.list;return new l.a(s,e.options(a)).search(i)},this.options=function(t){return{keys:t,threshold:.25,shouldSort:!0}}},h=i("uwnU"),d=function t(e){_classCallCheck(this,t),this.albums=[],this.sanitize=function(t){var e=parseInt(t,10);return isNaN(e)&&(e=0),e},e.year&&(this.year=this.sanitize(e.year))},b=function(){function t(){_classCallCheck(this,t),this.artists={},this.albums={},this.tracks={},this.letters={},this.years={},this.sortedLetters=[],this.sortedAlbums=[],this.isCoreParsed=!1,this.coreParsedSource=new n.a,this.coreParsed$=this.coreParsedSource.asObservable(),this.totals={artists:0,albums:0,tracks:0,playingTime:0,parsingTime:0},this.latestAdditions=[],this.search=new u,console.info("Core init 1.6.0")}return _createClass(t,[{key:"resetCollection",value:function(){this.artists={},this.albums={},this.tracks={},this.letters={},this.years={},this.sortedLetters=[],this.sortedAlbums=[],this.totals={artists:0,albums:0,tracks:0,playingTime:0,parsingTime:0},this.latestAdditions=[]}},{key:"parseSourceJson",value:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(new Date).getTime();if(t.length){var a=!0,s=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){var l=o.value;this.parseLine(l,i)}}catch(d){s=!0,r=d}finally{try{a||null==c.return||c.return()}finally{if(s)throw r}}}else t.tree&&this.parseTree(t.tree);var u=Object.keys(this.letters).sort((function(t,e){return t<e?-1:1})),h=[];u.forEach((function(t,i){h.push(e.letters[t]),e.letters[t].sortAndReturnArtistsBy("name","asc")})),this.sortedLetters=h,this.totals.parsingTime+=(new Date).getTime()-n,this.coreParsedSource.next(!0),this.isCoreParsed=!0}},{key:"getTrackByArtistAndName",value:function(t,e){var i=new s.a({name:t,dummy:!0}),n=this.artists[i.sortName],a=null;return n&&n.albums.some((function(t){t.tracks.some((function(t){if(t.title&&t.title.toLowerCase()===e.toLowerCase())return a||(a=t),!0}))})),a}},{key:"getTrackById",value:function(t){var e=new h.a({});return this.tracks.forEach((function(i){i.id===t&&(e=i)})),e}},{key:"getArtistByName",value:function(t){var e=new s.a({name:t,dummy:!0});return this.artists[e.sortName]}},{key:"getAlbumByArtistAndName",value:function(t,e){var i=null;return t.albums.forEach((function(t){t.name.toLowerCase()===e.toLowerCase()&&(i=t)})),i}},{key:"getTrackByAlbumAndName",value:function(t,e){var i=null;return t.tracks.forEach((function(t){t.title.toLowerCase()===e.toLowerCase()&&(i=t)})),i}},{key:"artistsList",value:function(){var t=this,e=[];return Object.keys(this.artists).sort((function(t,e){return t<e?-1:1})).forEach((function(i,n){e.push(t.artists[i])})),e}},{key:"trackList",value:function(){var t=this,e=[];return Object.keys(this.tracks).sort((function(t,e){return t<e?-1:1})).forEach((function(i,n){e.push(t.tracks[i])})),e}},{key:"searchArtist",value:function(t){return this.search.doSearch({query:t,list:this.artistsList()})}},{key:"searchAlbum",value:function(t){return this.search.doSearch({query:t,list:this.sortedAlbums})}},{key:"searchTrack",value:function(t){return this.search.doSearch({query:t,keys:["title"],list:this.trackList()})}},{key:"getLatestAdditions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:14;return 0!==this.latestAdditions.length?this.latestAdditions:(this.sortedAlbums.sort((function(t,e){return t.modified>e.modified?-1:t.modified<e.modified?1:0})),this.latestAdditions=this.sortedAlbums.splice(0,t),this.latestAdditions)}},{key:"getNextAlbum",value:function(t){var e=t.artist,i=e.albums.indexOf(t),n=e.albums[i+1];return n||(n=this.getNextArtist(e).albums[0]),n}},{key:"getNextArtist",value:function(t){var e=t.letter,i=e.artists.indexOf(t),n=e.artists[i+1];return n||(n=this.getNextLetter(e).artists[0]),n}},{key:"getNextLetter",value:function(t){var e=this.sortedLetters.indexOf(t),i=this.sortedLetters[e+1];return i||(i=this.sortedLetters[0]),i}},{key:"instanceIfPresent",value:function(t,e,i,n,a){var s=null;return i[e]?s=i[e]:(i[e]=n,s=n,a(t)),s}},{key:"handleLetter",value:function(t){return this.instanceIfPresent(this,t.letter,this.letters,t,(function(t){}))}},{key:"handleArtist",value:function(t,e){return this.instanceIfPresent(this,e.sortName,this.artists,e,(function(i){t.artists.push(e),e.letter=t,i.totals.artists++}))}},{key:"handleAlbum",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.instanceIfPresent(this,t.sortName+"|"+e.sortName,this.albums,e,(function(n){if("flac"===e.type&&i||"flac"!==e.type)if(e.artist=t,t.albums.push(e),t.sortAndReturnAlbumsBy("year","asc"),n.sortedAlbums.push(e),n.totals.albums++,n.years[e.year])n.years[e.year].albums.push(e);else{var a=new d(e);a.albums.push(e),n.years[a.year]=a}}))}},{key:"handleTrack",value:function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.instanceIfPresent(this,i.id,this.tracks,i,(function(a){if(e.type=e.type&&e.type!==i.type?"mixed":i.type,"flac"===i.type&&n||"flac"!==i.type){a.totals.tracks++,a.totals.playingTime+=i.duration,i.artist=t,i.album=e,e.tracks.push(i);var s=i.disc;e.discs["disc-".concat(s)]?e.discs["disc-".concat(s)].push(i):(e.discs["disc-".concat(s)]=[],e.discs["disc-".concat(s)].push(i)),e.discs["disc-".concat(s)].sort((function(t,e){return t.number<e.number?-1:1})),e.tracks.sort((function(t,e){return t.disc<e.disc?-1:t.disc===e.disc&&t.number<e.number?-1:1}))}else console.warn("skipping flac track, flac is not supported")}))}},{key:"parseLine",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new o(t);i.letter&&(i=this.handleLetter(i));var n=new s.a(t);n.name&&(n=this.handleArtist(i,n));var r=new a.a(t);r.name&&(r=this.handleAlbum(n,r,e));var c=new h.a(t);c.title&&(c=this.handleTrack(n,r,c,e))}},{key:"parseTree",value:function(t){for(var e in t){var i=new o(t[e]);for(var n in i=this.handleLetter(i),t[e].artists){var r=new s.a(t[e].artists[n]);for(var c in r=this.handleArtist(i,r),t[e].artists[n].albums){var l=new a.a(t[e].artists[n].albums[c]);for(var u in l=this.handleAlbum(r,l),t[e].artists[n].albums[c].tracks){var d=new h.a(t[e].artists[n].albums[c].tracks[u]);d=this.handleTrack(r,l,d)}}}}}}]),t}(),f=i("fXoL");i.d(e,"a",(function(){return g}));var m,g=((m=function(){function t(){_classCallCheck(this,t),this.core=new b}return _createClass(t,[{key:"getCore",value:function(){return this.core}}]),t}()).\u0275fac=function(t){return new(t||m)},m.\u0275prov=f.Gb({token:m,factory:m.\u0275fac}),m)},t083:function(t,e,i){"use strict";var n=i("XNiG"),a=i("z6cu"),s=i("JIr8"),r=i("tk/3"),o=i("ztCj"),c=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"encodeKey",value:function(t){return encodeURIComponent(t)}},{key:"encodeValue",value:function(t){return encodeURIComponent(t)}},{key:"decodeKey",value:function(t){return decodeURIComponent(t)}},{key:"decodeValue",value:function(t){return decodeURIComponent(t)}}]),t}(),l=i("fXoL");i.d(e,"a",(function(){return b}));var u,h="956c1818ded606576d6941de5ff793a5",d="4d183e73f7578dee78557665e9be3acc",b=((u=function(){function t(e){_classCallCheck(this,t),this.http=e,this.manualScrobbleListSource=new n.a,this.manualScrobbleList$=this.manualScrobbleListSource.asObservable(),this.hexcase=0,this.b64pad=""}return _createClass(t,[{key:"getLovedTracks",value:function(t){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{api_key:h,format:"json",limit:"1000",method:"user.getlovedtracks",user:t}}).pipe(Object(s.a)(this.handleError))}},{key:"toggleLoved",value:function(t){var e=localStorage.getItem("lastfm-token"),i=(new URLSearchParams,t.isLoved?"track.love":"track.unlove"),n=new r.d({encoder:new c}).set("method",i).set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,null,e,i)).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("sk",e),a=new r.c({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:n,headers:a}).pipe(Object(s.a)(this.handleError))}},{key:"getTrackInfo",value:function(t,e){if(t){var i=new r.d({encoder:new c}).set("method","track.getInfo").set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("api_key",h).set("format","json").set("user",e);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:i}).pipe(Object(s.a)(this.handleError))}return Object(a.a)(null)}},{key:"getTopArtists",value:function(t){var e=new r.d({encoder:new c}).set("api_key",h).set("format","json").set("limit","50").set("method","user.gettopartists").set("period","1month").set("user",t);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:e}).pipe(Object(s.a)(this.handleError))}},{key:"getSimilairArtists",value:function(t){var e=new r.d({encoder:new c}).set("api_key",h).set("format","json").set("limit","20").set("autocorrect","1").set("method","artist.getSimilar").set("artist",t.name);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:e}).pipe(Object(s.a)(this.handleError))}},{key:"authenticate",value:function(t){var e=new r.d({encoder:new c}).set("api_key",h).set("api_sig",this.signAuthentication(t.user,t.password)).set("format","json").set("username",t.user).set("password",t.password),i=new r.c({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post("https://ws.audioscrobbler.com/2.0/?method=auth.getMobileSession",null,{params:e,headers:i}).pipe(Object(s.a)(this.handleError))}},{key:"announceNowPlaying",value:function(t){if("mdb-skipped"!==localStorage.getItem("lastfm-username")){var e=new Date,i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()+e.getTimezoneOffset(),e.getSeconds())/1e3,n=localStorage.getItem("lastfm-token"),a=new r.c({"Content-Type":"application/x-www-form-urlencoded"}),o=new r.d({encoder:new c}).set("method","track.updateNowPlaying").set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,i,n,"track.updateNowPlaying")).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("timestamp",i.toString()).set("sk",n);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:o,headers:a}).pipe(Object(s.a)(this.handleError))}}},{key:"scrobbleTrack",value:function(t){var e=this,i=localStorage.getItem("lastfm-username"),n=new Date,a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+n.getTimezoneOffset(),n.getSeconds())/1e3;if("mdb-skipped"!==i){var l=localStorage.getItem("lastfm-token");if(!this.booleanState("manual-scrobble-state")){var u=new r.c({"Content-Type":"application/x-www-form-urlencoded"}),d=new r.d({encoder:new c}).set("method","track.scrobble").set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,a,l,"track.scrobble")).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("timestamp",a.toString()).set("sk",l);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:d,headers:u}).pipe(Object(s.a)(this.handleError))}Object(o.c)("manual-scrobble-list").then((function(i){var n=i||[],s={artist:t.trackArtist,album:t.album.name,track:t.title,timestamp:a.toString()};n.unshift(s),Object(o.d)("manual-scrobble-list",n),e.manualScrobbleListSource.next(n)}))}else{var b="art-".concat(t.trackArtist,"-").concat(t.album.name);Object(o.c)(b).then((function(i){e.saveInLocal(t,a,i||"global/images/no-cover.png")}))}}},{key:"updateManualScrobbleList",value:function(){var t=this;Object(o.c)("manual-scrobble-list").then((function(e){t.manualScrobbleListSource.next(e||[])}))}},{key:"saveInLocal",value:function(t,e,i){var n={artist:{"#text":t.trackArtist},album:{"#text":t.album.name},image:[{"#text":i}],name:t.title,date:{uts:e}},a=[];Object(o.c)("recentlyListened").then((function(t){t&&((a=t.tracks).length>10&&(a=a.splice(0,10)),t._rev),a.unshift(n);var e={_id:"recentlyListened",tracks:a};Object(o.d)(e._id,e.tracks)}))}},{key:"scrobbleCachedTrack",value:function(t){var e=localStorage.getItem("lastfm-token"),i=new r.c({"Content-Type":"application/x-www-form-urlencoded"}),n=new r.d({encoder:new c}).set("method","track.scrobble").set("api_key",h).set("api_sig",this.signTrack(t.artist,t.album,t.track,t.timestamp,e,"track.scrobble")).set("artist",t.artist).set("album",t.album).set("track",t.track).set("timestamp",t.timestamp.toString()).set("sk",e);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:n,headers:i,responseType:"text"}).pipe(Object(s.a)(this.handleError))}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}},{key:"signAuthentication",value:function(t,e){return this.hex_md5("api_key".concat(h,"methodauth.getMobileSessionpassword").concat(e,"username").concat(t).concat(d))}},{key:"signTrack",value:function(t,e,i,n,a,s){return this.hex_md5(n?"album".concat(e,"api_key").concat(h,"artist").concat(t,"method").concat(s,"sk").concat(a,"timestamp").concat(n,"track").concat(i).concat(d):"album".concat(e,"api_key").concat(h,"artist").concat(t,"method").concat(s,"sk").concat(a,"track").concat(i).concat(d))}},{key:"handleError",value:function(t){return Object(a.a)(null)}},{key:"hex_md5",value:function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))}},{key:"rstr2hex",value:function(t){try{this.hexcase=this.hexcase}catch(s){this.hexcase=0}for(var e,i=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",a=0;a<t.length;a++)e=t.charCodeAt(a),n+=i.charAt(e>>>4&15)+i.charAt(15&e);return n}},{key:"rstr_md5",value:function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))}},{key:"str2rstr_utf8",value:function(t){for(var e,i,n="",a=-1;++a<t.length;)e=t.charCodeAt(a),i=a+1<t.length?t.charCodeAt(a+1):0,55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e=65536+((1023&e)<<10)+(1023&i),a++),e<=127?n+=String.fromCharCode(e):e<=2047?n+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n}},{key:"binl2rstr",value:function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e}},{key:"binl_md5",value:function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,n=-271733879,a=-1732584194,s=271733878,r=0;r<t.length;r+=16){var o=i,c=n,l=a,u=s;i=this.md5_ff(i,n,a,s,t[r+0],7,-680876936),s=this.md5_ff(s,i,n,a,t[r+1],12,-389564586),a=this.md5_ff(a,s,i,n,t[r+2],17,606105819),n=this.md5_ff(n,a,s,i,t[r+3],22,-1044525330),i=this.md5_ff(i,n,a,s,t[r+4],7,-176418897),s=this.md5_ff(s,i,n,a,t[r+5],12,1200080426),a=this.md5_ff(a,s,i,n,t[r+6],17,-1473231341),n=this.md5_ff(n,a,s,i,t[r+7],22,-45705983),i=this.md5_ff(i,n,a,s,t[r+8],7,1770035416),s=this.md5_ff(s,i,n,a,t[r+9],12,-1958414417),a=this.md5_ff(a,s,i,n,t[r+10],17,-42063),n=this.md5_ff(n,a,s,i,t[r+11],22,-1990404162),i=this.md5_ff(i,n,a,s,t[r+12],7,1804603682),s=this.md5_ff(s,i,n,a,t[r+13],12,-40341101),a=this.md5_ff(a,s,i,n,t[r+14],17,-1502002290),n=this.md5_ff(n,a,s,i,t[r+15],22,1236535329),i=this.md5_gg(i,n,a,s,t[r+1],5,-165796510),s=this.md5_gg(s,i,n,a,t[r+6],9,-1069501632),a=this.md5_gg(a,s,i,n,t[r+11],14,643717713),n=this.md5_gg(n,a,s,i,t[r+0],20,-373897302),i=this.md5_gg(i,n,a,s,t[r+5],5,-701558691),s=this.md5_gg(s,i,n,a,t[r+10],9,38016083),a=this.md5_gg(a,s,i,n,t[r+15],14,-660478335),n=this.md5_gg(n,a,s,i,t[r+4],20,-405537848),i=this.md5_gg(i,n,a,s,t[r+9],5,568446438),s=this.md5_gg(s,i,n,a,t[r+14],9,-1019803690),a=this.md5_gg(a,s,i,n,t[r+3],14,-187363961),n=this.md5_gg(n,a,s,i,t[r+8],20,1163531501),i=this.md5_gg(i,n,a,s,t[r+13],5,-1444681467),s=this.md5_gg(s,i,n,a,t[r+2],9,-51403784),a=this.md5_gg(a,s,i,n,t[r+7],14,1735328473),n=this.md5_gg(n,a,s,i,t[r+12],20,-1926607734),i=this.md5_hh(i,n,a,s,t[r+5],4,-378558),s=this.md5_hh(s,i,n,a,t[r+8],11,-2022574463),a=this.md5_hh(a,s,i,n,t[r+11],16,1839030562),n=this.md5_hh(n,a,s,i,t[r+14],23,-35309556),i=this.md5_hh(i,n,a,s,t[r+1],4,-1530992060),s=this.md5_hh(s,i,n,a,t[r+4],11,1272893353),a=this.md5_hh(a,s,i,n,t[r+7],16,-155497632),n=this.md5_hh(n,a,s,i,t[r+10],23,-1094730640),i=this.md5_hh(i,n,a,s,t[r+13],4,681279174),s=this.md5_hh(s,i,n,a,t[r+0],11,-358537222),a=this.md5_hh(a,s,i,n,t[r+3],16,-722521979),n=this.md5_hh(n,a,s,i,t[r+6],23,76029189),i=this.md5_hh(i,n,a,s,t[r+9],4,-640364487),s=this.md5_hh(s,i,n,a,t[r+12],11,-421815835),a=this.md5_hh(a,s,i,n,t[r+15],16,530742520),n=this.md5_hh(n,a,s,i,t[r+2],23,-995338651),i=this.md5_ii(i,n,a,s,t[r+0],6,-198630844),s=this.md5_ii(s,i,n,a,t[r+7],10,1126891415),a=this.md5_ii(a,s,i,n,t[r+14],15,-1416354905),n=this.md5_ii(n,a,s,i,t[r+5],21,-57434055),i=this.md5_ii(i,n,a,s,t[r+12],6,1700485571),s=this.md5_ii(s,i,n,a,t[r+3],10,-1894986606),a=this.md5_ii(a,s,i,n,t[r+10],15,-1051523),n=this.md5_ii(n,a,s,i,t[r+1],21,-2054922799),i=this.md5_ii(i,n,a,s,t[r+8],6,1873313359),s=this.md5_ii(s,i,n,a,t[r+15],10,-30611744),a=this.md5_ii(a,s,i,n,t[r+6],15,-1560198380),n=this.md5_ii(n,a,s,i,t[r+13],21,1309151649),i=this.md5_ii(i,n,a,s,t[r+4],6,-145523070),s=this.md5_ii(s,i,n,a,t[r+11],10,-1120210379),a=this.md5_ii(a,s,i,n,t[r+2],15,718787259),n=this.md5_ii(n,a,s,i,t[r+9],21,-343485551),i=this.safe_add(i,o),n=this.safe_add(n,c),a=this.safe_add(a,l),s=this.safe_add(s,u)}return Array(i,n,a,s)}},{key:"rstr2binl",value:function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e}},{key:"md5_cmn",value:function(t,e,i,n,a,s){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(n,s)),a),i)}},{key:"md5_ff",value:function(t,e,i,n,a,s,r){return this.md5_cmn(e&i|~e&n,t,e,a,s,r)}},{key:"md5_gg",value:function(t,e,i,n,a,s,r){return this.md5_cmn(e&n|i&~n,t,e,a,s,r)}},{key:"md5_hh",value:function(t,e,i,n,a,s,r){return this.md5_cmn(e^i^n,t,e,a,s,r)}},{key:"md5_ii",value:function(t,e,i,n,a,s,r){return this.md5_cmn(i^(e|~n),t,e,a,s,r)}},{key:"safe_add",value:function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}},{key:"bit_rol",value:function(t,e){return t<<e|t>>>32-e}}]),t}()).\u0275fac=function(t){return new(t||u)(l.Rb(r.a))},u.\u0275prov=l.Gb({token:u,factory:u.\u0275fac}),u)},ufXC:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i("ztCj"),a=i("XNiG"),s=i("KI15"),r=i("Gcu2"),o=i("ktVm"),c=i("t083"),l=i("fXoL"),u=function(){var t=function(){function t(e,i,n){var s=this;_classCallCheck(this,t),this.lastFMService=e,this.coreService=i,this.playlistService=n,this.playlistSource=new a.a,this.volumeSource=new a.a,this.hideVolumeWindowAsSource=new a.a,this.playlistAnnounced$=this.playlistSource.asObservable(),this.volumeAnnounced=this.volumeSource.asObservable(),this.hideVolumeWindowAnnounced$=this.hideVolumeWindowAsSource.asObservable(),this.isPlaying=!1,this.isPaused=!1,this.isShuffled=!1,this.forceRestart=!1,this.volume=100,this.lastfmUserName=localStorage.getItem("lastfm-username"),this.subscription=this.playlistService.playlistAnnounced$.subscribe((function(t){s.doPlayPlaylist(t,0,!0,s.isShuffled)}))}return _createClass(t,[{key:"setPosition",value:function(t){this.position=t,this.announce(),this.position=null}},{key:"doPlayAlbum",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.setPlaylist(t,e,i,n,"album"),this.announce()}},{key:"doQueueAlbum",value:function(t){var e=this.currentPlaylist,i=e.playlist,n=e.startIndex,a=new s.a;a.name="queued playlist",a.type="queue",a.tracks=[].concat(_toConsumableArray(i.tracks),_toConsumableArray(t.tracks)),this.setPlaylist(a,n,!1,!1,"playlist")}},{key:"doPlayPlaylist",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.setPlaylist(t,e,i,n,"playlist"),this.announce()}},{key:"doPlayTrack",value:function(t){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1);var e=new s.a;e.isOwn=!0,e.name=t.title,e.tracks.push(t),this.currentPlaylist={playlist:e,startIndex:0,isPlaying:this.isPlaying=!0,isPaused:this.isPaused=!1,isShuffled:!1,forceRestart:this.forceRestart=!0,isContinues:!1},this.announce()}},{key:"nextPlaylist",value:function(t){if(this.booleanState("continues-play"))if("random"===t){var e=this.playlistService.generateRandom();this.doPlayPlaylist(e,0,!0,this.isShuffled)}else this.playlistService.generateRadio();else this.stop()}},{key:"nextAlbum",value:function(t){if(this.booleanState("continues-play")){var e=this.coreService.getCore().getNextAlbum(t);e?this.doPlayAlbum(e,0,!0,this.isShuffled):(console.warn("no new album found, stopping playback"),this.stop())}else this.stop()}},{key:"playlistToString",value:function(){var t=[];return this.currentPlaylist.playlist.tracks.forEach((function(e){e&&t.push(e.id)})),JSON.stringify({ids:t,isShuffled:this.isShuffled,isContinues:this.currentPlaylist.isContinues,current:this.currentPlaylist.startIndex,type:this.currentPlaylist.type})}},{key:"playlistSync",value:function(){var t=[];return this.currentPlaylist.playlist.tracks.forEach((function(e){e&&t.push(e.id)})),{ids:t,isShuffled:this.isShuffled,isContinues:this.currentPlaylist.isContinues,current:this.currentPlaylist.startIndex,type:this.currentPlaylist.type}}},{key:"getCurrentPlaylist",value:function(){return this.currentPlaylist}},{key:"shufflePlaylist",value:function(t){this.isShuffled=t,this.currentPlaylist.playlist.tracks.sort(this.sortPlaylist),t&&(this.currentPlaylist.playlist.tracks=this.shuffle(this.currentPlaylist.playlist.tracks)),this.currentPlaylist.startIndex=this.currentPlaylist.playlist.tracks.indexOf(this.currentTrack),this.currentPlaylist.forceRestart=!1,this.announce()}},{key:"sortPlaylist",value:function(t,e){return t.disc<e.disc?-1:t.disc>e.disc?1:t.number<e.number?-1:t.number>e.number?1:0}},{key:"shuffle",value:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t}},{key:"next",value:function(){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.currentPlaylist&&(this.currentPlaylist.startIndex++,this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"prev",value:function(){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.currentPlaylist&&(this.currentPlaylist.startIndex--,this.currentPlaylist.startIndex<=0&&(this.currentPlaylist.startIndex=0),this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"pause",value:function(){this.currentPlaylist&&(this.isPlaying=!1,this.isPaused=!0,this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"resume",value:function(){this.currentPlaylist&&(this.isPlaying=!0,this.isPaused=!1,this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"stop",value:function(){this.isPlaying=!1,this.isPaused=!1,this.currentPlaylist=null,Object(n.b)("current-playlist"),localStorage.removeItem("current-time"),this.playlistSource.next(this.currentPlaylist)}},{key:"togglePlayPause",value:function(){this.isPlaying?this.pause():this.resume()}},{key:"announce",value:function(){var t=this;this.currentPlaylist&&(this.currentTrack=this.currentPlaylist.playlist.tracks[this.currentPlaylist.startIndex],this.lastfmUserName&&this.lastFMService.getTrackInfo(this.currentTrack,this.lastfmUserName).subscribe((function(e){t.currentTrack&&e.track&&(t.currentTrack.isLoved="1"===e.track.userloved)})),this.currentTrack&&(this.currentTrack.isPaused=this.isPaused,this.currentTrack.isPlaying=this.isPlaying,this.currentPlaylist.isPlaying=this.isPlaying,this.currentPlaylist.isPaused=this.isPaused,this.currentPlaylist.isShuffled=this.isShuffled,this.currentPlaylist.position=this.position,Object(n.d)("current-playlist",this.playlistSync()),this.playlistSource.next(this.currentPlaylist)))}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(t){this.volume=t,this.volumeSource.next(this.volume)}},{key:"hideVolumeControl",value:function(){this.hideVolumeWindowAsSource.next(!0)}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}},{key:"setPlaylist",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"album";this.currentPlaylist={playlist:t,startIndex:e,isPlaying:this.isPlaying=!0,isPaused:this.isPaused=!1,isShuffled:this.isShuffled=n,forceRestart:this.forceRestart=i,isContinues:t.isContinues||"album"===a,type:t.type}}}]),t}();return t.\u0275fac=function(e){return new(e||t)(l.Rb(c.a),l.Rb(o.a),l.Rb(r.a))},t.\u0275prov=l.Gb({token:t,factory:t.\u0275fac}),t}()},uwnU:function(t,e,i){"use strict";var n=function t(e){_classCallCheck(this,t),this.url=e.file||e.url||e.path||e.id};i.d(e,"a",(function(){return a}));var a=function(){function t(e){_classCallCheck(this,t),this.isPlaying=!1,this.isPaused=!1,this.isLoved=!1,this.position=0,this.buffered={start:0,end:0},this.showActions=!1,this.image="",e.album&&e.title&&(this.id=e.id,this.duration=e.seconds?1e3*e.seconds:e.duration&&!isNaN(e.duration)?e.duration:0,this.title=e.title,this.source=new n(e),this.disc=e.disc||this.guessBySource(e),this.number=e.number,this.trackArtist=e.artist,this.type=e.type||"mp3")}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.artist.letter.escapedLetter,"/artist/").concat(encodeURIComponent(this.artist.name),"/album/").concat(encodeURIComponent(this.album.name),"/track/").concat(encodeURIComponent(this.title))}},{key:"toJSON",value:function(){return this.id}},{key:"guessBySource",value:function(t){for(var e=this.source.url,i=0,n=[1,2,3,4,5,6,7,8,9,10];i<n.length;i++){var a=n[i];if(-1!==e.indexOf(" - ".concat(a,"."))||-1!==e.indexOf("(".concat(a,") - "))||-1!==e.indexOf("CD".concat(a))||-1!==e.indexOf("\\".concat(a,"-")))return a}return 1}}]),t}()},zUnb:function(t,e,i){"use strict";i.r(e);var n=i("fXoL"),a=i("tk/3"),s=i("3Pt+"),r=i("jhN1"),o=i("Mfq2"),c=i("XNvx"),l=i("ufXC"),u=i("Gcu2"),h=i("1gFc"),d=i("MDLy"),b=i("+ooL"),f=i("OgP6"),m=i("ktVm"),g=i("t083"),p=i("XtVx"),v=i("ofXK"),y=i("ztCj"),k=function t(){_classCallCheck(this,t)},S=i("tyNb");function C(t,e){if(1&t){var i=n.Ob();n.Nb(0,"span"),n.Nb(1,"span",57),n.Vb("click",(function(){n.oc(i);var t=n.Zb();return t.selectArtist(t.path)})),n.sc(2),n.Mb(),n.sc(3," \u2022 "),n.Nb(4,"span"),n.sc(5),n.Mb(),n.Mb()}if(2&t){var a=n.Zb();n.zb(2),n.tc(a.path.artist.albumArtist||a.path.artist.name),n.zb(3),n.tc(a.path.album.name)}}function w(t,e){if(1&t&&(n.Nb(0,"span"),n.sc(1),n.Mb()),2&t){var i=n.Zb();n.zb(1),n.tc(i.path.artist.albumArtist||i.path.artist.name)}}function A(t,e){1&t&&(n.Nb(0,"span"),n.sc(1,"JSMusicDB Next"),n.Mb())}function L(t,e){if(1&t&&(n.Nb(0,"span"),n.sc(1),n.Mb()),2&t){var i=n.Zb();n.zb(1),n.tc(i.page)}}function P(t,e){1&t&&(n.Nb(0,"span"),n.sc(1,"JSMusicDB Next"),n.Mb())}function M(t,e){1&t&&n.Lb(0,"i",25)}function x(t,e){1&t&&n.Lb(0,"i",58)}var _=function(t){return{active:t}};function N(t,e){if(1&t&&(n.Nb(0,"li",26),n.Nb(1,"a",59),n.Lb(2,"span",60),n.sc(3),n.Mb(),n.Mb()),2&t){var i=n.Zb();n.fc("ngClass",n.ic(2,_,"Scrobble cache"===i.page)),n.zb(3),n.uc(" Scrobble cache (",i.manualScrobblingList.length,")")}}function T(t,e){if(1&t&&(n.Nb(0,"li",46),n.Nb(1,"a",61),n.Lb(2,"span",60),n.Mb(),n.Mb()),2&t){var i=n.Zb();n.fc("ngClass",n.ic(2,_,"Scrobble cache"===i.page)),n.zb(1),n.hc("tooltip","Scrobble cache (",i.manualScrobblingList.length,")")}}var I=function(t){return{visible:t}},O=function(t){return{"side-nav--visible":t}};function E(){return Object.assign(new o.a,{placement:"right",delay:250})}var j,R=((j=function(){function t(e,i,n,a){var s=this;_classCallCheck(this,t),this.pathService=e,this.router=i,this.lastFMService=n,this.coreService=a,this.menuVisible=!1,this.topSearchVisible=!1,this.manualScrobblingList=[],this.onDocumentClick=function(t){t.target.classList.contains("side-nav--visible")&&s.toggleMenu()},this.core=this.coreService.getCore(),this.subscription=e.pathAnnounced$.subscribe((function(t){s.path=t,s.page=null,s.menuVisible=!1,s.disableActiveLetter(),s.activateLetter(t.letter)})),this.subscription2=e.pageAnnounced$.subscribe((function(t){s.page=t.page,s.path=null,s.menuVisible=!1,s.disableActiveLetter(),s.activateLetter(t.letter)})),this.subscription3=this.lastFMService.manualScrobbleList$.subscribe((function(t){s.manualScrobblingList=t})),this.subscription4=this.core.coreParsed$.subscribe((function(t){s.ngOnInit()})),this.search=new k,Object(y.c)("manual-scrobble-list").then((function(t){s.manualScrobblingList=t||[]}))}return _createClass(t,[{key:"ngOnInit",value:function(){this.letters=this.core.sortedLetters}},{key:"disableActiveLetter",value:function(){this.letters.forEach((function(t){t.active&&(t.active=!1)}))}},{key:"activateLetter",value:function(t){t&&(t.active=!0)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe(),this.subscription2.unsubscribe()}},{key:"toggleMenu",value:function(){this.menuVisible=!this.menuVisible,this.menuVisible?this.slideOut():this.slideIn()}},{key:"slideOut",value:function(){var t=document.querySelector(".js-side-nav");t.classList.add("side-nav--animatable"),t.classList.add("side-nav--visible"),document.addEventListener("click",this.onDocumentClick),t.addEventListener("transitionend",this.onTransitionEnd)}},{key:"slideIn",value:function(){var t=document.querySelector(".js-side-nav");t.classList.add("side-nav--animatable"),t.classList.remove("side-nav--visible"),document.removeEventListener("click",this.onDocumentClick),t.addEventListener("transitionend",this.onTransitionEnd)}},{key:"onTransitionEnd",value:function(t){var e=document.querySelector(".js-side-nav");e.classList.remove("side-nav--animatable"),e.removeEventListener("transitionend",this.onTransitionEnd)}},{key:"onSubmit",value:function(){this.topSearchVisible=!1,this.menuVisible&&this.toggleMenu(),this.router.navigate(["/search",this.search.query])}},{key:"toggleSearch",value:function(){this.topSearchVisible=!this.topSearchVisible,!0===this.topSearchVisible&&setTimeout((function(){document.getElementById("mobileSearch").focus()}),100)}},{key:"selectArtist",value:function(t){this.router.navigate(["letter",t.artist.letter.escapedLetter,"artist",t.artist.sortName])}},{key:"selectAlbum",value:function(t){this.router.navigate(["letter",t.album.artist.letter.escapedLetter,"artist",t.album.artist.sortName,"album",t.album.sortName])}}]),t}()).\u0275fac=function(t){return new(t||j)(n.Kb(p.a),n.Kb(S.c),n.Kb(g.a),n.Kb(m.a))},j.\u0275cmp=n.Eb({type:j,selectors:[["mdb-topmenu"]],features:[n.yb([{provide:o.a,useFactory:E}])],decls:94,vars:65,consts:[[1,"menu-top","fixed-top"],[1,"menu-toggle",3,"click"],["aria-label","menu button",1,"btn","btn-menu","d-md-none"],["aria-hidden","true",1,"glyph","glyph-hamburger"],[1,"d-none","d-md-inline-block"],["version","1.1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","width","276.164px","height","276.164px","viewBox","0 0 276.164 276.164",0,"xml","space","preserve",1,"logo"],["d","M156.716,61.478c-4.111,6.276-8.881,11.511-14.212,15.609l-8.728,6.962c-13.339,11.855-22.937,21.433-28.542,28.464\n                  c-10.209,12.788-15.806,25.779-16.65,38.611c-0.942,14.473,3.187,28.21,12.275,40.84c9.636,13.458,21.8,20.754,36.164,21.69\n                  c3.291,0.218,6.897,0.182,9.896-0.015l-1.121-10.104c-2.09,0.192-4.306,0.223-6.628,0.068c-9.437-0.617-17.864-4.511-25.064-11.573\n                  c-7.524-7.333-10.895-15.415-10.287-24.7c1.149-17.59,12.562-35.004,33.925-51.792l9.543-7.599\n                  c8.394-7.174,15.192-16.191,20.216-26.825c4.971-10.556,7.886-21.983,8.673-33.96c0.466-7.037-0.513-15.775-2.874-25.965\n                  c-3.241-13.839-7.854-20.765-14.136-21.179c-2.232-0.138-4.676,0.986-7.658,3.617c-7.252,6.548-12.523,14.481-15.683,23.542\n                  c-2.438,6.926-4.057,16.189-4.805,27.529c-0.313,4.72,0.313,13.438,1.805,23.962l8.844-8.192c-0.028-1.183,0.005-2.413,0.096-3.703\n                  c0.466-7.221,2.289-15.062,5.394-23.293c3.956-10.296,7.689-13.409,10.133-14.204c0.668-0.218,1.32-0.298,2.015-0.254\n                  c3.185,0.212,6.358,1.559,5.815,9.979C164.664,46.132,161.831,53.693,156.716,61.478z"],["d","M164.55,209.161c5.728-2.568,10.621-6.478,14.576-11.651c5.055-6.561,7.897-14.316,8.467-23.047\n                  c0.72-10.719-1.854-20.438-7.617-28.895c-6.322-9.264-14.98-14.317-25.745-15.026c-1.232-0.081-2.543-0.075-3.895,0.025\n                  l-2.304-17.191l-9.668,7.112l1.483,12.194c-5.789,2.393-10.827,6.17-15.017,11.255c-4.823,5.924-7.508,12.443-7.964,19.382\n                  c-0.466,7.208,1.142,13.81,4.782,19.583c1.895,3.081,4.507,5.82,7.498,8.058c4.906,3.65,10.563,3.376,11.459,1.393\n                  c0.906-1.983-2.455-5.095-5.09-9.248c-1.502-2.351-2.242-5.173-2.242-8.497c0-7.053,4.256-13.116,10.317-15.799l5.673,44.211\n                  l1.325,10.258c0.864,4.873,1.719,9.725,2.537,14.52c1,6.488,1.352,12.112,1.041,16.715c-0.419,6.375-2.408,11.584-5.919,15.493\n                  c-2.234,2.485-4.844,4.055-7.795,4.925c3.961-3.962,6.414-9.43,6.414-15.478c0-12.075-9.792-21.872-21.87-21.872\n                  c-3.353,0-6.491,0.812-9.329,2.159c-0.36,0.155-0.699,0.388-1.054,0.574c-0.779,0.425-1.559,0.85-2.286,1.362\n                  c-0.249,0.187-0.487,0.403-0.732,0.605c-4.888,3.816-8.091,9.616-8.375,16.229c0,0.01-0.011,0.021-0.011,0.031\n                  c0,0.005,0,0.01,0,0.016c-0.013,0.311-0.09,0.59-0.09,0.896c0,0.259,0.067,0.492,0.078,0.74\n                  c-0.011,7.084,2.933,13.179,8.839,18.118c5.584,4.666,12.277,7.28,19.892,7.777c4.327,0.28,8.505-0.217,12.407-1.485\n                  c3.189-1.041,6.275-2.62,9.149-4.687c6.96-5.022,10.75-11.584,11.272-19.532c0.399-6.063,0.094-13.235-0.937-21.411l-2.838-18.429\n                  l-7.156-52.899c7.984,1.532,14.027,8.543,14.027,16.968c0,5.986-1.937,15.431-5.551,20.376L164.55,209.161z"],[4,"ngIf"],["aria-label","search button",1,"btn","btn-menu","btn-search","d-md-none",3,"click"],["class","glyph glyph-magnifier",4,"ngIf"],["class","glyph glyph-clear",4,"ngIf"],["role","form",3,"ngClass","ngSubmit"],["searchForm","ngForm"],["type","text","id","mobileSearch","placeholder","Search for","name","search",1,"form-control",3,"ngModel","ngModelChange"],["name","ngModel"],[1,"js-side-nav","side-nav",3,"ngClass"],[1,"js-side-nav-container","side-nav__container"],[1,"side-nav__content","nav","flex-column"],[1,"d-none","d-md-block","search-bar"],[1,"form-group"],[1,"input-group"],["role","form",3,"ngSubmit"],["type","text","id","search","placeholder","Search for","name","search",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-addon"],[1,"glyph","glyph-magnifier"],[3,"ngClass"],["routerLink","/home"],[1,"glyph","glyph-home"],[1,"d-sm-none",3,"ngClass"],["routerLink","/letters"],[1,"glyph","glyph-characters"],["routerLink","/artists"],[1,"glyph","glyph-people"],["routerLink","/albums"],[1,"glyph","glyph-music-album"],["routerLink","/years"],[1,"glyph","glyph-calendar"],["routerLink","/playlists"],[1,"glyph","glyph-music-info"],["routerLink","/now-playing"],[1,"glyph","glyph-audio"],[3,"ngClass",4,"ngIf"],["routerLink","/settings"],[1,"glyph","glyph-settings"],[1,"d-none","d-lg-block","side-nav-xl"],[1,"nav-item",3,"ngClass"],["routerLink","/home","tooltip","Home","triggers","hover"],[1,"d-md-none","nav-item",3,"ngClass"],["routerLink","/letters","tooltip","Letters","triggers","hover"],["routerLink","/artists","tooltip","Artists","triggers","hover"],["routerLink","/albums","tooltip","Albums","triggers","hover"],["routerLink","/years","tooltip","Years","triggers","hover"],["routerLink","/playlists","tooltip","Playlists","triggers","hover"],["routerLink","/now-playing","tooltip","Now Playing","triggers","hover"],["class","nav-item",3,"ngClass",4,"ngIf"],["routerLink","/settings","tooltip","Settings","triggers","hover"],[1,"clickable","d-none","d-sm-inline",3,"click"],[1,"glyph","glyph-clear"],["routerLink","/scrobble-cache"],[1,"glyph","glyph-upload"],["routerLink","/scrobble-cache","triggers","hover",3,"tooltip"]],template:function(t,e){1&t&&(n.Nb(0,"div",0),n.Nb(1,"span",1),n.Vb("click",(function(){return e.toggleMenu()})),n.Nb(2,"button",2),n.Lb(3,"span",3),n.Mb(),n.Nb(4,"a",4),n.Yb(),n.Nb(5,"svg",5),n.Nb(6,"g"),n.Lb(7,"path",6),n.Lb(8,"path",7),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Xb(),n.Nb(9,"h1"),n.rc(10,C,6,2,"span",8),n.rc(11,w,2,1,"span",8),n.rc(12,A,2,0,"span",8),n.rc(13,L,2,1,"span",8),n.rc(14,P,2,0,"span",8),n.Mb(),n.Nb(15,"button",9),n.Vb("click",(function(){return e.toggleSearch()})),n.rc(16,M,1,0,"i",10),n.rc(17,x,1,0,"i",11),n.Mb(),n.Nb(18,"form",12,13),n.Vb("ngSubmit",(function(){return e.onSubmit()})),n.Nb(20,"input",14,15),n.Vb("ngModelChange",(function(t){return e.search.query=t})),n.Mb(),n.Mb(),n.Mb(),n.Nb(22,"aside",16),n.Nb(23,"nav",17),n.Nb(24,"ul",18),n.Nb(25,"li",19),n.Nb(26,"div",20),n.Nb(27,"div",21),n.Nb(28,"form",22,13),n.Vb("ngSubmit",(function(){return e.onSubmit()})),n.Nb(30,"input",23,15),n.Vb("ngModelChange",(function(t){return e.search.query=t})),n.Mb(),n.Nb(32,"button",24),n.Lb(33,"i",25),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Nb(34,"li",26),n.Nb(35,"a",27),n.Lb(36,"span",28),n.sc(37," Home"),n.Mb(),n.Mb(),n.Nb(38,"li",29),n.Nb(39,"a",30),n.Lb(40,"span",31),n.sc(41," Letters"),n.Mb(),n.Mb(),n.Nb(42,"li",26),n.Nb(43,"a",32),n.Lb(44,"span",33),n.sc(45," Artists"),n.Mb(),n.Mb(),n.Nb(46,"li",26),n.Nb(47,"a",34),n.Lb(48,"span",35),n.sc(49," Albums"),n.Mb(),n.Mb(),n.Nb(50,"li",26),n.Nb(51,"a",36),n.Lb(52,"span",37),n.sc(53," Years"),n.Mb(),n.Mb(),n.Nb(54,"li",26),n.Nb(55,"a",38),n.Lb(56,"span",39),n.sc(57," Playlists"),n.Mb(),n.Mb(),n.Nb(58,"li",26),n.Nb(59,"a",40),n.Lb(60,"span",41),n.sc(61," Now playing"),n.Mb(),n.Mb(),n.rc(62,N,4,4,"li",42),n.Nb(63,"li",26),n.Nb(64,"a",43),n.Lb(65,"span",44),n.sc(66," Settings"),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Nb(67,"aside",45),n.Nb(68,"ul",18),n.Nb(69,"li",46),n.Nb(70,"a",47),n.Lb(71,"span",28),n.Mb(),n.Mb(),n.Nb(72,"li",48),n.Nb(73,"a",49),n.Lb(74,"span",31),n.Mb(),n.Mb(),n.Nb(75,"li",46),n.Nb(76,"a",50),n.Lb(77,"span",33),n.Mb(),n.Mb(),n.Nb(78,"li",46),n.Nb(79,"a",51),n.Lb(80,"span",35),n.Mb(),n.Mb(),n.Nb(81,"li",46),n.Nb(82,"a",52),n.Lb(83,"span",37),n.Mb(),n.Mb(),n.Nb(84,"li",46),n.Nb(85,"a",53),n.Lb(86,"span",39),n.Mb(),n.Mb(),n.Nb(87,"li",46),n.Nb(88,"a",54),n.Lb(89,"span",41),n.Mb(),n.Mb(),n.rc(90,T,3,4,"li",55),n.Nb(91,"li",46),n.Nb(92,"a",56),n.Lb(93,"span",44),n.Mb(),n.Mb(),n.Mb(),n.Mb()),2&t&&(n.zb(10),n.fc("ngIf",e.path&&e.path.album),n.zb(1),n.fc("ngIf",e.path&&e.path.artist&&!e.path.album),n.zb(1),n.fc("ngIf",e.path&&!e.path.artist),n.zb(1),n.fc("ngIf",!e.path&&e.page),n.zb(1),n.fc("ngIf",!e.path&&!e.page),n.zb(2),n.fc("ngIf",!e.topSearchVisible),n.zb(1),n.fc("ngIf",e.topSearchVisible),n.zb(1),n.fc("ngClass",n.ic(29,I,e.topSearchVisible)),n.zb(2),n.fc("ngModel",e.search.query),n.zb(2),n.fc("ngClass",n.ic(31,O,e.menuVisible)),n.zb(8),n.fc("ngModel",e.search.query),n.zb(4),n.fc("ngClass",n.ic(33,_,"Home"===e.page)),n.zb(4),n.fc("ngClass",n.ic(35,_,"Letters"===e.page)),n.zb(4),n.fc("ngClass",n.ic(37,_,"Artists"===e.page)),n.zb(4),n.fc("ngClass",n.ic(39,_,"Albums"===e.page)),n.zb(4),n.fc("ngClass",n.ic(41,_,"Years"===e.page)),n.zb(4),n.fc("ngClass",n.ic(43,_,"Playlists"===e.page)),n.zb(4),n.fc("ngClass",n.ic(45,_,"Now playing"===e.page)),n.zb(4),n.fc("ngIf",e.manualScrobblingList.length>0),n.zb(1),n.fc("ngClass",n.ic(47,_,"Settings"===e.page)),n.zb(6),n.fc("ngClass",n.ic(49,_,"Home"===e.page)),n.zb(3),n.fc("ngClass",n.ic(51,_,"Letters"===e.page)),n.zb(3),n.fc("ngClass",n.ic(53,_,"Artists"===e.page)),n.zb(3),n.fc("ngClass",n.ic(55,_,"Albums"===e.page)),n.zb(3),n.fc("ngClass",n.ic(57,_,"Years"===e.page)),n.zb(3),n.fc("ngClass",n.ic(59,_,"Playlists"===e.page)),n.zb(3),n.fc("ngClass",n.ic(61,_,"Now playing"===e.page)),n.zb(3),n.fc("ngIf",e.manualScrobblingList.length>0),n.zb(1),n.fc("ngClass",n.ic(63,_,"Settings"===e.page)))},directives:[v.k,s.m,s.d,s.e,v.i,s.a,s.c,s.f,S.d,o.b],encapsulation:2}),j),D=function(t){return{active:t}};function V(t,e){if(1&t){var i=n.Ob();n.Nb(0,"li",2),n.Nb(1,"a",3),n.Vb("click",(function(){n.oc(i);var t=e.$implicit;return n.Zb().onSelect(t)})),n.sc(2),n.Mb(),n.Mb()}if(2&t){var a=e.$implicit;n.zb(1),n.fc("ngClass",n.ic(2,D,a.active)),n.zb(1),n.tc(a.letter)}}var z,B=((z=function(){function t(e,i){var n=this;_classCallCheck(this,t),this.coreService=e,this.router=i,this.activeLetter=null,this.core=this.coreService.getCore(),this.subscription=this.core.coreParsed$.subscribe((function(t){n.ngOnInit()}))}return _createClass(t,[{key:"ngOnInit",value:function(){this.letters=this.core.sortedLetters}},{key:"onSelect",value:function(t){this.activeLetter&&(this.activeLetter.active=!1),this.activeLetter=t,this.router.navigate(["/letter",t.escapedLetter])}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}}]),t}()).\u0275fac=function(t){return new(t||z)(n.Kb(m.a),n.Kb(S.c))},z.\u0275cmp=n.Eb({type:z,selectors:[["mdb-letters"]],decls:2,vars:1,consts:[[1,"nav","d-none","d-md-flex","nav-letters"],["class","nav-item align-self-stretch flex-grow-1 text-center",4,"ngFor","ngForOf"],[1,"nav-item","align-self-stretch","flex-grow-1","text-center"],[3,"ngClass","click"]],template:function(t,e){1&t&&(n.Nb(0,"ul",0),n.rc(1,V,3,4,"li",1),n.Mb()),2&t&&(n.zb(1),n.fc("ngForOf",e.letters))},directives:[v.j,v.i],encapsulation:2}),z);i("hR/0");var U=i("KI15"),F=i("meIv"),q=i("Pbcf"),W=function(t){return t.r=Math.floor(t.r),t.g=Math.floor(t.g),t.b=Math.floor(t.b),t.a=1,t},X=function t(e,i){return F.a.isReadable(e,i)?W(new F.a(e).toRgb()):t("#000"===i?new F.a(e).lighten(3):new F.a(e).darken(3),i)},K=function(t){return F.a.readability("#000",t)>F.a.readability("#fff",t)?"#000":"#fff"};function H(t,e,i){if(window.runningInElectron&&!i)document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbuntaint",{detail:{url:t}}));else{var n=new Image;n.crossOrigin="Anonymous",n.addEventListener("load",(function(t){var i=document.createElement("canvas"),a=i.getContext("2d");i.width=n.width,i.height=n.height,a.drawImage(n,0,0);var s=(new q.a).getColor(i).value;e(W({r:s[0],g:s[1],b:s[2]}))}),!1),n.src=t}}function Z(t,e){var i=X(t,e),n=X(t,e);return{rgba:t,textLight:i,textDark:n,lighten:W(new F.a(i).lighten().toRgb()),darken:W(new F.a(n).darken().toRgb()),lighten30:W(new F.a(i).lighten(30).toRgb()),darken30:W(new F.a(n).darken(30).toRgb()),letterColor:K(new F.a(t))}}function $(t){var e=document.createElement("style"),i=t.rgba,n=t.darken,a=t.lighten,s=t.textLight,r=t.textDark,o=t.letterColor,c=t.darken30,l=t.lighten30;e.setAttribute("type","text/css"),e.id="custom-css-node",e.textContent='\n      @charset "UTF-8";\n      :root {\n        --primary: rgba('.concat(i.r,", ").concat(i.g,", ").concat(i.b,", 1);\n        --darken: rgba(").concat(n.r,", ").concat(n.g,", ").concat(n.b,", 1);\n        --lighten: rgba(").concat(a.r,", ").concat(a.g,", ").concat(a.b,", 1);\n        --darken30: rgba(").concat(c.r,", ").concat(c.g,", ").concat(c.b,", 1);\n        --lighten30: rgba(").concat(l.r,", ").concat(l.g,", ").concat(l.b,", 1);\n        --text-light: rgba(").concat(s.r,", ").concat(s.g,", ").concat(s.b,", 1);\n        --text-dark: rgba(").concat(r.r,", ").concat(r.g,", ").concat(r.b,", 1);\n        --letter-color: ").concat(o,";\n      }"),G(),document.querySelector("body").appendChild(e)}function G(){document.querySelector("#custom-css-node")&&document.querySelector("#custom-css-node").remove()}function J(t,e){1&t&&n.Lb(0,"i",26)}function Y(t,e){1&t&&n.Lb(0,"i",27)}var Q=function(t){return{width:t}},tt=function(t,e){return{"glyph-volume":t,"glyph-mute":e}},et=function(t){return{active:t}};function it(t,e){if(1&t){var i=n.Ob();n.Nb(0,"div",1),n.Nb(1,"div",2),n.Nb(2,"div",3),n.Vb("click",(function(t){return n.oc(i),n.Zb().jump(t)})),n.Lb(3,"div",4),n.Mb(),n.Mb(),n.Nb(4,"div",5),n.Nb(5,"div",6),n.Nb(6,"div",7),n.Vb("click",(function(){return n.oc(i),n.Zb().navigateToNowPlaying()})),n.Nb(7,"album-art",8),n.Vb("art",(function(t){return n.oc(i),n.Zb().onChangeArt(t)})),n.Mb(),n.Mb(),n.Nb(8,"div",9),n.Nb(9,"h4"),n.sc(10),n.Mb(),n.Nb(11,"h5"),n.Nb(12,"a",10),n.Vb("click",(function(){return n.oc(i),n.Zb().navigateToArtist()})),n.sc(13),n.Mb(),n.Nb(14,"span",11),n.sc(15," \u2022 "),n.Nb(16,"a",10),n.Vb("click",(function(){return n.oc(i),n.Zb().navigateToAlbum()})),n.sc(17),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Nb(18,"div",12),n.Nb(19,"a",13),n.Vb("click",(function(){return n.oc(i),n.Zb().prev()})),n.Lb(20,"span",14),n.Mb(),n.Nb(21,"a",13),n.Vb("click",(function(){return n.oc(i),n.Zb().togglePlayPause()})),n.rc(22,J,1,0,"i",15),n.rc(23,Y,1,0,"i",16),n.Mb(),n.Nb(24,"a",13),n.Vb("click",(function(){return n.oc(i),n.Zb().next()})),n.Lb(25,"span",17),n.Mb(),n.Nb(26,"a",18),n.Vb("click",(function(t){return n.oc(i),n.Zb().toggleVolumeWindow(t)})),n.Lb(27,"span",19),n.Mb(),n.Nb(28,"a",20),n.Vb("click",(function(){return n.oc(i),n.Zb().toggleLoved()})),n.Lb(29,"i",21),n.Mb(),n.Nb(30,"a",22),n.Vb("click",(function(){return n.oc(i),n.Zb().toggleShuffle()})),n.Lb(31,"i",23),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Nb(32,"div",24),n.Nb(33,"input",25),n.Vb("ngModelChange",(function(t){return n.oc(i),n.Zb().volume=t}))("input",(function(){return n.oc(i),n.Zb().setVolume()}))("change",(function(){return n.oc(i),n.Zb().setVolume()})),n.Mb(),n.Mb(),n.Mb()}if(2&t){var a=n.Zb();n.zb(3),n.fc("ngStyle",n.ic(13,Q,a.track.position/a.track.duration*100+"%")),n.zb(4),n.fc("artist",a.track.trackArtist)("album",a.track.album.name),n.zb(3),n.tc(a.track.title),n.zb(3),n.tc(a.track.trackArtist),n.zb(4),n.tc(a.track.album.name),n.zb(5),n.fc("ngIf",a.isPlaying),n.zb(1),n.fc("ngIf",a.isPaused),n.zb(4),n.fc("ngClass",n.jc(15,tt,a.volume>0,0==a.volume)),n.zb(1),n.fc("ngClass",n.ic(18,et,a.track.isLoved)),n.zb(2),n.fc("ngClass",n.ic(20,et,a.isShuffled)),n.zb(2),n.fc("hidden",!a.showVolumeWindow),n.zb(1),n.fc("ngModel",a.volume)}}var nt,at=((nt=function(){function t(e,i,n,a,s,r,o,c){var l=this;_classCallCheck(this,t),this.pathService=e,this.playerService=i,this.router=n,this.lastFMService=a,this.coreService=s,this.animationService=r,this.colorService=o,this.configService=c,this.showPlayer=!1,this.usesDynamicAccentColor=this.booleanState("dynamic-accent-color"),this.isPlaying=!1,this.isPaused=!1,this.hasScrobbledCurrentTrack=!1,this.isCurrentPlaylistLoaded=!1,this.isShuffled=!1,this.forceRestart=!1,this.showVolumeWindow=!1,this.volume=100,this.isHostedApp="undefined"!=typeof Windows,this.analyserID=-1,this.canShowAnimation=!1,this.bgColor="#fff",this.subscription=this.playerService.playlistAnnounced$.subscribe((function(t){t?(l.playlist=t.playlist,l.trackIndex=t.startIndex,l.isPaused=t.isPaused,l.isPlaying=t.isPlaying,l.isShuffled=t.isShuffled,l.forceRestart=t.forceRestart,l.showPlayer=l.isPaused||l.isPlaying,l.setTrack(t.position)):(l.isPlaying=!1,l.showPlayer=!1,l.mediaObject.pause())})),this.subscription5=this.playerService.hideVolumeWindowAnnounced$.subscribe((function(){l.showVolumeWindow=!1})),this.mediaObject=document.querySelector("audio"),this.mediaObject.crossOrigin="anonymous",this.mediaObject.canPlayType("audio/flac"),this.mediaObject.addEventListener("ended",(function(){l.next()})),this.mediaObject.addEventListener("timeupdate",(function(){l.updateTime()})),this.mediaObject.addEventListener("play",(function(){l.onplay()})),this.mediaObject.addEventListener("progress",(function(){l.onprogress()})),this.mediaObject.addEventListener("pause",(function(){l.onpause()})),this.mediaObject.addEventListener("ended",(function(){l.onstop()}));var u=localStorage.getItem("dsm");if(u&&(this.url=u),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe((function(t){var e=localStorage.getItem("save-playlist-state");e&&"true"===e&&l.readCurrentPlaylist()})),this.subscription3=this.playerService.volumeAnnounced.subscribe((function(t){l.volume=t,l.mediaObject.volume=l.volume/100})),this.subscription4=e.pageAnnounced$.subscribe((function(t){"Now playing"===t.page?(l.showVolumeWindow=!1,l.canShowAnimation=l.booleanState("visualisation-state"),l.canShowAnimation&&(l.analyserID=window.requestAnimationFrame(l.draw.bind(l)))):l.canShowAnimation=!1})),this.isHostedApp&&(this.systemMediaControls=Windows.Media.SystemMediaTransportControls.getForCurrentView(),this.displayUpdater=this.systemMediaControls.displayUpdater,this.systemMediaControls.isEnabled=!0,this.systemMediaControls.isPlayEnabled=!0,this.systemMediaControls.isPauseEnabled=!0,this.systemMediaControls.isStopEnabled=!0,this.systemMediaControls.isNextEnabled=!0,this.systemMediaControls.isPreviousEnabled=!0,this.systemMediaControls.addEventListener("buttonpressed",(function(t){var e=Windows.Media.SystemMediaTransportControlsButton;switch(t.button){case e.play:l.mediaObject.play();break;case e.pause:l.mediaObject.pause();break;case e.stop:l.playerService.stop();break;case e.next:l.next();break;case e.previous:l.prev();break;default:console.warn("key not mapped in application",t.button)}}),!1),this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.closed),-1===navigator.userAgent.indexOf("Mobi")){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser();var h=this.audioCtx.createMediaElementSource(this.mediaObject),d=this.audioCtx.sampleRate;this.analyser.fftSize=this.calculateFft(d),this.hearableBars=this.getHearableBars(d,this.analyser.fftSize),h.connect(this.analyser),h.connect(this.audioCtx.destination),this.dataArray=new Uint8Array(this.hearableBars),this.analyser.getByteFrequencyData(this.dataArray)}this.subscription6=this.colorService.color$.subscribe((function(t){l.rgba=t})),this.subscription7=this.colorService.blob$.subscribe((function(){var t=new Blob([window.externalBlob],{type:"image/png"}),e=URL.createObjectURL(t),i=new Image;i.src=e,H(i.src,(function(t){var e=Z(t,l.bgColor);l.colorService.setColor(e.rgba),e.rgba=e.textLight,$(e)}),!0)})),this.subscription8=this.configService.mode$.subscribe((function(t){if(l.bgColor="light"===t?"#fff":"#000",l.usesDynamicAccentColor&&l.rgba){var e=Z(l.rgba,l.bgColor);e.rgba=e.textLight,$(e)}}))}return _createClass(t,[{key:"draw",value:function(){var t=this;setTimeout((function(){t.analyserID=window.requestAnimationFrame(t.draw.bind(t)),t.canShowAnimation||window.cancelAnimationFrame(t.analyserID)}),1e3/30);var e=document.querySelector("canvas"),i=e.offsetWidth,n=e.offsetHeight;if(i&&n){var a=e.getContext("2d");this.analyser.getByteFrequencyData(this.dataArray),e.width=i,e.height=n,a.clearRect(0,0,i,n);for(var s,r=this.rgba||{r:0,g:110,b:205,a:1},o=Math.floor(i/this.hearableBars*1.1),c=0,l=n/150*1.17,u=0;u<this.hearableBars;u++)s=this.dataArray[u]*l,a.fillStyle="rgba(".concat(r.r,",").concat(r.g,",").concat(r.b,",").concat(this.dataArray[u]/255,")"),a.fillRect(c,n-s/2,o,s/2),c+=o+1}}},{key:"calculateFft",value:function(t){return 128*Math.floor(t/44100)}},{key:"getHearableBars",value:function(t,e){var i=e/2;switch(t){case 48e3:return i-1;case 88200:return i/2;case 96e3:return i/2-2;case 176400:return i/4;case 192e3:return i/4-4;case 352800:return i/8;case 384e3:return i/8-8;case 705600:return i/16;case 768e3:return i/16-16;default:return i}}},{key:"setTrack",value:function(t){if(this.track=this.playlist.tracks[this.trackIndex],!this.currentTrack||this.track&&this.currentTrack.id!==this.track.id||this.forceRestart){var e=localStorage.getItem("dsm");e&&(this.url=e);var i=localStorage.getItem("jwt");this.mediaObject.src="".concat(this.url,"/listen?path=").concat(encodeURIComponent(this.track.source.url),"&jwt=").concat(i),this.currentTrack=this.track,this.hasScrobbledCurrentTrack=!1,this.animationService.requestAnimation("enter",document.querySelector(".player h4")),this.animationService.requestAnimation("enter",document.querySelector(".player h5"))}this.isPlaying?this.mediaObject.play():this.mediaObject.pause(),this.isCurrentPlaylistLoaded&&(this.mediaObject.currentTime=localStorage.getItem("current-time")||0,this.isCurrentPlaylistLoaded=!1),t&&(this.mediaObject.currentTime=t)}},{key:"readCurrentPlaylist",value:function(){var t=this;Object(y.c)("current-playlist").then((function(e){var i=e;if(i){var n=t.coreService.getCore(),a=[];i.ids.forEach((function(t){a.push(n.tracks[t])}));var s=new U.a;s.tracks=a,s.name="Current Playlist",s.isContinues=i.isContinues||!1,s.type=i.type,t.isShuffled=i.isShuffled,t.isCurrentPlaylistLoaded=!0,t.playerService.doPlayPlaylist(s,i.current,!1,i.isShuffled)}}))}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe(),this.subscription2.unsubscribe(),this.subscription3.unsubscribe(),this.subscription4.unsubscribe(),this.subscription5.unsubscribe(),this.subscription6.unsubscribe(),this.subscription7.unsubscribe(),this.subscription8.unsubscribe(),this.mediaObject.removeEventListener("ended"),this.mediaObject.removeEventListener("timeupdate"),this.mediaObject.removeEventListener("play"),this.showVolumeWindow=!1}},{key:"navigateToArtist",value:function(){this.router.navigate(["/letter",this.track.album.artist.letter.escapedLetter,"artist",this.track.album.artist.sortName])}},{key:"navigateToAlbum",value:function(){this.router.navigate(["/letter",this.track.album.artist.letter.escapedLetter,"artist",this.track.album.artist.sortName,"album",this.track.album.sortName])}},{key:"navigateToNowPlaying",value:function(){this.router.navigate(["/now-playing"])}},{key:"next",value:function(){this.trackIndex<this.playlist.tracks.length-1?(this.trackIndex++,this.playerService.next()):this.playlist.isContinues?(this.trackIndex=0,"random"===this.playlist.type||"radio"===this.playlist.type?this.playerService.nextPlaylist(this.playlist.type):this.playerService.nextAlbum(this.track.album)):this.playerService.stop()}},{key:"prev",value:function(){this.trackIndex>0&&(this.trackIndex--,this.playerService.prev())}},{key:"togglePlayPause",value:function(){this.playerService.togglePlayPause()}},{key:"updateTime",value:function(){if(this.track.position=1e3*this.mediaObject.currentTime,!this.hasScrobbledCurrentTrack&&(this.track.position>=t.SCROBBLETIME||this.track.position/this.track.duration>=.5&&performance.now()>t.SCROBBLETIME)){this.hasScrobbledCurrentTrack=!0;try{this.lastFMService.scrobbleTrack(this.track).subscribe((function(){}))}catch(e){console.error(e)}}localStorage.setItem("current-time",this.mediaObject.currentTime.toString())}},{key:"onplay",value:function(){var t,e=this;try{this.lastFMService.announceNowPlaying(this.track).subscribe()}catch(i){}document.title="".concat(this.track.title," \u2022 ").concat(this.track.trackArtist),"mediaSession"in navigator&&Object(y.c)("art-".concat(this.track.trackArtist,"-").concat(this.track.album.name)).then((function(t){t&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.track.title,artist:e.track.trackArtist,album:e.track.album.name,artwork:[{src:t,sizes:"500x500",type:"image/png"}]})),navigator.mediaSession.setActionHandler("play",(function(){e.togglePlayPause()})),navigator.mediaSession.setActionHandler("pause",(function(){e.togglePlayPause()})),navigator.mediaSession.setActionHandler("previoustrack",(function(){e.prev()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){e.next()}))})),this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.playing,this.displayUpdater.type=Windows.Media.MediaPlaybackType.music,Object(y.c)("art-".concat(this.track.trackArtist,"-").concat(this.track.album.name)).then((function(t){try{void 0!==e.displayUpdater&&(e.displayUpdater.musicProperties.albumArtist=e.track.trackArtist,e.displayUpdater.musicProperties.artist=e.track.trackArtist,e.displayUpdater.musicProperties.albumTitle=e.track.album.name,e.displayUpdater.musicProperties.title=e.track.title,t&&(e.displayUpdater.thumbnail=Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new Windows.Foundation.Uri(t))),e.displayUpdater.update())}catch(i){console.error("error occurred",i)}e.updateWinTile(t)}))),document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbplaying",{detail:this.track})),this.audioCtx&&this.audioCtx.resume(),this.usesDynamicAccentColor=this.booleanState("dynamic-accent-color"),this.usesDynamicAccentColor&&(t=this.rgba)&&$(function(t){var e=X(t,"#fff"),i=X(t,"#000");return{rgba:t,textLight:e,textDark:i,lighten:W(new F.a(e).lighten().toRgb()),darken:W(new F.a(i).darken().toRgb()),lighten30:W(new F.a(e).lighten(30).toRgb()),darken30:W(new F.a(i).darken(30).toRgb()),letterColor:K(new F.a(t))}}(t))}},{key:"onstop",value:function(){document.querySelector("mdb-player").dispatchEvent(new Event("external.mdbstopped")),document.title="JSMusicDB Next",this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.stopped),this.audioCtx&&this.audioCtx.suspend(),G()}},{key:"onpause",value:function(){document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbpaused",{detail:this.track})),document.title="JSMusicDB Next",this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.paused),this.audioCtx&&this.audioCtx.suspend(),G()}},{key:"onChangeArt",value:function(t){var e=this;this.usesDynamicAccentColor?H(t.detail.art,(function(t){var i=Z(t,e.bgColor);e.colorService.setColor(i.rgba),i.rgba=i.textLight,$(i)}),!1):(this.colorService.setColor({r:0,g:110,b:205,a:1}),G())}},{key:"toggleShuffle",value:function(){this.isShuffled=!this.isShuffled,this.playerService.shufflePlaylist(this.isShuffled)}},{key:"toggleLoved",value:function(){this.track.isLoved=!this.track.isLoved,this.lastFMService.toggleLoved(this.track).subscribe()}},{key:"toggleVolumeWindow",value:function(t){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.showVolumeWindow=!this.showVolumeWindow}},{key:"onprogress",value:function(){var t=this.mediaObject.buffered;0!==t.length&&(this.track.buffered.start=1e3*t.start(0!==t.length?t.length-1:0),this.track.buffered.end=1e3*t.end(0!==t.length?t.length-1:0))}},{key:"setVolume",value:function(){this.mediaObject.volume=this.volume/100,this.playerService.setVolume(this.volume)}},{key:"jump",value:function(t){var e=(t.clientX||t.changedTouches[0].clientX)/document.querySelector(".player").clientWidth;this.playerService.setPosition(this.track.duration/1e3*e)}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}},{key:"updateWinTile",value:function(t){var e=Windows.UI.Notifications;e.TileUpdateManager.createTileUpdaterForApplication("App").clear();var i=e.TileUpdateManager.getTemplateContent(e.TileTemplateType.tileSquare150x150PeekImageAndText02),n=i.getElementsByTagName("text")[0];n.innerText=this.track.title,(n=i.getElementsByTagName("text")[1]).innerText=this.track.trackArtist,t&&(i.getElementsByTagName("image")[0].attributes[1].value=t);var a=new Date,s=new Date(a.getTime()+Number(this.track.duration)),r=i.importNode(this.getTileContent(t,"tileSquare310x310ImageAndText02").getElementsByTagName("binding").item(0),!0);i.getElementsByTagName("visual").item(0).appendChild(r),r=i.importNode(this.getTileContent(t,"tileWide310x150PeekImage02").getElementsByTagName("binding").item(0),!0),i.getElementsByTagName("visual").item(0).appendChild(r),r=i.importNode(this.getTileContent(t,"tileSquare71x71Image").getElementsByTagName("binding").item(0),!0),i.getElementsByTagName("visual").item(0).appendChild(r);var o=new e.TileNotification(i);o.expirationTime=s,e.TileUpdateManager.createTileUpdaterForApplication("App").update(o)}},{key:"getTileContent",value:function(t,e){var i=Windows.UI.Notifications,n=i.TileUpdateManager.getTemplateContent(i.TileTemplateType[e]);try{n.getElementsByTagName("text")[0].innerText=this.track.title}catch(a){console.error(a)}try{n.getElementsByTagName("text")[1].innerText=this.track.trackArtist}catch(a){console.error(a)}return t&&(n.getElementsByTagName("image")[0].attributes[1].value=t),n}}]),t}()).SCROBBLETIME=24e4,nt.\u0275fac=function(t){return new(t||nt)(n.Kb(p.a),n.Kb(l.a),n.Kb(S.c),n.Kb(g.a),n.Kb(m.a),n.Kb(h.a),n.Kb(b.a),n.Kb(f.a))},nt.\u0275cmp=n.Eb({type:nt,selectors:[["mdb-player"]],decls:1,vars:1,consts:[["class","player",4,"ngIf"],[1,"player"],[1,"row"],[1,"progress",3,"click"],["role","progressbar",1,"progress-bar",3,"ngStyle"],[1,"container-fluid"],[1,"row","row-sm"],[1,"col-xs-4","col-player-art",3,"click"],[3,"artist","album","art"],[1,"col-xs-11","col-player-special"],[3,"click"],[1,"hidden-xs","color-type-secondary"],[1,"col-xs-9","text-right","col-player-controls"],[1,"btn","btn-link",3,"click"],[1,"glyph","glyph-previous"],["class","glyph glyph-pause",4,"ngIf"],["class","glyph glyph-play",4,"ngIf"],[1,"glyph","glyph-next"],[1,"btn","btn-link","d-none","d-md-inline-block",3,"click"],[1,"glyph",3,"ngClass"],[1,"btn","btn-link","d-none","d-md-inline-block","btn-love",3,"ngClass","click"],[1,"glyph","glyph-star-outline"],[1,"btn","btn-link","d-none","d-md-inline-block","btn-shuffle",3,"ngClass","click"],[1,"glyph","glyph-shuffle"],[1,"volume-control",3,"hidden"],["type","range","min","0","max","100",3,"ngModel","ngModelChange","input","change"],[1,"glyph","glyph-pause"],[1,"glyph","glyph-play"]],template:function(t,e){1&t&&n.rc(0,it,34,22,"div",0),2&t&&n.fc("ngIf",e.showPlayer)},directives:[v.k,v.l,v.i,s.i,s.a,s.c,s.f],encapsulation:2}),nt);function st(t,e){if(1&t&&(n.Nb(0,"div"),n.sc(1),n.Mb()),2&t){var i=n.Zb(2);n.zb(1),n.uc(" progress: ",i.scanperc,"% ")}}function rt(t,e){if(1&t&&(n.Nb(0,"div",6),n.Nb(1,"div",7),n.Nb(2,"div",8),n.Nb(3,"div",9),n.sc(4," Collection is being reloaded, please wait. "),n.rc(5,st,2,1,"div",10),n.Nb(6,"div",11),n.Lb(7,"div",12),n.Lb(8,"div",12),n.Lb(9,"div",12),n.Lb(10,"div",12),n.Lb(11,"div",12),n.Mb(),n.Mb(),n.Mb(),n.Mb(),n.Mb()),2&t){var i=n.Zb();n.zb(5),n.fc("ngIf",i.scanperc)}}var ot,ct,lt,ut,ht=function(t){return{isPlaying:t}},dt=((ct=function(){function t(e,i,n,a,s,r,o){var c=this;_classCallCheck(this,t),this.collectionService=e,this.coreService=i,this.loginService=n,this.configService=a,this.playerService=s,this.colorService=r,this.isPlaying=!1,this.scanperc=0,this.isReloading=!1,this.letter="N",this.path="JSMusicDB Next",this.isLoading=!1,this.hasBeenReloading=!1,this.isHostedApp="undefined"!=typeof Windows,this.loginService.hasToken&&(this.isLoading=!0,this.poll()),this.viewContainerRef=o,this.subscription=this.playerService.playlistAnnounced$.subscribe((function(t){c.isPlaying=!!t})),this.booleanState("tracking-state")?navigator.geolocation.getCurrentPosition((function(t){c.configService.getSunriseInfo(t.coords.latitude,t.coords.longitude).subscribe((function(t){c.configService.startDate=new Date(t.results.sunset),c.configService.stopDate=new Date(t.results.sunrise),c.configService.stopDate.setDate(c.configService.stopDate.getDate()+1),c.configService.geoSource.next(),c.configService.applyTheme()}))}),(function(t){c.configService.startDate=new Date,c.configService.startDate.setHours(21,0,0),c.configService.stopDate=new Date,c.configService.stopDate.setDate(c.configService.stopDate.getDate()+1),c.configService.stopDate.setHours(7,0,0),c.configService.geoSource.next(),c.configService.applyTheme()})):(this.configService.startDate=new Date,this.configService.startDate.setHours(21,0,0),this.configService.stopDate=new Date,this.configService.stopDate.setDate(this.configService.stopDate.getDate()+1),this.configService.stopDate.setHours(7,0,0),this.configService.geoSource.next(),this.configService.applyTheme())}return _createClass(t,[{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"ngOnInit",value:function(){this.mediaObject=document.querySelector("audio");var t=this.mediaObject.canPlayType("audio/flac");this.isFlacSupported="probably"===t||"maybe"===t}},{key:"getCollection",value:function(){var t=this;this.collectionService.getCollection().subscribe((function(e){return t.fillCollection(e)}),(function(t){return console.error(t)}))}},{key:"fillCollection",value:function(t){localStorage.setItem("lastParsed",(new Date).getTime().toString()),this.coreService.getCore().parseSourceJson(t,this.isFlacSupported),this.isLoading=!1}},{key:"hideVolumeWindow",value:function(){this.playerService.hideVolumeControl()}},{key:"poll",value:function(){var t=this;this.collectionService.poll().subscribe((function(e){t.scanperc=e.progress,"ready"!==e.status?(t.isReloading=!0,document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbscanning",{detail:{percentage:t.scanperc}})),setTimeout((function(e){t.poll()}),5e3),t.hasBeenReloading=!0):(t.isReloading=!1,t.hasBeenReloading&&document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbscanstop")),t.getCollection())}))}},{key:"onExternalPrev",value:function(t){this.playerService.prev()}},{key:"onExternalNext",value:function(t){this.playerService.next()}},{key:"onExternalToggle",value:function(t){this.playerService.togglePlayPause()}},{key:"onExternalStop",value:function(t){this.playerService.stop()}},{key:"onExternalBlob",value:function(){this.colorService.setBlob()}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}}]),t}()).\u0275fac=function(t){return new(t||ct)(n.Kb(d.a),n.Kb(m.a),n.Kb(c.a),n.Kb(f.a),n.Kb(l.a),n.Kb(b.a),n.Kb(n.N))},ct.\u0275cmp=n.Eb({type:ct,selectors:[["mdb-root"]],features:[n.yb([d.a,m.a,p.a,l.a,g.a,h.a,f.a,u.a,b.a])],decls:10,vars:7,consts:[["id","reloading",4,"ngIf"],[3,"ngClass","click"],[1,"fixed-top",2,"z-index","1029",3,"click"],[1,"main-content",3,"ngClass","click"],[2,"display","none"],[3,"mdbprev","mdbnext","mdbtoggle","mdbstop","click","mdbblob"],["id","reloading"],[1,"container"],[1,"row"],[1,"col"],[4,"ngIf"],[1,"progress-bar"],[1,"progress-circle"]],template:function(t,e){1&t&&(n.rc(0,rt,12,1,"div",0),n.Nb(1,"div",1),n.Vb("click",(function(){return e.hideVolumeWindow})),n.Lb(2,"mdb-topmenu"),n.Mb(),n.Nb(3,"div",2),n.Vb("click",(function(){return e.hideVolumeWindow})),n.Lb(4,"mdb-letters"),n.Mb(),n.Nb(5,"div",3),n.Vb("click",(function(){return e.hideVolumeWindow})),n.Lb(6,"router-outlet"),n.Mb(),n.Lb(7,"audio",4),n.Lb(8,"canvas"),n.Nb(9,"mdb-player",5),n.Vb("mdbprev",(function(t){return e.onExternalPrev(t)}))("mdbnext",(function(t){return e.onExternalNext(t)}))("mdbtoggle",(function(t){return e.onExternalToggle(t)}))("mdbstop",(function(t){return e.onExternalStop(t)}))("click",(function(){return e.hideVolumeWindow()}))("mdbblob",(function(){return e.onExternalBlob()})),n.Mb()),2&t&&(n.fc("ngIf",e.isReloading),n.zb(1),n.fc("ngClass",n.ic(3,ht,e.isPlaying)),n.zb(4),n.fc("ngClass",n.ic(5,ht,e.isPlaying)))},directives:[v.k,v.i,R,B,S.f,at],encapsulation:2}),ct),bt=((ot=function(){function t(e,i){_classCallCheck(this,t),this.loginService=e,this.router=i}return _createClass(t,[{key:"canActivate",value:function(t,e){var i=this;return new Promise((function(t){var n=e.url;window.scrollTo(0,0),t(i.checkLogin(n))}))}},{key:"checkLogin",value:function(t){return!!localStorage.getItem("jwt")||(this.router.navigate(["/login"]),!1)}}]),t}()).\u0275fac=function(t){return new(t||ot)(n.Rb(c.a),n.Rb(S.c))},ot.\u0275prov=n.Gb({token:ot,factory:ot.\u0275fac}),ot),ft=[bt,c.a],mt=S.e.forRoot([{path:"login",loadChildren:function(){return i.e(9).then(i.bind(null,"X3zk")).then((function(t){return t.LoginModule}))}},{path:"home",loadChildren:function(){return Promise.all([i.e(0),i.e(6)]).then(i.bind(null,"ct+p")).then((function(t){return t.HomeModule}))},canActivate:[bt]},{path:"letters",loadChildren:function(){return i.e(8).then(i.bind(null,"mCIM")).then((function(t){return t.LettersModule}))},canActivate:[bt]},{path:"artists",loadChildren:function(){return Promise.all([i.e(0),i.e(5)]).then(i.bind(null,"3r4j")).then((function(t){return t.ArtistsModule}))},canActivate:[bt]},{path:"albums",loadChildren:function(){return Promise.all([i.e(0),i.e(3)]).then(i.bind(null,"fX0g")).then((function(t){return t.AlbumsModule}))},canActivate:[bt]},{path:"years",loadChildren:function(){return Promise.all([i.e(0),i.e(20)]).then(i.bind(null,"ZutQ")).then((function(t){return t.YearsModule}))},canActivate:[bt]},{path:"playlists",loadChildren:function(){return Promise.all([i.e(0),i.e(12)]).then(i.bind(null,"kez3")).then((function(t){return t.PlaylistsModule}))},canActivate:[bt]},{path:"now-playing",loadChildren:function(){return Promise.all([i.e(0),i.e(11)]).then(i.bind(null,"YxDV")).then((function(t){return t.NowPlayingModule}))},canActivate:[bt]},{path:"settings",loadChildren:function(){return Promise.all([i.e(0),i.e(17)]).then(i.bind(null,"7wo0")).then((function(t){return t.SettingsModule}))},canActivate:[bt]},{path:"scrobble-cache",loadChildren:function(){return i.e(15).then(i.bind(null,"BSpc")).then((function(t){return t.ScrobbleCacheModule}))},canActivate:[bt]},{path:"search/:query",loadChildren:function(){return Promise.all([i.e(0),i.e(16)]).then(i.bind(null,"RmqX")).then((function(t){return t.SearchModule}))},canActivate:[bt]},{path:"letter/:letter",loadChildren:function(){return Promise.all([i.e(0),i.e(7)]).then(i.bind(null,"pJo8")).then((function(t){return t.LetterDetailModule}))},canActivate:[bt]},{path:"letter/:letter/artist/:artist",loadChildren:function(){return Promise.all([i.e(0),i.e(4)]).then(i.bind(null,"2+yB")).then((function(t){return t.ArtistDetailModule}))},canActivate:[bt]},{path:"letter/:letter/artist/:artist/album/:album",loadChildren:function(){return Promise.all([i.e(0),i.e(2)]).then(i.bind(null,"jJnS")).then((function(t){return t.AlbumDetailModule}))},canActivate:[bt]},{path:"",loadChildren:function(){return Promise.all([i.e(0),i.e(6)]).then(i.bind(null,"ct+p")).then((function(t){return t.HomeModule}))},canActivate:[bt]}],{preloadingStrategy:S.b}),gt=((lt=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"supports",value:function(t){var e=!1;return 0===t.indexOf("mdb")&&(e=!0),e}},{key:"addEventListener",value:function(t,e,i){var n=this,a=this.manager.getZone(),s=function(t){a.run((function(){return i(t)}))};return this.manager.getZone().runOutsideAngular((function(){n.manager.addEventListener(t,"external."+e,s)}))}},{key:"addGlobalEventListener",value:function(t,e,i){var n=this,a=this.manager.getZone(),s=function(t){return a.run((function(){return i(t)}))};return this.manager.getZone().runOutsideAngular((function(){n.manager.addGlobalEventListener(t,e,s)}))}}]),t}()).\u0275fac=function(t){return new(t||lt)},lt.\u0275prov=n.Gb({token:lt,factory:lt.\u0275fac}),lt),pt=i("hDf6"),vt=i("R1ws"),yt=((ut=function t(){_classCallCheck(this,t),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then((function(t){})).catch((function(t){console.error("Registration failed with "+t)}))}).\u0275mod=n.Ib({type:ut,bootstrap:[dt]}),ut.\u0275inj=n.Hb({factory:function(t){return new(t||ut)},providers:[ft,{provide:r.b,useClass:gt,multi:!0},{provide:n.u,useValue:"en-GB"}],imports:[[r.a,a.b,s.b,mt,o.c.forRoot(),pt.a,vt.a]]}),ut);Object(n.R)(),window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),window.deferredPrompt=t})),r.c().bootstrapModule(yt).catch((function(t){return console.error(t)}))}},[[0,1,19]]]);