(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"ct+p":function(e,t,n){"use strict";n.r(t);var s=n("ofXK"),c=n("fXoL"),i=n("3Pt+"),a=n("z6cu"),r=n("JIr8"),o=n("tk/3");let l=(()=>{class e{constructor(e){this.http=e}getRecentlyListened(e){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{user:e,method:"user.getrecenttracks",api_key:"956c1818ded606576d6941de5ff793a5",format:"json",limit:"6"}}).pipe(Object(r.a)(this.handleError))}handleError(e){const t=e.message?e.message:e.status?`${e.status} - ${e.statusText}`:"Server error";return Object(a.a)(t)}}return e.ngInjectableDef=c.Lb({token:e,factory:function(t){return new(t||e)(c.Wb(o.a))},providedIn:null}),e})();var d=n("hDf6"),b=n("tyNb"),u=n("ztCj"),m=n("uwnU"),g=n("ufXC"),h=n("MDLy"),p=n("OgP6"),f=n("ktVm"),y=n("t083"),k=n("XtVx");class T{}var w=n("UrAU");const v=[1,"animated-page"],R=["class","container",4,"ngIf"],I=[1,"container"],L=[1,"row"],P=[1,"col"],E=["class","wrapper-home",4,"ngIf"],S=[1,"wrapper-home"],D=[1,"list-group","list-recently"],C=["class","list-group-item d-flex",3,"click",4,"ngFor","ngForOf"],M=[1,"list-group-item","d-flex",3,"click"],A=[1,"image-wrapper","col-3","col-md-2","col-lg-1"],G=["class","glyph glyph-play","aria-hidden","true",4,"ngIf"],$=["class","nowplaying-image",3,"src",4,"ngIf"],x=[1,"details-wrapper","col-6","col-md-7","col-lg-8"],N=[1,"small","muted"],j=[1,"time-wrapper","text-right","col-3"],O=[4,"ngIf"],F=[3,"ngClass",4,"ngIf"],J=["class","small muted",4,"ngIf"],U=["aria-hidden","true",1,"glyph","glyph-play"];function B(e,t){1&e&&c.Qb(0,"span",U)}const Q=[1,"nowplaying-image",3,"src"];function Z(e,t){if(1&e&&c.Qb(0,"img",Q),2&e){const e=c.ec().$implicit;c.lc("src",e.image,c.xc)}}function V(e,t){if(1&e&&(c.Tb(0,"span"),c.Gc(1),c.fc(2,"date"),c.Rb()),2&e){const e=c.ec(2).$implicit;c.yc(1),c.Hc(c.hc(2,1,e.date,"mediumDate"))}}function X(e,t){if(1&e&&(c.Tb(0,"span"),c.Gc(1),c.fc(2,"date"),c.Tb(3,"span",N),c.Ec(4,V,3,4,"span",O),c.Rb(),c.Rb()),2&e){const e=c.ec().$implicit;c.yc(1),c.Ic(" ",c.hc(2,2,e.date,"shortTime")," "),c.yc(4),c.kc("ngIf",!e.nowPlaying)}}const z=[3,"ngClass"],H=function(e){return{"now-playing":e}};function q(e,t){if(1&e&&(c.Tb(0,"span",z),c.Gc(1," Playing "),c.Rb()),2&e){const e=c.ec().$implicit;c.kc("ngClass",c.nc(1,H,e.nowPlaying))}}function Y(e,t){1&e&&(c.Tb(0,"span",N),c.Gc(1," right now "),c.Rb())}function K(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",M),c.Zb("click",function(n){c.vc(e);const s=t.$implicit;return c.ec(3).playTrack(s)}),c.Tb(1,"div",A),c.Ec(2,B,1,0,"span",G),c.Ec(3,Z,1,1,"img",$),c.Rb(),c.Tb(4,"div",x),c.Gc(5),c.Qb(6,"br"),c.Tb(7,"span",N),c.Gc(8),c.Rb(),c.Rb(),c.Tb(9,"div",j),c.Ec(10,X,5,5,"span",O),c.Ec(11,q,2,3,"span",F),c.Ec(12,Y,2,0,"span",J),c.Rb(),c.Rb()}if(2&e){const e=t.$implicit;c.yc(2),c.kc("ngIf",!0===e.nowPlaying),c.yc(3),c.kc("ngIf",!1===e.nowPlaying),c.yc(5),c.Jc(" ",e.artist," \u2022 ",e.title," "),c.yc(8),c.Ic("",e.album," "),c.yc(10),c.kc("ngIf",!e.nowPlaying),c.yc(11),c.kc("ngIf",e.nowPlaying),c.yc(12),c.kc("ngIf",e.nowPlaying)}}function W(e,t){if(1&e&&(c.Tb(0,"div",S),c.Tb(1,"h4"),c.Gc(2,"Recently listened"),c.Rb(),c.Tb(3,"ol",D),c.Ec(4,K,13,8,"li",C),c.Rb(),c.Rb()),2&e){const e=c.ec(2);c.yc(4),c.kc("ngForOf",e.recentlyListenedTracks)}}const _=[1,"media-container","col","list-recently-added"],ee=["class","album-panel media-panel",4,"ngFor","ngForOf"],te=[1,"album-panel","media-panel"],ne=[3,"album"];function se(e,t){if(1&e&&(c.Tb(0,"div",te),c.Qb(1,"mdb-album",ne),c.Rb()),2&e){const e=t.$implicit;c.yc(1),c.kc("album",e)}}function ce(e,t){if(1&e&&(c.Tb(0,"div",S),c.Tb(1,"h4"),c.Gc(2,"Recently added / modified"),c.Rb(),c.Tb(3,"div",L),c.Tb(4,"div",_),c.Ec(5,se,2,1,"div",ee),c.Rb(),c.Rb(),c.Rb()),2&e){const e=c.ec(2);c.yc(5),c.kc("ngForOf",e.recentlyAdded)}}function ie(e,t){if(1&e&&(c.Tb(0,"div",I),c.Tb(1,"div",L),c.Tb(2,"div",P),c.Ec(3,W,5,1,"div",E),c.Ec(4,ce,6,1,"div",E),c.Rb(),c.Rb(),c.Rb()),2&e){const e=c.ec();c.yc(3),c.kc("ngIf",e.recentlyListenedTracks.length>0),c.yc(4),c.kc("ngIf",e.recentlyAdded.length>0)}}const ae=["role","form",1,"form-horizontal",3,"ngClass","ngSubmit"],re=["lastfmForm","ngForm"],oe=[1,"form-group","row"],le=["for","name",1,"col-12","col-sm-4","col-lg-2","col-form-label"],de=[1,"col","col-sm-8","col-lg-10"],be=["type","text","id","name","placeholder","e.g. JohnDoe","required","","name","name",1,"form-control",3,"ngModel","ngModelChange"],ue=["name","ngModel"],me=["for","password",1,"col-12","col-sm-4","col-lg-2","col-form-label"],ge=["type","password","id","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],he=["password","ngModel"],pe=[1,"col","offset-md-4","offset-lg-2"],fe=["type","submit",1,"btn","btn-primary",3,"disabled"],ye=["type","button",1,"btn","btn-link",3,"click"],ke=function(e){return{"theme-alt":e}};function Te(e,t){if(1&e){const e=c.Ub();c.Tb(0,"div",I),c.Tb(1,"div",L),c.Tb(2,"div",P),c.Tb(3,"h4"),c.Gc(4,"Login to last.fm"),c.Rb(),c.Qb(5,"br"),c.Tb(6,"form",ae,re),c.Zb("ngSubmit",function(t){return c.vc(e),c.ec().onSubmit()}),c.Tb(8,"div",oe),c.Tb(9,"label",le),c.Gc(10,"Username"),c.Rb(),c.Tb(11,"div",de),c.Tb(12,"input",be,ue),c.Zb("ngModelChange",function(t){return c.vc(e),c.ec().user.name=t}),c.Rb(),c.Rb(),c.Rb(),c.Tb(14,"div",oe),c.Tb(15,"label",me),c.Gc(16,"Password"),c.Rb(),c.Tb(17,"div",de),c.Tb(18,"input",ge,he),c.Zb("ngModelChange",function(t){return c.vc(e),c.ec().user.password=t}),c.Rb(),c.Rb(),c.Rb(),c.Tb(20,"div",oe),c.Tb(21,"div",pe),c.Tb(22,"button",fe),c.Gc(23," Login "),c.Rb(),c.Tb(24,"button",ye),c.Zb("click",function(t){return c.vc(e),c.ec().skipLastfm()}),c.Gc(25," Skip "),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Rb(),c.Rb()}if(2&e){const e=c.tc(7),t=c.ec();c.yc(6),c.kc("ngClass",c.nc(4,ke,"dark"===t.theme)),c.yc(12),c.kc("ngModel",t.user.name),c.yc(18),c.kc("ngModel",t.user.password),c.yc(22),c.kc("disabled",!e.form.valid)}}const we=[{path:"",component:(()=>{class e{constructor(e,t,n,s,c,i,a,r){this.playerService=e,this.collectionService=t,this.coreService=n,this.router=s,this.recentlyListened=c,this.pathService=i,this.lastFMService=a,this.configService=r,this.recentlyListenedTracks=[],this.RECENTLYLISTENEDINTERVAL=6e4,this.newListenedTracks=[],this.loading=!0,this.recentlyAdded=[],this.user=new T,this.subscription=this.configService.mode$.subscribe(e=>{this.theme=e}),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe(e=>{this.init(!0)}),this.theme=r.mode,this.pathService.announcePage("Home"),localStorage.getItem("lastfm-username")&&(this.username=localStorage.getItem("lastfm-username")),this.init()}onSubmit(){this.lastFMService.authenticate({user:this.user.name,password:this.user.password}).subscribe(e=>{localStorage.setItem("lastfm-token",e.session.key),localStorage.setItem("lastfm-username",this.user.name),this.username=this.user.name,this.startPolling()})}init(e=!1){(this.core.isCoreParsed||e)&&localStorage.getItem("lastfm-username")&&this.startPolling(),this.recentlyAdded=this.core.getLatestAdditions(14),Object(u.b)("cached-recently-listened").then(e=>{e&&this.populate(e),this.loading=!1})}ngOnDestroy(){clearInterval(this.counter),this.subscription.unsubscribe(),this.subscription2.unsubscribe()}startPolling(){this.counter||(this.counter=setInterval(()=>{this.checkRecentlyListened()},this.RECENTLYLISTENEDINTERVAL),this.checkRecentlyListened())}checkRecentlyListened(){this.newListenedTracks=[],this.loading=!0,"mdb-skipped"!==this.username?this.recentlyListened.getRecentlyListened(this.username).subscribe(e=>{Object(u.c)("cached-recently-listened",e.recenttracks.track),this.populate(e.recenttracks.track)},e=>console.error(e)):Object(u.b)("recentlyListened").then(e=>{e&&this.populate(e),this.loading=!1})}setDate(e){return e["@attr"]&&e["@attr"].nowplaying?new Date:new Date(1e3*Number(e.date.uts))}setImage(e){return e.image&&e.image[e.image.length-1]["#text"]||"/global/images/no-cover.png"}populate(e){this.newListenedTracks=[],e.forEach(e=>{const t=new m.a({});t.artist=e.artist["#text"],t.album=e.album["#text"],t.title=e.name,t.image=this.setImage(e),t.nowPlaying=!(!e["@attr"]||!e["@attr"].nowplaying),t.date=this.setDate(e),t.trackArtist=e.artist["#text"],t.isPlaying=!1,t.isPaused=!1,t.isLoved=!1,t.id=`${e.artist["#text"]}-${e.album["#text"]}-${e.name}`,this.newListenedTracks.push(t)}),this.recentlyListenedTracks!==this.newListenedTracks&&(this.recentlyListenedTracks=this.newListenedTracks),this.loading=!1}skipLastfm(){localStorage.setItem("lastfm-username","mdb-skipped"),this.username="mdb-skipped",this.startPolling()}playTrack(e){const t=this.core.getArtistByName(e.artist);if(t){const n=this.core.getAlbumByArtistAndName(t,e.album);if(n){const t=this.core.getTrackByAlbumAndName(n,e.title);t?(this.playerService.doPlayTrack(t),setTimeout(()=>{this.checkRecentlyListened()},500)):console.warn("track not found",e)}else console.warn("album not found",e)}else console.warn("artist not found",e)}}return e.ngComponentDef=c.Jb({type:e,selectors:[["app-home"]],factory:function(t){return new(t||e)(c.Pb(g.a),c.Pb(h.a),c.Pb(f.a),c.Pb(b.c),c.Pb(l),c.Pb(k.a),c.Pb(y.a),c.Pb(p.a))},consts:3,vars:2,template:function(e,t){1&e&&(c.Tb(0,"div",v),c.Ec(1,ie,5,2,"div",R),c.Ec(2,Te,26,6,"div",R),c.Rb()),2&e&&(c.yc(1),c.kc("ngIf",t.recentlyListenedTracks&&t.username),c.yc(2),c.kc("ngIf",!t.username))},directives:[s.l,s.k,s.j,w.a,i.p,i.g,i.h,i.a,i.m,i.f,i.i],pipes:[s.e],encapsulation:2}),e})()}];let ve=(()=>{class e{}return e.ngModuleDef=c.Nb({type:e}),e.ngInjectorDef=c.Mb({factory:function(t){return new(t||e)},imports:[[b.e.forChild(we)],b.e]}),e.ngLocaleIdDef="en-GB",e})();b.e.forChild(we),n.d(t,"HomeModule",function(){return Re});let Re=(()=>{class e{}return e.ngModuleDef=c.Nb({type:e}),e.ngInjectorDef=c.Mb({factory:function(t){return new(t||e)},providers:[l],imports:[[s.c,ve,d.a,i.b]]}),e.ngLocaleIdDef="en-GB",e})()}}]);