function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"+ooL":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("XNiG"),a=i("fXoL"),r=function(){var t=function(){function t(){_classCallCheck(this,t),this.colorSource=new n.a,this.blobSource=new n.a,this.color$=this.colorSource.asObservable(),this.blob$=this.blobSource.asObservable()}return _createClass(t,[{key:"setColor",value:function(t){this.colorSource.next(t)}},{key:"setBlob",value:function(){this.blobSource.next(!0)}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=a.Hb({token:t,factory:t.\u0275fac}),t}()},"/1T7":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function t(e){_classCallCheck(this,t),this.tracks=[],this.discs=[],this.sortedDiscs=[],this.modified=0,this.isContinues=!0,e.album&&e.title&&(this.name=e.album,this.sortName=this.name.toUpperCase(),this.year=e.year,this.modified=e.modified,this.year&&-1!==this.year.indexOf("-")&&(this.year=this.year.split("-")[0]))}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.artist.letter.escapedLetter,"/artist/").concat(encodeURIComponent(this.artist.name),"/album/").concat(encodeURIComponent(this.name))}}]),t}()},0:function(t,e,i){t.exports=i("zUnb")},"1gFc":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("fXoL"),a=function(){var t=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"requestAnimation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"enter",e=arguments.length>1?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&(e.classList.contains(t)&&e.classList.remove(t),setTimeout((function(){e.classList.add(t)}),10),i&&setTimeout((function(){e.classList.remove(t)}),150))}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac}),t}()},Gcu2:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n=i("XNiG"),a=i("LNEh"),r=i("ktVm"),s=i("t083"),o=i("KI15"),c=i("fXoL"),l=function(){var t=function(){function t(e,i){_classCallCheck(this,t),this.coreService=e,this.lastfmservice=i,this.playlistSubject=new n.a,this.playlistAnnounced$=this.playlistSubject.asObservable(),this.numberOfTracksInAPlaylist=100,this.username=localStorage.getItem("lastfm-username"),this.core=this.coreService.getCore()}return _createClass(t,[{key:"generateRandom",value:function(){var t=this,e=Object.keys(this.core.tracks),i=this.shuffle(e).splice(0,this.numberOfTracksInAPlaylist),n=new o.a;return n.name="".concat(this.numberOfTracksInAPlaylist," random tracks"),i.map((function(e){n.tracks.push(t.core.tracks[e])})),n}},{key:"generateRadio",value:function(){var t=this;this.lastfmservice.getTopArtists(this.username).subscribe((function(e){t.playlistSubject.next(t.extractArtists(e))}))}},{key:"extractTracks",value:function(t){var e=this,i=new o.a;return i.name="Loved tracks on Last.FM",t.map((function(t){var n=e.core.getTrackByArtistAndName(t.artist.name,t.name);n&&i.tracks.push(n)})),i}},{key:"extractArtists",value:function(t){var e=this,i=[],n=[];return t.forEach((function(t,r){t.dummy=!0;var s=new a.a(t),o=e.core.artists[s.sortName];o&&r<10?i.push(o):n.push(o)})),this.generateRadioList(i,n)}},{key:"generateRadioList",value:function(t,e){var i=new o.a;i.name="".concat(this.numberOfTracksInAPlaylist," random tracks based on your recently listened tracks");for(var n=0;n<this.numberOfTracksInAPlaylist;n++)i.tracks.push(this.getRandomTrackFromList(n%3==0||n%5==0?t:n%4==0||n%7==0?e:this.core.artistsList()));return i}},{key:"getRandomTrackFromList",value:function(t){var e=this.shuffle(t)[0];if(e){var i=this.shuffle(e.albums)[0],n=this.shuffle(i.tracks)[0];return n.duration<=6e5?n:this.getRandomTrackFromList(t)}return this.getRandomTrackFromList(t)}},{key:"shuffle",value:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t}},{key:"getNextTrackForPlaylist",value:function(t,e){var i=this.getRandomTrackFromList(t);if(i){var n=i.artist;return e.tracks.length>1&&e.tracks[e.tracks.length-1].artist===n&&t.length>1?this.getNextTrackForPlaylist(t,e):i}return null}}]),t}();return t.\u0275fac=function(e){return new(e||t)(c.Sb(r.a),c.Sb(s.a))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac}),t}()},KI15:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function t(){_classCallCheck(this,t),this.tracks=[],this.isOwn=!1,this.isContinues=!1}},LNEh:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function t(e){_classCallCheck(this,t),this.albums=[],(e.album&&e.title||e.dummy)&&(this.name=e.name||e.artist||"",this.albumArtist=e.albumartist||e.albumArtist||"",this.sortName=this.stripFromName(this.albumArtist?this.albumArtist.toUpperCase():e.sortName?e.sortName.toUpperCase():this.name.toUpperCase(),["the ",'"',"a "]),this.bio=e.bio,this.isCollection=!!this.albumArtist&&this.name!==this.albumArtist)}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.letter.escapedLetter,"/artist/").concat(encodeURIComponent(this.albumArtist||this.name),"/")}},{key:"sortAlbumsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.albums.sort((function(i,n){if(-1!==t.indexOf(".")){var a=t.split(".");return i[a[0]][a[1]]<n[a[0]][a[1]]?"asc"===e?-1:1:i[a[0]][a[1]]>n[a[0]][a[1]]?"asc"===e?1:-1:0}return i[t]<n[t]?"asc"===e?-1:1:i[t]>n[t]?"asc"===e?1:-1:0}))}},{key:"sortAndReturnAlbumsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return this.sortAlbumsBy(t,e),this.albums}},{key:"stripFromName",value:function(t,e){var i=t?t.toUpperCase():"";return i=i.trim(),e.forEach((function(t){var e=t.toUpperCase();0===i.indexOf(e)&&(i=i.substring(e.length))})),i}}]),t}()},MDLy:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("z6cu"),a=i("JIr8"),r=i("Kj3r"),s=i("fXoL"),o=i("tk/3"),c=function(){var t=function(){function t(e){_classCallCheck(this,t),this.http=e,this.collectionUrl="/data/node-music.json",this.reloadUrl="/rescan",this.pollUrl="/progress",this.dsm=localStorage.getItem("dsm")}return _createClass(t,[{key:"getCollection",value:function(){return this.dsm=localStorage.getItem("dsm"),this.http.get(this.dsm+this.collectionUrl).pipe(Object(a.a)(this.handleError))}},{key:"reload",value:function(){var t=this.dsm+this.reloadUrl,e=localStorage.getItem("jwt");return this.http.get("".concat(t,"?_ts=").concat((new Date).getTime(),"&jwt=").concat(e)).pipe(Object(a.a)(this.handleError))}},{key:"poll",value:function(){var t=this.dsm+this.pollUrl,e=localStorage.getItem("jwt");return this.http.get("".concat(t,"?_ts=").concat((new Date).getTime(),"&jwt=").concat(e)).pipe(Object(r.a)(300),Object(a.a)(this.handleError))}},{key:"handleError",value:function(t){var e=t.message?t.message:t.status?"".concat(t.status," - ").concat(t.statusText):"Server error";return Object(n.a)(e)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.Sb(o.a))},t.\u0275prov=s.Hb({token:t,factory:t.\u0275fac}),t}()},OgP6:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("XNiG"),a=i("z6cu"),r=i("JIr8"),s=i("fXoL"),o=i("tk/3"),c=function(){var t=function(){function t(e){_classCallCheck(this,t),this.http=e,this.geoSource=new n.a,this.themeSource=new n.a,this.modeSource=new n.a,this.theme$=this.themeSource.asObservable(),this.mode$=this.modeSource.asObservable(),this.geo$=this.geoSource.asObservable(),this._theme=localStorage.getItem("theme")||"light",this._mode="light",this.counter=0,this.COUNTERTIMER=6e4}return _createClass(t,[{key:"getSunriseInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:51,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return this.http.get("https://api.sunrise-sunset.org/json?lat=".concat(t,"&lng=").concat(e,"&formatted=0")).pipe(Object(r.a)(this.handleError))}},{key:"applyTheme",value:function(){var t=this;"auto"===this._theme?(this.counter||(this.counter=setInterval((function(){t.checkTheme()}),this.COUNTERTIMER)),this.checkTheme(!0)):this.setStyleSheet(this._theme)}},{key:"checkTheme",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=new Date;e<this.stopDate&&e>this.startDate&&"dark"!==this._mode?(this._mode="dark",this.setStyleSheet(this._mode)):(e>this.stopDate||e<this.startDate)&&"light"!==this._mode&&(this._mode="light",this.setStyleSheet(this._mode)),t&&this.setStyleSheet(this._mode)}},{key:"handleError",value:function(t){return Object(a.a)(null)}},{key:"setStyleSheet",value:function(t){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","prod"!==window.ENV&&window.ENV?"/dist/sass/".concat(t,".css"):"global/css/".concat(t,".css")),e.setAttribute("id","customStylesheet");var i=document.getElementById("customStylesheet");i&&document.getElementsByTagName("head")[0].removeChild(i),document.getElementsByTagName("head")[0].appendChild(e),localStorage.setItem("theme",this._theme),localStorage.setItem("style",t),this.themeSource.next(this._theme),this.modeSource.next(t)}},{key:"theme",get:function(){return this._theme},set:function(t){var e=this;this._theme!==t&&(this._theme=t),"auto"!==this._theme||this.counter?"auto"===this._theme||(this.setStyleSheet(this._theme),clearInterval(this.counter),this.counter=0,this._mode=this._theme):(this.counter=setInterval((function(){e.checkTheme()}),this.COUNTERTIMER),this.checkTheme())}},{key:"mode",get:function(){return this._mode}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.Sb(o.a))},t.\u0275prov=s.Hb({token:t,factory:t.\u0275fac}),t}()},XNvx:function(t,e,i){"use strict";var n=i("z6cu"),a=i("tk/3"),r=i("JIr8"),s={cipher:{},hash:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t}}};s.cipher.aes=function(t){this.h[0][0][0]||this.w();var e,i,n,a,r=this.h[0][4],o=this.h[1],c=1;if(4!==(e=t.length)&&6!==e&&8!==e)throw new s.exception.invalid("invalid aes key size");for(this.a=[n=t.slice(0),a=[]],t=e;t<4*e+28;t++)i=n[t-1],(t%e==0||8===e&&t%e==4)&&(i=r[i>>>24]<<24^r[i>>16&255]<<16^r[i>>8&255]<<8^r[255&i],t%e==0&&(i=i<<8^i>>>24^c<<24,c=c<<1^283*(c>>7))),n[t]=n[t-e]^i;for(e=0;t;e++,t--)i=n[3&e?t:t-4],a[e]=t<=4||e<4?i:o[0][r[i>>>24]]^o[1][r[i>>16&255]]^o[2][r[i>>8&255]]^o[3][r[255&i]]},s.cipher.aes.prototype={encrypt:function(t){return this.H(t,0)},decrypt:function(t){return this.H(t,1)},h:[[[],[],[],[],[]],[[],[],[],[],[]]],w:function(){var t,e,i,n,a,r,s,o=this.h[0],c=this.h[1],l=o[4],u=c[4],h=[],d=[];for(t=0;t<256;t++)d[(h[t]=t<<1^283*(t>>7))^t]=t;for(e=i=0;!l[e];e^=n||1,i=d[i]||1)for(l[e]=r=(r=i^i<<1^i<<2^i<<3^i<<4)>>8^255&r^99,u[r]=e,s=16843009*(a=h[t=h[n=h[e]]])^65537*t^257*n^16843008*e,a=257*h[r]^16843008*r,t=0;t<4;t++)o[t][e]=a=a<<24^a>>>8,c[t][r]=s=s<<24^s>>>8;for(t=0;t<5;t++)o[t]=o[t].slice(0),c[t]=c[t].slice(0)},H:function(t,e){if(4!==t.length)throw new s.exception.invalid("invalid aes block size");var i=this.a[e],n=t[0]^i[0],a=t[e?3:1]^i[1],r=t[2]^i[2];t=t[e?1:3]^i[3];var o,c,l,u,h=i.length/4-2,d=4,f=[0,0,0,0],b=(o=this.h[e])[0],m=o[1],p=o[2],g=o[3],v=o[4];for(u=0;u<h;u++)o=b[n>>>24]^m[a>>16&255]^p[r>>8&255]^g[255&t]^i[d],c=b[a>>>24]^m[r>>16&255]^p[t>>8&255]^g[255&n]^i[d+1],l=b[r>>>24]^m[t>>16&255]^p[n>>8&255]^g[255&a]^i[d+2],t=b[t>>>24]^m[n>>16&255]^p[a>>8&255]^g[255&r]^i[d+3],d+=4,n=o,a=c,r=l;for(u=0;u<4;u++)f[e?3&-u:u]=v[n>>>24]<<24^v[a>>16&255]<<16^v[r>>8&255]<<8^v[255&t]^i[d++],o=n,n=a,a=r,r=t,t=o;return f}},s.bitArray={bitSlice:function(t,e,i){return t=s.bitArray.P(t.slice(e/32),32-(31&e)).slice(1),void 0===i?t:s.bitArray.clamp(t,i-e)},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var i=t[t.length-1],n=s.bitArray.getPartial(i);return 32===n?t.concat(e):s.bitArray.P(e,n,0|i,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+s.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;var i=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,i>0&&e&&(t[i-1]=s.bitArray.partial(e,t[i-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return 32===t?e:(i?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(s.bitArray.bitLength(t)!==s.bitArray.bitLength(e))return!1;var i,n=0;for(i=0;i<t.length;i++)n|=t[i]^e[i];return 0===n},P:function(t,e,i,n){var a;for(a=0,void 0===n&&(n=[]);e>=32;e-=32)n.push(i),i=0;if(0===e)return n.concat(t);for(a=0;a<t.length;a++)n.push(i|t[a]>>>e),i=t[a]<<32-e;return t=s.bitArray.getPartial(a=t.length?t[t.length-1]:0),n.push(s.bitArray.partial(e+t&31,e+t>32?i:n.pop(),1)),n},k:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},s.codec.utf8String={fromBits:function(t){var e,i,n="",a=s.bitArray.bitLength(t);for(e=0;e<a/8;e++)0==(3&e)&&(i=t[e/4]),n+=String.fromCharCode(i>>>24),i<<=8;return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,i=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t.charCodeAt(e),3==(3&e)&&(i.push(n),n=0);return 3&e&&i.push(s.bitArray.partial(8*(3&e),n)),i}},s.codec.hex={fromBits:function(t){var e,i="";for(e=0;e<t.length;e++)i+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return i.substr(0,s.bitArray.bitLength(t)/4)},toBits:function(t){var e,i,n=[];for(i=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)n.push(0^parseInt(t.substr(e,8),16));return s.bitArray.clamp(n,4*i)}},s.codec.base64={D:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e){var i,n="",a=0,r=s.codec.base64.D,o=0,c=s.bitArray.bitLength(t);for(i=0;6*n.length<c;)n+=r.charAt((o^t[i]>>>a)>>>26),a<6?(o=t[i]<<6-a,a+=26,i++):(o<<=6,a-=6);for(;3&n.length&&!e;)n+="=";return n},toBits:function(t){t=t.replace(/\s|=/g,"");var e,i,n=[],a=0,r=s.codec.base64.D,o=0;for(e=0;e<t.length;e++){if((i=r.indexOf(t.charAt(e)))<0)throw new s.exception.invalid("this isn't base64!");a>26?(n.push(o^i>>>(a-=26)),o=i<<32-a):o^=i<<32-(a+=6)}return 56&a&&n.push(s.bitArray.partial(56&a,o,1)),n}},s.hash.sha256=function(t){this.a[0]||this.w(),t?(this.n=t.n.slice(0),this.i=t.i.slice(0),this.e=t.e):this.reset()},s.hash.sha256.hash=function(t){return(new s.hash.sha256).update(t).finalize()},s.hash.sha256.prototype={blockSize:512,reset:function(){return this.n=this.N.slice(0),this.i=[],this.e=0,this},update:function(t){"string"==typeof t&&(t=s.codec.utf8String.toBits(t));var e,i=this.i=s.bitArray.concat(this.i,t);for(t=this.e=(e=this.e)+s.bitArray.bitLength(t),e=512+e&-512;e<=t;e+=512)this.C(i.splice(0,16));return this},finalize:function(){var t,e=this.i,i=this.n;for(t=(e=s.bitArray.concat(e,[s.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.e/4294967296)),e.push(0|this.e);e.length;)this.C(e.splice(0,16));return this.reset(),i},N:[],a:[],w:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,i=0,n=2;t:for(;i<64;n++){for(e=2;e*e<=n;e++)if(n%e==0)continue t;i<8&&(this.N[i]=t(Math.pow(n,.5))),this.a[i]=t(Math.pow(n,1/3)),i++}},C:function(t){var e,i,n=t.slice(0),a=this.n,r=this.a,s=a[0],o=a[1],c=a[2],l=a[3],u=a[4],h=a[5],d=a[6],f=a[7];for(t=0;t<64;t++)e=(e=t<16?n[t]:n[15&t]=((e=n[t+1&15])>>>7^e>>>18^e>>>3^e<<25^e<<14)+((i=n[t+14&15])>>>17^i>>>19^i>>>10^i<<15^i<<13)+n[15&t]+n[t+9&15]|0)+f+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(d^u&(h^d))+r[t],f=d,d=h,h=u,u=l+e|0,l=c,c=o,s=e+((o=s)&c^l&(o^c))+(o>>>2^o>>>13^o>>>22^o<<30^o<<19^o<<10)|0;a[0]=a[0]+s|0,a[1]=a[1]+o|0,a[2]=a[2]+c|0,a[3]=a[3]+l|0,a[4]=a[4]+u|0,a[5]=a[5]+h|0,a[6]=a[6]+d|0,a[7]=a[7]+f|0}},s.mode.ccm={name:"ccm",encrypt:function(t,e,i,n,a){var r,o=e.slice(0),c=s.bitArray,l=c.bitLength(i)/8,u=c.bitLength(o)/8;if(a=a||64,n=n||[],l<7)throw new s.exception.invalid("ccm: iv must be at least 7 bytes");for(r=2;r<4&&u>>>8*r;r++);return r<15-l&&(r=15-l),i=c.clamp(i,8*(15-r)),e=s.mode.ccm.G(t,e,i,n,a,r),o=s.mode.ccm.I(t,o,i,e,a,r),c.concat(o.data,o.tag)},decrypt:function(t,e,i,n,a){a=a||64,n=n||[];var r=s.bitArray,o=r.bitLength(i)/8,c=r.bitLength(e),l=r.clamp(e,c-a),u=r.bitSlice(e,c-a);if(c=(c-a)/8,o<7)throw new s.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;e<4&&c>>>8*e;e++);if(e<15-o&&(e=15-o),i=r.clamp(i,8*(15-e)),l=s.mode.ccm.I(t,l,i,u,a,e),t=s.mode.ccm.G(t,l.data,i,n,a,e),!r.equal(l.tag,t))throw new s.exception.corrupt("ccm: tag doesn't match");return l.data},G:function(t,e,i,n,a,r){var o=[],c=s.bitArray,l=c.k;if((a/=8)%2||a<4||a>16)throw new s.exception.invalid("ccm: invalid tag length");if(n.length>4294967295||e.length>4294967295)throw new s.exception.bug("ccm: can't deal with 4GiB or more data");if(r=[c.partial(8,(n.length?64:0)|a-2<<2|r-1)],(r=c.concat(r,i))[3]|=c.bitLength(e)/8,r=t.encrypt(r),n.length)for((i=c.bitLength(n)/8)<=65279?o=[c.partial(16,i)]:i<=4294967295&&(o=c.concat([c.partial(16,65534)],[i])),o=c.concat(o,n),n=0;n<o.length;n+=4)r=t.encrypt(l(r,o.slice(n,n+4)));for(n=0;n<e.length;n+=4)r=t.encrypt(l(r,e.slice(n,n+4)));return c.clamp(r,8*a)},I:function(t,e,i,n,a,r){var o,c=s.bitArray;o=c.k;var l=e.length,u=c.bitLength(e);if(i=c.concat([c.partial(8,r-1)],i).concat([0,0,0]).slice(0,4),n=c.bitSlice(o(n,t.encrypt(i)),0,a),!l)return{tag:n,data:[]};for(o=0;o<l;o+=4)i[3]++,a=t.encrypt(i),e[o]^=a[0],e[o+1]^=a[1],e[o+2]^=a[2],e[o+3]^=a[3];return{tag:n,data:c.clamp(e,u)}}},s.mode.ocb2={name:"ocb2",encrypt:function(t,e,i,n,a,r){if(128!==s.bitArray.bitLength(i))throw new s.exception.invalid("ocb iv must be 128 bits");var o,c=s.mode.ocb2.A,l=s.bitArray,u=l.k,h=[0,0,0,0];i=c(t.encrypt(i));var d,f=[];for(n=n||[],a=a||64,o=0;o+4<e.length;o+=4)h=u(h,d=e.slice(o,o+4)),f=f.concat(u(i,t.encrypt(u(i,d)))),i=c(i);return d=e.slice(o),e=l.bitLength(d),o=t.encrypt(u(i,[0,0,0,e])),d=l.clamp(u(d,o),e),h=u(h,u(d,o)),h=t.encrypt(u(h,u(i,c(i)))),n.length&&(h=u(h,r?n:s.mode.ocb2.pmac(t,n))),f.concat(l.concat(d,l.clamp(h,a)))},decrypt:function(t,e,i,n,a,r){if(128!==s.bitArray.bitLength(i))throw new s.exception.invalid("ocb iv must be 128 bits");a=a||64;var o,c,l=s.mode.ocb2.A,u=s.bitArray,h=u.k,d=[0,0,0,0],f=l(t.encrypt(i)),b=s.bitArray.bitLength(e)-a,m=[];for(n=n||[],i=0;i+4<b/32;i+=4)o=h(f,t.decrypt(h(f,e.slice(i,i+4)))),d=h(d,o),m=m.concat(o),f=l(f);if(o=t.encrypt(h(f,[0,0,0,c=b-32*i])),o=h(o,u.clamp(e.slice(i),c)),d=h(d,o),d=t.encrypt(h(d,h(f,l(f)))),n.length&&(d=h(d,r?n:s.mode.ocb2.pmac(t,n))),!u.equal(u.clamp(d,a),u.bitSlice(e,b)))throw new s.exception.corrupt("ocb: tag doesn't match");return m.concat(u.clamp(o,c))},pmac:function(t,e){var i,n=s.mode.ocb2.A,a=s.bitArray,r=a.k,o=[0,0,0,0],c=t.encrypt([0,0,0,0]);for(c=r(c,n(n(c))),i=0;i+4<e.length;i+=4)c=n(c),o=r(o,t.encrypt(r(c,e.slice(i,i+4))));return e=e.slice(i),a.bitLength(e)<128&&(c=r(c,n(c)),e=a.concat(e,[-2147483648])),o=r(o,e),t.encrypt(r(n(r(c,n(c))),o))},A:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},s.misc.hmac=function(t,e){this.M=e=e||s.hash.sha256;var i=[[],[]],n=e.prototype.blockSize/32;for(this.l=[new e,new e],t.length>n&&(t=e.hash(t)),e=0;e<n;e++)i[0][e]=909522486^t[e],i[1][e]=1549556828^t[e];this.l[0].update(i[0]),this.l[1].update(i[1])},s.misc.hmac.prototype.encrypt=s.misc.hmac.prototype.mac=function(t,e){return t=new this.M(this.l[0]).update(t,e).finalize(),new this.M(this.l[1]).update(t).finalize()},s.misc.pbkdf2=function(t,e,i,n,a){if(i=i||1e3,n<0||i<0)throw s.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=s.codec.utf8String.toBits(t)),t=new(a=a||s.misc.hmac)(t);var r,o,c,l,u=[],h=s.bitArray;for(l=1;32*u.length<(n||1);l++){for(a=r=t.encrypt(h.concat(e,[l])),o=1;o<i;o++)for(r=t.encrypt(r),c=0;c<r.length;c++)a[c]^=r[c];u=u.concat(a)}return n&&(u=h.clamp(u,n)),u},s.random={randomWords:function(t,e){var i,n=[];if(0===(e=this.isReady(e)))throw new s.exception.notready("generator isn't seeded");for(2&e&&this.U(!(1&e)),e=0;e<t;e+=4)(e+1)%65536==0&&this.L(),i=this.u(),n.push(i[0],i[1],i[2],i[3]);return this.L(),n.slice(0,t)},setDefaultParanoia:function(t){this.t=t},addEntropy:function(t,e,i){i=i||"user";var n,a,r=(new Date).valueOf(),o=this.q[i],c=this.isReady();switch(void 0===(n=this.F[i])&&(n=this.F[i]=this.R++),void 0===o&&(o=this.q[i]=0),this.q[i]=(this.q[i]+1)%this.b.length,typeof t){case"number":break;case"object":if(void 0===e)for(i=e=0;i<t.length;i++)for(a=t[i];a>0;)e++,a>>>=1;this.b[o].update([n,this.J++,2,e,r,t.length].concat(t));break;case"string":void 0===e&&(e=t.length),this.b[o].update([n,this.J++,3,e,r,t.length]),this.b[o].update(t);break;default:throw new s.exception.bug("random: addEntropy only supports number, array or string")}this.j[o]+=e,this.f+=e,0===c&&(0!==this.isReady()&&this.K("seeded",Math.max(this.g,this.f)),this.K("progress",this.getProgress()))},isReady:function(t){return t=this.B[void 0!==t?t:this.t],this.g&&this.g>=t?this.j[0]>80&&(new Date).valueOf()>this.O?3:1:this.f>=t?2:0},getProgress:function(t){return this.g>=(t=this.B[t||this.t])?1[0]:this.f>t?1[0]:this.f/t},startCollectors:function(){if(!this.m){if(window.addEventListener)window.addEventListener("load",this.o,!1),window.addEventListener("mousemove",this.p,!1);else{if(!document.attachEvent)throw new s.exception.bug("can't attach event");document.attachEvent("onload",this.o),document.attachEvent("onmousemove",this.p)}this.m=!0}},stopCollectors:function(){this.m&&(window.removeEventListener?(window.removeEventListener("load",this.o),window.removeEventListener("mousemove",this.p)):window.detachEvent&&(window.detachEvent("onload",this.o),window.detachEvent("onmousemove",this.p)),this.m=!1)},addEventListener:function(t,e){this.r[t][this.Q++]=e},removeEventListener:function(t,e){var i;t=this.r[t];var n=[];for(i in t)t.hasOwnProperty[i]&&t[i]===e&&n.push(i);for(e=0;e<n.length;e++)delete t[i=n[e]]},b:[new s.hash.sha256],j:[0],z:0,q:{},J:0,F:{},R:0,g:0,f:0,O:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],s:void 0,t:6,m:!1,r:{progress:{},seeded:{}},Q:0,B:[0,48,64,96,128,192,256,384,512,768,1024],u:function(){for(var t=0;t<4&&(this.d[t]=this.d[t]+1|0,!this.d[t]);t++);return this.s.encrypt(this.d)},L:function(){this.a=this.u().concat(this.u()),this.s=new s.cipher.aes(this.a)},T:function(t){for(this.a=s.hash.sha256.hash(this.a.concat(t)),this.s=new s.cipher.aes(this.a),t=0;t<4&&(this.d[t]=this.d[t]+1|0,!this.d[t]);t++);},U:function(t){var e,i=[],n=0;for(this.O=i[0]=(new Date).valueOf()+3e4,e=0;e<16;e++)i.push(4294967296*Math.random()|0);for(e=0;e<this.b.length&&(i=i.concat(this.b[e].finalize()),n+=this.j[e],this.j[e]=0,t||!(this.z&1<<e));e++);this.z>=1<<this.b.length&&(this.b.push(new s.hash.sha256),this.j.push(0)),this.f-=n,n>this.g&&(this.g=n),this.z++,this.T(i)},p:function(t){s.random.addEntropy([t.x||t.clientX||t.offsetX,t.y||t.clientY||t.offsetY],2,"mouse")},o:function(){s.random.addEntropy(new Date,2,"loadtime")},K:function(t,e){var i;t=s.random.r[t];var n=[];for(i in t)t.hasOwnProperty(i)&&n.push(t[i]);for(i=0;i<n.length;i++)n[i](e)}},s.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,e,i,n){i=i||{},n=n||{};var a=s.json,r=a.c({iv:s.random.randomWords(4,0)},a.defaults);if(a.c(r,i),"string"==typeof r.salt&&(r.salt=s.codec.base64.toBits(r.salt)),"string"==typeof r.iv&&(r.iv=s.codec.base64.toBits(r.iv)),!s.mode[r.mode]||!s.cipher[r.cipher]||"string"==typeof t&&r.iter<=100||64!==r.ts&&96!==r.ts&&128!==r.ts||128!==r.ks&&192!==r.ks&&256!==r.ks||r.iv.length<2||r.iv.length>4)throw new s.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t&&(t=(i=s.misc.cachedPbkdf2(t,r)).key.slice(0,r.ks/32),r.salt=i.salt),"string"==typeof e&&(e=s.codec.utf8String.toBits(e)),i=new s.cipher[r.cipher](t),a.c(n,r),n.key=t,r.ct=s.mode[r.mode].encrypt(i,e,r.iv,r.adata,r.tag),a.encode(a.V(r,a.defaults))},decrypt:function(t,e,i,n){i=i||{},n=n||{};var a=s.json;if("string"==typeof(e=a.c(a.c(a.c({},a.defaults),a.decode(e)),i,!0)).salt&&(e.salt=s.codec.base64.toBits(e.salt)),"string"==typeof e.iv&&(e.iv=s.codec.base64.toBits(e.iv)),!s.mode[e.mode]||!s.cipher[e.cipher]||"string"==typeof t&&e.iter<=100||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||!e.iv||e.iv.length<2||e.iv.length>4)throw new s.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t&&(t=(i=s.misc.cachedPbkdf2(t,e)).key.slice(0,e.ks/32),e.salt=i.salt),i=new s.cipher[e.cipher](t),i=s.mode[e.mode].decrypt(i,e.ct,e.iv,e.adata,e.tag),a.c(n,e),n.key=t,s.codec.utf8String.fromBits(i)},encode:function(t){var e,i="{",n="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new s.exception.invalid("json encode: invalid property name");switch(i+=n+e+":",n=",",typeof t[e]){case"number":case"boolean":i+=t[e];break;case"string":i+='"'+escape(t[e])+'"';break;case"object":i+='"'+s.codec.base64.fromBits(t[e],1)+'"';break;default:throw new s.exception.bug("json encode: unsupported type")}}return i+"}"},decode:function(t){if(!(t=t.replace(/\s/g,"")).match(/^\{.*\}$/))throw new s.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var e,i,n={};for(e=0;e<t.length;e++){if(!(i=t[e].match(/^([a-z][a-z0-9]*):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new s.exception.invalid("json decode: this isn't json!");n[i[1]]=i[2]?parseInt(i[2],10):i[1].match(/^(ct|salt|iv)$/)?s.codec.base64.toBits(i[3]):unescape(i[3])}return n},c:function(t,e,i){if(void 0===t&&(t={}),void 0===e)return t;var n;for(n in e)if(e.hasOwnProperty(n)){if(i&&void 0!==t[n]&&t[n]!==e[n])throw new s.exception.invalid("required parameter overridden");t[n]=e[n]}return t},V:function(t,e){var i,n={};for(i in t)t.hasOwnProperty(i)&&t[i]!==e[i]&&(n[i]=t[i]);return n},W:function(t,e){var i,n={};for(i=0;i<e.length;i++)void 0!==t[e[i]]&&(n[e[i]]=t[e[i]]);return n}},s.encrypt=s.json.encrypt,s.decrypt=s.json.decrypt,s.misc.S={},s.misc.cachedPbkdf2=function(t,e){var i,n=s.misc.S;return i=(e=e||{}).iter||1e3,(i=(n=n[t]=n[t]||{})[i]=n[i]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):s.random.randomWords(2,0)})[n=void 0===e.salt?i.firstSalt:e.salt]=i[n]||s.misc.pbkdf2(t,n,e.iter),{key:i[n].slice(0),salt:n.slice(0)}};var o={},c=(function(){function t(t){var e=window.btoa(t);return(e=(e=e.split("=")[0]).replace(/\+/g,"-")).replace(/\//g,"_")}function e(t){var e=t;switch((e=(e=e.replace(/-/g,"+")).replace(/_/g,"/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new a("Illegal base64url string!")}return window.atob(e)}function i(t){this.message=t,this.toString=function(){return"No such algorithm: "+this.message}}function n(t){this.message=t,this.toString=function(){return"Not implemented: "+this.message}}function a(t){this.message=t,this.toString=function(){return"Malformed input: "+this.message}}function r(t,e){if("sha256"!=t)throw new i("HMAC does not support hash "+t);this.hash=s.hash.sha256,this.key=s.codec.utf8String.toBits(e)}function c(t,e){if("sha1"==t)this.hash="sha1";else{if("sha256"!=t)throw new i("JWT algorithm: "+t);this.hash="sha256"}this.keyPEM=e}function l(t,e){this.objectStr=t,this.pkAlgorithm=e}r.prototype={update:function(t){this.data=t},finalize:function(){},sign:function(){var e=new s.misc.hmac(this.key,this.hash).encrypt(this.data);return t(window.atob(s.codec.base64.fromBits(e)))},verify:function(e){var i=new s.misc.hmac(this.key,this.hash).encrypt(this.data);return t(window.atob(s.codec.base64.fromBits(i)))==e}},c.prototype={update:function(t){this.data=t},finalize:function(){},sign:function(){var i=new RSAKey;i.readPrivateKeyFromPEMString(this.keyPEM);var n=i.signString(this.data,this.hash);return t(e(hex2b64(n)))},verify:function(t){return this.keyPEM.verifyString(this.data,function(t){var e,i,n="",a=0;for(e=0;e<t.length;++e){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".indexOf(t.charAt(e));r<0||(0==a?(n+=int2char(r>>2),i=3&r,a=1):1==a?(n+=int2char(i<<2|r>>4),i=15&r,a=2):2==a?(n+=int2char(i),n+=int2char(r>>2),i=3&r,a=3):(n+=int2char(i<<2|r>>4),n+=int2char(15&r),a=0))}return 1==a&&(n+=int2char(i<<2)),n}(t))}};var u={parse:function(t){var i=t.split(".");if(3!=i.length)throw new MalformedWebToken("Must have three parts");var n=new l;return n.headerSegment=i[0],n.payloadSegment=i[1],n.cryptoSegment=i[2],n.pkAlgorithm=e(i[0]),n}};function h(t){return"string"==typeof t?JSON.parse(t):t}function d(t,e){if("ES256"===t)throw new n("ECDSA-SHA256 not yet implemented");if("ES384"===t)throw new n("ECDSA-SHA384 not yet implemented");if("ES512"===t)throw new n("ECDSA-SHA512 not yet implemented");if("HS256"===t)return new r("sha256",e);if("HS384"===t)throw new n("HMAC-SHA384 not yet implemented");if("HS512"===t)throw new n("HMAC-SHA512 not yet implemented");if("RS256"===t)return new c("sha256",e);throw"RS384"===t?new n("RSA-SHA384 not yet implemented"):"RS512"===t?new n("RSA-SHA512 not yet implemented"):new i("Unknown algorithm: "+t)}l.prototype={serialize:function(e){var i=d(h(this.pkAlgorithm).alg,e),n=t(this.pkAlgorithm),a=t(this.objectStr);return i.update(n+"."+a),i.finalize(),n+"."+a+"."+i.sign()},verify:function(t){var e=d(h(this.pkAlgorithm).alg,t);return e.update(this.headerSegment+"."+this.payloadSegment),e.finalize(),e.verify(this.cryptoSegment)}},o.WebToken=l,o.WebTokenParser=u,o.base64urlencode=t,o.base64urldecode=e}(),i("fXoL"));i.d(e,"a",(function(){return u}));var l,u=((l=function(){function t(e){_classCallCheck(this,t),this.http=e,this.hasToken=!1,localStorage.getItem("jwt")&&(this.hasToken=!0)}return _createClass(t,[{key:"doLogin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t;e||(localStorage.setItem("dsm",t.dsmport),i=this.encode(t));var n={headers:new a.c({"X-Cred":i})};return this.http.post("".concat(localStorage.getItem("dsm"),"/login"),null,n).pipe(Object(r.a)(this.handleError))}},{key:"autoLogin",value:function(){var t=localStorage.getItem("jwt");return t?this.doLogin(t,!0):(localStorage.removeItem("jwt"),Object(n.a)(null))}},{key:"encode",value:function(t){return new o.WebToken(JSON.stringify(t),JSON.stringify({alg:"HS256",typ:"JWT"})).serialize("jsmusicdbnext")}},{key:"handleError",value:function(t){return Object(n.a)(null)}}]),t}()).\u0275fac=function(t){return new(t||l)(c.Sb(a.a))},l.\u0275prov=c.Hb({token:l,factory:l.\u0275fac}),l)},XtVx:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("XNiG"),a=i("fXoL"),r=function(){var t=function(){function t(){_classCallCheck(this,t),this.pathAnnouncementSource=new n.a,this.pageAnnouncementSource=new n.a,this.pathAnnounced$=this.pathAnnouncementSource.asObservable(),this.pageAnnounced$=this.pageAnnouncementSource.asObservable()}return _createClass(t,[{key:"announcePath",value:function(t){this.pathAnnouncementSource.next(t)}},{key:"announcePage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pageAnnouncementSource.next({page:t,letter:e})}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=a.Hb({token:t,factory:t.\u0275fac}),t}()},crnd:function(t,e){function i(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id="crnd"},hDf6:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("ofXK"),a=i("fXoL"),r=function(){var t=function t(){_classCallCheck(this,t)};return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},imports:[[n.c]]}),t}()},ktVm:function(t,e,i){"use strict";var n=i("XNiG"),a=i("/1T7"),r=i("LNEh"),s=i("o8Y7"),o=function(){function t(e){_classCallCheck(this,t),this.artists=[],this.active=!1,e.album&&e.title&&(this.letter=e.letter||this.getFirstLetterOf(e.albumArtist||e.albumartist||e.artist),"1"===this.letter&&(this.letter="#"),this.escapedLetter=encodeURIComponent(this.letter))}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.escapedLetter,"/")}},{key:"sortArtistsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sortName",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.artists.sort("albums"===t?function(t,i){return t.albums.length>i.albums.length?"asc"===e?-1:1:t.albums.length<i.albums.length?"asc"===e?1:-1:0}:function(i,n){if(-1!==t.indexOf(".")){var a=t.split(".");return i[a[0]][a[1]]<n[a[0]][a[1]]?"asc"===e?-1:1:i[a[0]][a[1]]>n[a[0]][a[1]]?"asc"===e?1:-1:0}return i[t].toUpperCase()<n[t].toUpperCase()?"asc"===e?-1:1:i[t].toUpperCase()>n[t].toUpperCase()?"asc"===e?1:-1:0})}},{key:"sortAndReturnArtistsBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return this.sortArtistsBy(t,e),this.artists}},{key:"getFirstLetterOf",value:function(t){var e="";return e=this.stripFromName(t,["the ",'"',"a "]),this.groupIfSpecialChar(e.substr(0,1))}},{key:"stripFromName",value:function(t,e){var i=t?t.toUpperCase():"";return i=i.trim(),e.forEach((function(t){var e=t.toUpperCase();0===i.indexOf(e)&&(i=i.substring(e.length))})),Object(s.a)(i)}},{key:"groupIfSpecialChar",value:function(t){return-1!==["1","2","3","4","5","6","7","8","9","0","(",")","[","]","{","}","_","-","."].indexOf(t)?"#":t}}]),t}(),c=i("/+cc"),l=i.n(c),u=function t(){var e=this;_classCallCheck(this,t),this.doSearch=function(t){var i=t.query,n=t.keys,a=void 0===n?["name"]:n,r=t.list;return new l.a(r,e.options(a)).search(i)},this.options=function(t){return{keys:t,threshold:.25,shouldSort:!0}}},h=i("uwnU"),d=function t(e){_classCallCheck(this,t),this.albums=[],this.sanitize=function(t){var e=parseInt(t,10);return isNaN(e)&&(e=0),e},e.year&&(this.year=this.sanitize(e.year))},f=function(){function t(){_classCallCheck(this,t),this.artists={},this.albums={},this.tracks={},this.letters={},this.years={},this.sortedLetters=[],this.sortedAlbums=[],this.isCoreParsed=!1,this.coreParsedSource=new n.a,this.coreParsed$=this.coreParsedSource.asObservable(),this.totals={artists:0,albums:0,tracks:0,playingTime:0,parsingTime:0},this.latestAdditions=[],this.search=new u,console.info("Core init 1.6.0")}return _createClass(t,[{key:"resetCollection",value:function(){this.artists={},this.albums={},this.tracks={},this.letters={},this.years={},this.sortedLetters=[],this.sortedAlbums=[],this.totals={artists:0,albums:0,tracks:0,playingTime:0,parsingTime:0},this.latestAdditions=[]}},{key:"parseSourceJson",value:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(new Date).getTime();if(t.length){var a=!0,r=!1,s=void 0;try{for(var o,c=t[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){var l=o.value;this.parseLine(l,i)}}catch(d){r=!0,s=d}finally{try{a||null==c.return||c.return()}finally{if(r)throw s}}}else t.tree&&this.parseTree(t.tree);var u=Object.keys(this.letters).sort((function(t,e){return t<e?-1:1})),h=[];u.forEach((function(t,i){h.push(e.letters[t]),e.letters[t].sortAndReturnArtistsBy("name","asc")})),this.sortedLetters=h,this.totals.parsingTime+=(new Date).getTime()-n,this.coreParsedSource.next(!0),this.isCoreParsed=!0}},{key:"getTrackByArtistAndName",value:function(t,e){var i=new r.a({name:t,dummy:!0}),n=this.artists[i.sortName],a=null;return n&&n.albums.some((function(t){t.tracks.some((function(t){if(t.title&&t.title.toLowerCase()===e.toLowerCase())return a||(a=t),!0}))})),a}},{key:"getTrackById",value:function(t){var e=new h.a({});return this.tracks.forEach((function(i){i.id===t&&(e=i)})),e}},{key:"getArtistByName",value:function(t){var e=new r.a({name:t,dummy:!0});return this.artists[e.sortName]}},{key:"getAlbumByArtistAndName",value:function(t,e){var i=null;return t.albums.forEach((function(t){t.name.toLowerCase()===e.toLowerCase()&&(i=t)})),i}},{key:"getTrackByAlbumAndName",value:function(t,e){var i=null;return t.tracks.forEach((function(t){t.title.toLowerCase()===e.toLowerCase()&&(i=t)})),i}},{key:"artistsList",value:function(){var t=this,e=[];return Object.keys(this.artists).sort((function(t,e){return t<e?-1:1})).forEach((function(i,n){e.push(t.artists[i])})),e}},{key:"trackList",value:function(){var t=this,e=[];return Object.keys(this.tracks).sort((function(t,e){return t<e?-1:1})).forEach((function(i,n){e.push(t.tracks[i])})),e}},{key:"searchArtist",value:function(t){return this.search.doSearch({query:t,list:this.artistsList()})}},{key:"searchAlbum",value:function(t){return this.search.doSearch({query:t,list:this.sortedAlbums})}},{key:"searchTrack",value:function(t){return this.search.doSearch({query:t,keys:["title"],list:this.trackList()})}},{key:"getLatestAdditions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:14;return 0!==this.latestAdditions.length?this.latestAdditions:(this.sortedAlbums.sort((function(t,e){return t.modified>e.modified?-1:t.modified<e.modified?1:0})),this.latestAdditions=this.sortedAlbums.splice(0,t),this.latestAdditions)}},{key:"getNextAlbum",value:function(t){var e=t.artist,i=e.albums.indexOf(t),n=e.albums[i+1];return n||(n=this.getNextArtist(e).albums[0]),n}},{key:"getNextArtist",value:function(t){var e=t.letter,i=e.artists.indexOf(t),n=e.artists[i+1];return n||(n=this.getNextLetter(e).artists[0]),n}},{key:"getNextLetter",value:function(t){var e=this.sortedLetters.indexOf(t),i=this.sortedLetters[e+1];return i||(i=this.sortedLetters[0]),i}},{key:"instanceIfPresent",value:function(t,e,i,n,a){var r=null;return i[e]?r=i[e]:(i[e]=n,r=n,a(t)),r}},{key:"handleLetter",value:function(t){return this.instanceIfPresent(this,t.letter,this.letters,t,(function(t){}))}},{key:"handleArtist",value:function(t,e){return this.instanceIfPresent(this,e.sortName,this.artists,e,(function(i){t.artists.push(e),e.letter=t,i.totals.artists++}))}},{key:"handleAlbum",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.instanceIfPresent(this,t.sortName+"|"+e.sortName,this.albums,e,(function(n){if("flac"===e.type&&i||"flac"!==e.type)if(e.artist=t,t.albums.push(e),t.sortAndReturnAlbumsBy("year","asc"),n.sortedAlbums.push(e),n.totals.albums++,n.years[e.year])n.years[e.year].albums.push(e);else{var a=new d(e);a.albums.push(e),n.years[a.year]=a}}))}},{key:"handleTrack",value:function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.instanceIfPresent(this,i.id,this.tracks,i,(function(a){if(e.type=e.type&&e.type!==i.type?"mixed":i.type,"flac"===i.type&&n||"flac"!==i.type){a.totals.tracks++,a.totals.playingTime+=i.duration,i.artist=t,i.album=e,e.tracks.push(i);var r=i.disc;e.discs["disc-".concat(r)]?e.discs["disc-".concat(r)].push(i):(e.discs["disc-".concat(r)]=[],e.discs["disc-".concat(r)].push(i)),e.discs["disc-".concat(r)].sort((function(t,e){return t.number<e.number?-1:1})),e.tracks.sort((function(t,e){return t.disc<e.disc?-1:t.disc===e.disc&&t.number<e.number?-1:1}))}else console.warn("skipping flac track, flac is not supported")}))}},{key:"parseLine",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new o(t);i.letter&&(i=this.handleLetter(i));var n=new r.a(t);n.name&&(n=this.handleArtist(i,n));var s=new a.a(t);s.name&&(s=this.handleAlbum(n,s,e));var c=new h.a(t);c.title&&(c=this.handleTrack(n,s,c,e))}},{key:"parseTree",value:function(t){for(var e in t){var i=new o(t[e]);for(var n in i=this.handleLetter(i),t[e].artists){var s=new r.a(t[e].artists[n]);for(var c in s=this.handleArtist(i,s),t[e].artists[n].albums){var l=new a.a(t[e].artists[n].albums[c]);for(var u in l=this.handleAlbum(s,l),t[e].artists[n].albums[c].tracks){var d=new h.a(t[e].artists[n].albums[c].tracks[u]);d=this.handleTrack(s,l,d)}}}}}}]),t}(),b=i("fXoL");i.d(e,"a",(function(){return p}));var m,p=((m=function(){function t(){_classCallCheck(this,t),this.core=new f}return _createClass(t,[{key:"getCore",value:function(){return this.core}}]),t}()).\u0275fac=function(t){return new(t||m)},m.\u0275prov=b.Hb({token:m,factory:m.\u0275fac}),m)},t083:function(t,e,i){"use strict";var n=i("XNiG"),a=i("z6cu"),r=i("JIr8"),s=i("tk/3"),o=i("ztCj"),c=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"encodeKey",value:function(t){return encodeURIComponent(t)}},{key:"encodeValue",value:function(t){return encodeURIComponent(t)}},{key:"decodeKey",value:function(t){return decodeURIComponent(t)}},{key:"decodeValue",value:function(t){return decodeURIComponent(t)}}]),t}(),l=i("fXoL");i.d(e,"a",(function(){return f}));var u,h="956c1818ded606576d6941de5ff793a5",d="4d183e73f7578dee78557665e9be3acc",f=((u=function(){function t(e){_classCallCheck(this,t),this.http=e,this.manualScrobbleListSource=new n.a,this.manualScrobbleList$=this.manualScrobbleListSource.asObservable(),this.hexcase=0,this.b64pad=""}return _createClass(t,[{key:"getLovedTracks",value:function(t){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{api_key:h,format:"json",limit:"1000",method:"user.getlovedtracks",user:t}}).pipe(Object(r.a)(this.handleError))}},{key:"toggleLoved",value:function(t){var e=localStorage.getItem("lastfm-token"),i=(new URLSearchParams,t.isLoved?"track.love":"track.unlove"),n=new s.d({encoder:new c}).set("method",i).set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,null,e,i)).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("sk",e),a=new s.c({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:n,headers:a}).pipe(Object(r.a)(this.handleError))}},{key:"getTrackInfo",value:function(t,e){if(t){var i=new s.d({encoder:new c}).set("method","track.getInfo").set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("api_key",h).set("format","json").set("user",e);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:i}).pipe(Object(r.a)(this.handleError))}return Object(a.a)(null)}},{key:"getTopArtists",value:function(t){var e=new s.d({encoder:new c}).set("api_key",h).set("format","json").set("limit","50").set("method","user.gettopartists").set("period","1month").set("user",t);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:e}).pipe(Object(r.a)(this.handleError))}},{key:"getSimilairArtists",value:function(t){var e=new s.d({encoder:new c}).set("api_key",h).set("format","json").set("limit","20").set("autocorrect","1").set("method","artist.getSimilar").set("artist",t.name);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:e}).pipe(Object(r.a)(this.handleError))}},{key:"authenticate",value:function(t){var e=new s.d({encoder:new c}).set("api_key",h).set("api_sig",this.signAuthentication(t.user,t.password)).set("format","json").set("username",t.user).set("password",t.password),i=new s.c({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post("https://ws.audioscrobbler.com/2.0/?method=auth.getMobileSession",null,{params:e,headers:i}).pipe(Object(r.a)(this.handleError))}},{key:"announceNowPlaying",value:function(t){if("mdb-skipped"!==localStorage.getItem("lastfm-username")){var e=new Date,i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()+e.getTimezoneOffset(),e.getSeconds())/1e3,n=localStorage.getItem("lastfm-token"),a=new s.c({"Content-Type":"application/x-www-form-urlencoded"}),o=new s.d({encoder:new c}).set("method","track.updateNowPlaying").set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,i,n,"track.updateNowPlaying")).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("timestamp",i.toString()).set("sk",n);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:o,headers:a}).pipe(Object(r.a)(this.handleError))}}},{key:"scrobbleTrack",value:function(t){var e=this,i=localStorage.getItem("lastfm-username"),n=new Date,a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+n.getTimezoneOffset(),n.getSeconds())/1e3;if("mdb-skipped"!==i){var l=localStorage.getItem("lastfm-token");if(!this.booleanState("manual-scrobble-state")){var u=new s.c({"Content-Type":"application/x-www-form-urlencoded"}),d=new s.d({encoder:new c}).set("method","track.scrobble").set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,a,l,"track.scrobble")).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("timestamp",a.toString()).set("sk",l);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:d,headers:u}).pipe(Object(r.a)(this.handleError))}Object(o.c)("manual-scrobble-list").then((function(i){var n=i||[],r={artist:t.trackArtist,album:t.album.name,track:t.title,timestamp:a.toString()};n.unshift(r),Object(o.d)("manual-scrobble-list",n),e.manualScrobbleListSource.next(n)}))}else{var f="art-".concat(t.trackArtist,"-").concat(t.album.name);Object(o.c)(f).then((function(i){e.saveInLocal(t,a,i||"global/images/no-cover.png")}))}}},{key:"updateManualScrobbleList",value:function(){var t=this;Object(o.c)("manual-scrobble-list").then((function(e){t.manualScrobbleListSource.next(e||[])}))}},{key:"saveInLocal",value:function(t,e,i){var n={artist:{"#text":t.trackArtist},album:{"#text":t.album.name},image:[{"#text":i}],name:t.title,date:{uts:e}},a=[];Object(o.c)("recentlyListened").then((function(t){t&&((a=t.tracks).length>10&&(a=a.splice(0,10)),t._rev),a.unshift(n);var e={_id:"recentlyListened",tracks:a};Object(o.d)(e._id,e.tracks)}))}},{key:"scrobbleCachedTrack",value:function(t){var e=localStorage.getItem("lastfm-token"),i=new s.c({"Content-Type":"application/x-www-form-urlencoded"}),n=new s.d({encoder:new c}).set("method","track.scrobble").set("api_key",h).set("api_sig",this.signTrack(t.artist,t.album,t.track,t.timestamp,e,"track.scrobble")).set("artist",t.artist).set("album",t.album).set("track",t.track).set("timestamp",t.timestamp.toString()).set("sk",e);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:n,headers:i,responseType:"text"}).pipe(Object(r.a)(this.handleError))}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}},{key:"signAuthentication",value:function(t,e){return this.hex_md5("api_key".concat(h,"methodauth.getMobileSessionpassword").concat(e,"username").concat(t).concat(d))}},{key:"signTrack",value:function(t,e,i,n,a,r){return this.hex_md5(n?"album".concat(e,"api_key").concat(h,"artist").concat(t,"method").concat(r,"sk").concat(a,"timestamp").concat(n,"track").concat(i).concat(d):"album".concat(e,"api_key").concat(h,"artist").concat(t,"method").concat(r,"sk").concat(a,"track").concat(i).concat(d))}},{key:"handleError",value:function(t){return Object(a.a)(null)}},{key:"hex_md5",value:function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))}},{key:"rstr2hex",value:function(t){try{this.hexcase=this.hexcase}catch(r){this.hexcase=0}for(var e,i=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",a=0;a<t.length;a++)e=t.charCodeAt(a),n+=i.charAt(e>>>4&15)+i.charAt(15&e);return n}},{key:"rstr_md5",value:function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))}},{key:"str2rstr_utf8",value:function(t){for(var e,i,n="",a=-1;++a<t.length;)e=t.charCodeAt(a),i=a+1<t.length?t.charCodeAt(a+1):0,55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e=65536+((1023&e)<<10)+(1023&i),a++),e<=127?n+=String.fromCharCode(e):e<=2047?n+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n}},{key:"binl2rstr",value:function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e}},{key:"binl_md5",value:function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,n=-271733879,a=-1732584194,r=271733878,s=0;s<t.length;s+=16){var o=i,c=n,l=a,u=r;i=this.md5_ff(i,n,a,r,t[s+0],7,-680876936),r=this.md5_ff(r,i,n,a,t[s+1],12,-389564586),a=this.md5_ff(a,r,i,n,t[s+2],17,606105819),n=this.md5_ff(n,a,r,i,t[s+3],22,-1044525330),i=this.md5_ff(i,n,a,r,t[s+4],7,-176418897),r=this.md5_ff(r,i,n,a,t[s+5],12,1200080426),a=this.md5_ff(a,r,i,n,t[s+6],17,-1473231341),n=this.md5_ff(n,a,r,i,t[s+7],22,-45705983),i=this.md5_ff(i,n,a,r,t[s+8],7,1770035416),r=this.md5_ff(r,i,n,a,t[s+9],12,-1958414417),a=this.md5_ff(a,r,i,n,t[s+10],17,-42063),n=this.md5_ff(n,a,r,i,t[s+11],22,-1990404162),i=this.md5_ff(i,n,a,r,t[s+12],7,1804603682),r=this.md5_ff(r,i,n,a,t[s+13],12,-40341101),a=this.md5_ff(a,r,i,n,t[s+14],17,-1502002290),n=this.md5_ff(n,a,r,i,t[s+15],22,1236535329),i=this.md5_gg(i,n,a,r,t[s+1],5,-165796510),r=this.md5_gg(r,i,n,a,t[s+6],9,-1069501632),a=this.md5_gg(a,r,i,n,t[s+11],14,643717713),n=this.md5_gg(n,a,r,i,t[s+0],20,-373897302),i=this.md5_gg(i,n,a,r,t[s+5],5,-701558691),r=this.md5_gg(r,i,n,a,t[s+10],9,38016083),a=this.md5_gg(a,r,i,n,t[s+15],14,-660478335),n=this.md5_gg(n,a,r,i,t[s+4],20,-405537848),i=this.md5_gg(i,n,a,r,t[s+9],5,568446438),r=this.md5_gg(r,i,n,a,t[s+14],9,-1019803690),a=this.md5_gg(a,r,i,n,t[s+3],14,-187363961),n=this.md5_gg(n,a,r,i,t[s+8],20,1163531501),i=this.md5_gg(i,n,a,r,t[s+13],5,-1444681467),r=this.md5_gg(r,i,n,a,t[s+2],9,-51403784),a=this.md5_gg(a,r,i,n,t[s+7],14,1735328473),n=this.md5_gg(n,a,r,i,t[s+12],20,-1926607734),i=this.md5_hh(i,n,a,r,t[s+5],4,-378558),r=this.md5_hh(r,i,n,a,t[s+8],11,-2022574463),a=this.md5_hh(a,r,i,n,t[s+11],16,1839030562),n=this.md5_hh(n,a,r,i,t[s+14],23,-35309556),i=this.md5_hh(i,n,a,r,t[s+1],4,-1530992060),r=this.md5_hh(r,i,n,a,t[s+4],11,1272893353),a=this.md5_hh(a,r,i,n,t[s+7],16,-155497632),n=this.md5_hh(n,a,r,i,t[s+10],23,-1094730640),i=this.md5_hh(i,n,a,r,t[s+13],4,681279174),r=this.md5_hh(r,i,n,a,t[s+0],11,-358537222),a=this.md5_hh(a,r,i,n,t[s+3],16,-722521979),n=this.md5_hh(n,a,r,i,t[s+6],23,76029189),i=this.md5_hh(i,n,a,r,t[s+9],4,-640364487),r=this.md5_hh(r,i,n,a,t[s+12],11,-421815835),a=this.md5_hh(a,r,i,n,t[s+15],16,530742520),n=this.md5_hh(n,a,r,i,t[s+2],23,-995338651),i=this.md5_ii(i,n,a,r,t[s+0],6,-198630844),r=this.md5_ii(r,i,n,a,t[s+7],10,1126891415),a=this.md5_ii(a,r,i,n,t[s+14],15,-1416354905),n=this.md5_ii(n,a,r,i,t[s+5],21,-57434055),i=this.md5_ii(i,n,a,r,t[s+12],6,1700485571),r=this.md5_ii(r,i,n,a,t[s+3],10,-1894986606),a=this.md5_ii(a,r,i,n,t[s+10],15,-1051523),n=this.md5_ii(n,a,r,i,t[s+1],21,-2054922799),i=this.md5_ii(i,n,a,r,t[s+8],6,1873313359),r=this.md5_ii(r,i,n,a,t[s+15],10,-30611744),a=this.md5_ii(a,r,i,n,t[s+6],15,-1560198380),n=this.md5_ii(n,a,r,i,t[s+13],21,1309151649),i=this.md5_ii(i,n,a,r,t[s+4],6,-145523070),r=this.md5_ii(r,i,n,a,t[s+11],10,-1120210379),a=this.md5_ii(a,r,i,n,t[s+2],15,718787259),n=this.md5_ii(n,a,r,i,t[s+9],21,-343485551),i=this.safe_add(i,o),n=this.safe_add(n,c),a=this.safe_add(a,l),r=this.safe_add(r,u)}return Array(i,n,a,r)}},{key:"rstr2binl",value:function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e}},{key:"md5_cmn",value:function(t,e,i,n,a,r){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(n,r)),a),i)}},{key:"md5_ff",value:function(t,e,i,n,a,r,s){return this.md5_cmn(e&i|~e&n,t,e,a,r,s)}},{key:"md5_gg",value:function(t,e,i,n,a,r,s){return this.md5_cmn(e&n|i&~n,t,e,a,r,s)}},{key:"md5_hh",value:function(t,e,i,n,a,r,s){return this.md5_cmn(e^i^n,t,e,a,r,s)}},{key:"md5_ii",value:function(t,e,i,n,a,r,s){return this.md5_cmn(i^(e|~n),t,e,a,r,s)}},{key:"safe_add",value:function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}},{key:"bit_rol",value:function(t,e){return t<<e|t>>>32-e}}]),t}()).\u0275fac=function(t){return new(t||u)(l.Sb(s.a))},u.\u0275prov=l.Hb({token:u,factory:u.\u0275fac}),u)},ufXC:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i("ztCj"),a=i("XNiG"),r=i("KI15"),s=i("Gcu2"),o=i("ktVm"),c=i("t083"),l=i("fXoL"),u=function(){var t=function(){function t(e,i,n){var r=this;_classCallCheck(this,t),this.lastFMService=e,this.coreService=i,this.playlistService=n,this.playlistSource=new a.a,this.volumeSource=new a.a,this.hideVolumeWindowAsSource=new a.a,this.playlistAnnounced$=this.playlistSource.asObservable(),this.volumeAnnounced=this.volumeSource.asObservable(),this.hideVolumeWindowAnnounced$=this.hideVolumeWindowAsSource.asObservable(),this.isPlaying=!1,this.isPaused=!1,this.isShuffled=!1,this.forceRestart=!1,this.volume=100,this.lastfmUserName=localStorage.getItem("lastfm-username"),this.subscription=this.playlistService.playlistAnnounced$.subscribe((function(t){r.doPlayPlaylist(t,0,!0,r.isShuffled)}))}return _createClass(t,[{key:"setPosition",value:function(t){this.position=t,this.announce(),this.position=null}},{key:"doPlayAlbum",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.setPlaylist(t,e,i,n,"album"),this.announce()}},{key:"doQueueAlbum",value:function(t){var e=this.currentPlaylist,i=e.playlist,n=e.startIndex,a=new r.a;a.name="queued playlist",a.type="queue",a.tracks=[].concat(_toConsumableArray(i.tracks),_toConsumableArray(t.tracks)),this.setPlaylist(a,n,!1,!1,"playlist")}},{key:"doPlayPlaylist",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.setPlaylist(t,e,i,n,"playlist"),this.announce()}},{key:"doPlayTrack",value:function(t){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1);var e=new r.a;e.isOwn=!0,e.name=t.title,e.tracks.push(t),this.currentPlaylist={playlist:e,startIndex:0,isPlaying:this.isPlaying=!0,isPaused:this.isPaused=!1,isShuffled:!1,forceRestart:this.forceRestart=!0,isContinues:!1},this.announce()}},{key:"nextPlaylist",value:function(t){if(this.booleanState("continues-play"))if("random"===t){var e=this.playlistService.generateRandom();this.doPlayPlaylist(e,0,!0,this.isShuffled)}else this.playlistService.generateRadio();else this.stop()}},{key:"nextAlbum",value:function(t){if(this.booleanState("continues-play")){var e=this.coreService.getCore().getNextAlbum(t);e?this.doPlayAlbum(e,0,!0,this.isShuffled):(console.warn("no new album found, stopping playback"),this.stop())}else this.stop()}},{key:"playlistToString",value:function(){var t=[];return this.currentPlaylist.playlist.tracks.forEach((function(e){e&&t.push(e.id)})),JSON.stringify({ids:t,isShuffled:this.isShuffled,isContinues:this.currentPlaylist.isContinues,current:this.currentPlaylist.startIndex,type:this.currentPlaylist.type})}},{key:"playlistSync",value:function(){var t=[];return this.currentPlaylist.playlist.tracks.forEach((function(e){e&&t.push(e.id)})),{ids:t,isShuffled:this.isShuffled,isContinues:this.currentPlaylist.isContinues,current:this.currentPlaylist.startIndex,type:this.currentPlaylist.type}}},{key:"getCurrentPlaylist",value:function(){return this.currentPlaylist}},{key:"shufflePlaylist",value:function(t){this.isShuffled=t,this.currentPlaylist.playlist.tracks.sort(this.sortPlaylist),t&&(this.currentPlaylist.playlist.tracks=this.shuffle(this.currentPlaylist.playlist.tracks)),this.currentPlaylist.startIndex=this.currentPlaylist.playlist.tracks.indexOf(this.currentTrack),this.currentPlaylist.forceRestart=!1,this.announce()}},{key:"sortPlaylist",value:function(t,e){return t.disc<e.disc?-1:t.disc>e.disc?1:t.number<e.number?-1:t.number>e.number?1:0}},{key:"shuffle",value:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t}},{key:"next",value:function(){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.currentPlaylist&&(this.currentPlaylist.startIndex++,this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"prev",value:function(){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.currentPlaylist&&(this.currentPlaylist.startIndex--,this.currentPlaylist.startIndex<=0&&(this.currentPlaylist.startIndex=0),this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"pause",value:function(){this.currentPlaylist&&(this.isPlaying=!1,this.isPaused=!0,this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"resume",value:function(){this.currentPlaylist&&(this.isPlaying=!0,this.isPaused=!1,this.currentPlaylist.forceRestart=!1,this.announce())}},{key:"stop",value:function(){this.isPlaying=!1,this.isPaused=!1,this.currentPlaylist=null,Object(n.b)("current-playlist"),localStorage.removeItem("current-time"),this.playlistSource.next(this.currentPlaylist)}},{key:"togglePlayPause",value:function(){this.isPlaying?this.pause():this.resume()}},{key:"announce",value:function(){var t=this;this.currentPlaylist&&(this.currentTrack=this.currentPlaylist.playlist.tracks[this.currentPlaylist.startIndex],this.lastfmUserName&&this.lastFMService.getTrackInfo(this.currentTrack,this.lastfmUserName).subscribe((function(e){t.currentTrack&&e.track&&(t.currentTrack.isLoved="1"===e.track.userloved)})),this.currentTrack&&(this.currentTrack.isPaused=this.isPaused,this.currentTrack.isPlaying=this.isPlaying,this.currentPlaylist.isPlaying=this.isPlaying,this.currentPlaylist.isPaused=this.isPaused,this.currentPlaylist.isShuffled=this.isShuffled,this.currentPlaylist.position=this.position,Object(n.d)("current-playlist",this.playlistSync()),this.playlistSource.next(this.currentPlaylist)))}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(t){this.volume=t,this.volumeSource.next(this.volume)}},{key:"hideVolumeControl",value:function(){this.hideVolumeWindowAsSource.next(!0)}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}},{key:"setPlaylist",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"album";this.currentPlaylist={playlist:t,startIndex:e,isPlaying:this.isPlaying=!0,isPaused:this.isPaused=!1,isShuffled:this.isShuffled=n,forceRestart:this.forceRestart=i,isContinues:t.isContinues||"album"===a,type:t.type}}}]),t}();return t.\u0275fac=function(e){return new(e||t)(l.Sb(c.a),l.Sb(o.a),l.Sb(s.a))},t.\u0275prov=l.Hb({token:t,factory:t.\u0275fac}),t}()},uwnU:function(t,e,i){"use strict";var n=function t(e){_classCallCheck(this,t),this.url=e.file||e.url||e.path||e.id};i.d(e,"a",(function(){return a}));var a=function(){function t(e){_classCallCheck(this,t),this.isPlaying=!1,this.isPaused=!1,this.isLoved=!1,this.position=0,this.buffered={start:0,end:0},this.showActions=!1,this.image="",e.album&&e.title&&(this.id=e.id,this.duration=e.seconds?1e3*e.seconds:e.duration&&!isNaN(e.duration)?e.duration:0,this.title=e.title,this.source=new n(e),this.disc=e.disc||this.guessBySource(e),this.number=e.number,this.trackArtist=e.artist,this.type=e.type||"mp3")}return _createClass(t,[{key:"url",value:function(){return"/letter/".concat(this.artist.letter.escapedLetter,"/artist/").concat(encodeURIComponent(this.artist.name),"/album/").concat(encodeURIComponent(this.album.name),"/track/").concat(encodeURIComponent(this.title))}},{key:"toJSON",value:function(){return this.id}},{key:"guessBySource",value:function(t){for(var e=this.source.url,i=0,n=[1,2,3,4,5,6,7,8,9,10];i<n.length;i++){var a=n[i];if(-1!==e.indexOf(" - ".concat(a,"."))||-1!==e.indexOf("(".concat(a,") - "))||-1!==e.indexOf("CD".concat(a))||-1!==e.indexOf("\\".concat(a,"-")))return a}return 1}}]),t}()},zUnb:function(t,e,i){"use strict";i.r(e);var n=i("fXoL"),a=i("tk/3"),r=i("3Pt+"),s=i("jhN1"),o=i("oW1M"),c=i("XNvx"),l=i("ufXC"),u=i("Gcu2"),h=i("1gFc"),d=i("MDLy"),f=i("+ooL"),b=i("OgP6"),m=i("ktVm"),p=i("t083"),g=i("XtVx"),v=i("ofXK"),y=i("ztCj"),k=i("Mfq2"),S=function t(){_classCallCheck(this,t)},w=i("tyNb");function C(t,e){if(1&t){var i=n.Pb();n.Ob(0,"span"),n.Ob(1,"span",57),n.Wb("click",(function(){n.rc(i);var t=n.ac();return t.selectArtist(t.path)})),n.zc(2),n.Nb(),n.zc(3," \u2022\xa0 "),n.Ob(4,"span"),n.zc(5),n.Nb(),n.Nb()}if(2&t){var a=n.ac();n.zb(2),n.Ac(a.path.artist.albumArtist||a.path.artist.name),n.zb(3),n.Ac(a.path.album.name)}}function A(t,e){if(1&t&&(n.Ob(0,"span"),n.zc(1),n.Nb()),2&t){var i=n.ac();n.zb(1),n.Ac(i.path.artist.albumArtist||i.path.artist.name)}}function O(t,e){1&t&&(n.Ob(0,"span"),n.zc(1,"JSMusicDB Next"),n.Nb())}function P(t,e){if(1&t&&(n.Ob(0,"span"),n.zc(1),n.Nb()),2&t){var i=n.ac();n.zb(1),n.Ac(i.page)}}function x(t,e){1&t&&(n.Ob(0,"span"),n.zc(1,"JSMusicDB Next"),n.Nb())}function L(t,e){1&t&&n.Mb(0,"i",25)}function N(t,e){1&t&&n.Mb(0,"i",58)}var _=function(t){return{active:t}};function T(t,e){if(1&t&&(n.Ob(0,"li",26),n.Ob(1,"a",59),n.Mb(2,"span",60),n.zc(3),n.Nb(),n.Nb()),2&t){var i=n.ac();n.gc("ngClass",n.jc(2,_,"Scrobble cache"===i.page)),n.zb(3),n.Bc(" Scrobble cache (",i.manualScrobblingList.length,")")}}function M(t,e){if(1&t&&(n.Ob(0,"li",46),n.Ob(1,"a",61),n.Mb(2,"span",60),n.Nb(),n.Nb()),2&t){var i=n.ac();n.gc("ngClass",n.jc(2,_,"Scrobble cache"===i.page)),n.zb(1),n.ic("tooltip","Scrobble cache (",i.manualScrobblingList.length,")")}}var I=function(t){return{visible:t}},j=function(t){return{"side-nav--visible":t}};function E(){return Object.assign(new k.a,{placement:"right",delay:250})}var z,D=((z=function(){function t(e,i,n,a){var r=this;_classCallCheck(this,t),this.pathService=e,this.router=i,this.lastFMService=n,this.coreService=a,this.menuVisible=!1,this.topSearchVisible=!1,this.manualScrobblingList=[],this.onDocumentClick=function(t){t.target.classList.contains("side-nav--visible")&&r.toggleMenu()},this.core=this.coreService.getCore(),this.subscription=e.pathAnnounced$.subscribe((function(t){r.path=t,r.page=null,r.menuVisible=!1,r.disableActiveLetter(),r.activateLetter(t.letter)})),this.subscription2=e.pageAnnounced$.subscribe((function(t){r.page=t.page,r.path=null,r.menuVisible=!1,r.disableActiveLetter(),r.activateLetter(t.letter)})),this.subscription3=this.lastFMService.manualScrobbleList$.subscribe((function(t){r.manualScrobblingList=t})),this.subscription4=this.core.coreParsed$.subscribe((function(t){r.ngOnInit()})),this.search=new S,Object(y.c)("manual-scrobble-list").then((function(t){r.manualScrobblingList=t||[]}))}return _createClass(t,[{key:"ngOnInit",value:function(){this.letters=this.core.sortedLetters}},{key:"disableActiveLetter",value:function(){this.letters.forEach((function(t){t.active&&(t.active=!1)}))}},{key:"activateLetter",value:function(t){t&&(t.active=!0)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe(),this.subscription2.unsubscribe()}},{key:"toggleMenu",value:function(){this.menuVisible=!this.menuVisible,this.menuVisible?this.slideOut():this.slideIn()}},{key:"slideOut",value:function(){var t=document.querySelector(".js-side-nav");t.classList.add("side-nav--animatable"),t.classList.add("side-nav--visible"),document.addEventListener("click",this.onDocumentClick),t.addEventListener("transitionend",this.onTransitionEnd)}},{key:"slideIn",value:function(){var t=document.querySelector(".js-side-nav");t.classList.add("side-nav--animatable"),t.classList.remove("side-nav--visible"),document.removeEventListener("click",this.onDocumentClick),t.addEventListener("transitionend",this.onTransitionEnd)}},{key:"onTransitionEnd",value:function(t){var e=document.querySelector(".js-side-nav");e.classList.remove("side-nav--animatable"),e.removeEventListener("transitionend",this.onTransitionEnd)}},{key:"onSubmit",value:function(){this.topSearchVisible=!1,this.menuVisible&&this.toggleMenu(),this.router.navigate(["/search",this.search.query])}},{key:"toggleSearch",value:function(){this.topSearchVisible=!this.topSearchVisible,!0===this.topSearchVisible&&setTimeout((function(){document.getElementById("mobileSearch").focus()}),100)}},{key:"selectArtist",value:function(t){this.router.navigate(["letter",t.artist.letter.escapedLetter,"artist",t.artist.sortName])}},{key:"selectAlbum",value:function(t){this.router.navigate(["letter",t.album.artist.letter.escapedLetter,"artist",t.album.artist.sortName,"album",t.album.sortName])}}]),t}()).\u0275fac=function(t){return new(t||z)(n.Lb(g.a),n.Lb(w.c),n.Lb(p.a),n.Lb(m.a))},z.\u0275cmp=n.Fb({type:z,selectors:[["mdb-topmenu"]],features:[n.yb([{provide:k.a,useFactory:E}])],decls:94,vars:65,consts:[[1,"menu-top","fixed-top"],[1,"menu-toggle",3,"click"],["aria-label","menu button",1,"btn","btn-menu","d-md-none"],["aria-hidden","true",1,"glyph","glyph-hamburger"],[1,"d-none","d-md-inline-block"],["version","1.1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","width","276.164px","height","276.164px","viewBox","0 0 276.164 276.164",0,"xml","space","preserve",1,"logo"],["d","M156.716,61.478c-4.111,6.276-8.881,11.511-14.212,15.609l-8.728,6.962c-13.339,11.855-22.937,21.433-28.542,28.464\n                  c-10.209,12.788-15.806,25.779-16.65,38.611c-0.942,14.473,3.187,28.21,12.275,40.84c9.636,13.458,21.8,20.754,36.164,21.69\n                  c3.291,0.218,6.897,0.182,9.896-0.015l-1.121-10.104c-2.09,0.192-4.306,0.223-6.628,0.068c-9.437-0.617-17.864-4.511-25.064-11.573\n                  c-7.524-7.333-10.895-15.415-10.287-24.7c1.149-17.59,12.562-35.004,33.925-51.792l9.543-7.599\n                  c8.394-7.174,15.192-16.191,20.216-26.825c4.971-10.556,7.886-21.983,8.673-33.96c0.466-7.037-0.513-15.775-2.874-25.965\n                  c-3.241-13.839-7.854-20.765-14.136-21.179c-2.232-0.138-4.676,0.986-7.658,3.617c-7.252,6.548-12.523,14.481-15.683,23.542\n                  c-2.438,6.926-4.057,16.189-4.805,27.529c-0.313,4.72,0.313,13.438,1.805,23.962l8.844-8.192c-0.028-1.183,0.005-2.413,0.096-3.703\n                  c0.466-7.221,2.289-15.062,5.394-23.293c3.956-10.296,7.689-13.409,10.133-14.204c0.668-0.218,1.32-0.298,2.015-0.254\n                  c3.185,0.212,6.358,1.559,5.815,9.979C164.664,46.132,161.831,53.693,156.716,61.478z"],["d","M164.55,209.161c5.728-2.568,10.621-6.478,14.576-11.651c5.055-6.561,7.897-14.316,8.467-23.047\n                  c0.72-10.719-1.854-20.438-7.617-28.895c-6.322-9.264-14.98-14.317-25.745-15.026c-1.232-0.081-2.543-0.075-3.895,0.025\n                  l-2.304-17.191l-9.668,7.112l1.483,12.194c-5.789,2.393-10.827,6.17-15.017,11.255c-4.823,5.924-7.508,12.443-7.964,19.382\n                  c-0.466,7.208,1.142,13.81,4.782,19.583c1.895,3.081,4.507,5.82,7.498,8.058c4.906,3.65,10.563,3.376,11.459,1.393\n                  c0.906-1.983-2.455-5.095-5.09-9.248c-1.502-2.351-2.242-5.173-2.242-8.497c0-7.053,4.256-13.116,10.317-15.799l5.673,44.211\n                  l1.325,10.258c0.864,4.873,1.719,9.725,2.537,14.52c1,6.488,1.352,12.112,1.041,16.715c-0.419,6.375-2.408,11.584-5.919,15.493\n                  c-2.234,2.485-4.844,4.055-7.795,4.925c3.961-3.962,6.414-9.43,6.414-15.478c0-12.075-9.792-21.872-21.87-21.872\n                  c-3.353,0-6.491,0.812-9.329,2.159c-0.36,0.155-0.699,0.388-1.054,0.574c-0.779,0.425-1.559,0.85-2.286,1.362\n                  c-0.249,0.187-0.487,0.403-0.732,0.605c-4.888,3.816-8.091,9.616-8.375,16.229c0,0.01-0.011,0.021-0.011,0.031\n                  c0,0.005,0,0.01,0,0.016c-0.013,0.311-0.09,0.59-0.09,0.896c0,0.259,0.067,0.492,0.078,0.74\n                  c-0.011,7.084,2.933,13.179,8.839,18.118c5.584,4.666,12.277,7.28,19.892,7.777c4.327,0.28,8.505-0.217,12.407-1.485\n                  c3.189-1.041,6.275-2.62,9.149-4.687c6.96-5.022,10.75-11.584,11.272-19.532c0.399-6.063,0.094-13.235-0.937-21.411l-2.838-18.429\n                  l-7.156-52.899c7.984,1.532,14.027,8.543,14.027,16.968c0,5.986-1.937,15.431-5.551,20.376L164.55,209.161z"],[4,"ngIf"],["aria-label","search button",1,"btn","btn-menu","btn-search","d-md-none",3,"click"],["class","glyph glyph-magnifier",4,"ngIf"],["class","glyph glyph-clear",4,"ngIf"],["role","form",3,"ngClass","ngSubmit"],["searchForm","ngForm"],["type","text","id","mobileSearch","placeholder","Search for","name","search",1,"form-control",3,"ngModel","ngModelChange"],["name","ngModel"],[1,"js-side-nav","side-nav",3,"ngClass"],[1,"js-side-nav-container","side-nav__container"],[1,"side-nav__content","nav","flex-column"],[1,"d-none","d-md-block","search-bar"],[1,"form-group"],[1,"input-group"],["role","form",3,"ngSubmit"],["type","text","id","search","placeholder","Search for","name","search",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-addon"],[1,"glyph","glyph-magnifier"],[3,"ngClass"],["routerLink","/home"],[1,"glyph","glyph-home"],[1,"d-sm-none",3,"ngClass"],["routerLink","/letters"],[1,"glyph","glyph-characters"],["routerLink","/artists"],[1,"glyph","glyph-people"],["routerLink","/albums"],[1,"glyph","glyph-music-album"],["routerLink","/years"],[1,"glyph","glyph-calendar"],["routerLink","/playlists"],[1,"glyph","glyph-music-info"],["routerLink","/now-playing"],[1,"glyph","glyph-audio"],[3,"ngClass",4,"ngIf"],["routerLink","/settings"],[1,"glyph","glyph-settings"],[1,"d-none","d-lg-block","side-nav-xl"],[1,"nav-item",3,"ngClass"],["routerLink","/home","tooltip","Home","triggers","hover"],[1,"d-md-none","nav-item",3,"ngClass"],["routerLink","/letters","tooltip","Letters","triggers","hover"],["routerLink","/artists","tooltip","Artists","triggers","hover"],["routerLink","/albums","tooltip","Albums","triggers","hover"],["routerLink","/years","tooltip","Years","triggers","hover"],["routerLink","/playlists","tooltip","Playlists","triggers","hover"],["routerLink","/now-playing","tooltip","Now Playing","triggers","hover"],["class","nav-item",3,"ngClass",4,"ngIf"],["routerLink","/settings","tooltip","Settings","triggers","hover"],[1,"clickable","d-none","d-sm-inline",3,"click"],[1,"glyph","glyph-clear"],["routerLink","/scrobble-cache"],[1,"glyph","glyph-upload"],["routerLink","/scrobble-cache","triggers","hover",3,"tooltip"]],template:function(t,e){1&t&&(n.Ob(0,"div",0),n.Ob(1,"span",1),n.Wb("click",(function(){return e.toggleMenu()})),n.Ob(2,"button",2),n.Mb(3,"span",3),n.Nb(),n.Ob(4,"a",4),n.Zb(),n.Ob(5,"svg",5),n.Ob(6,"g"),n.Mb(7,"path",6),n.Mb(8,"path",7),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Yb(),n.Ob(9,"h1"),n.xc(10,C,6,2,"span",8),n.xc(11,A,2,1,"span",8),n.xc(12,O,2,0,"span",8),n.xc(13,P,2,1,"span",8),n.xc(14,x,2,0,"span",8),n.Nb(),n.Ob(15,"button",9),n.Wb("click",(function(){return e.toggleSearch()})),n.xc(16,L,1,0,"i",10),n.xc(17,N,1,0,"i",11),n.Nb(),n.Ob(18,"form",12,13),n.Wb("ngSubmit",(function(){return e.onSubmit()})),n.Ob(20,"input",14,15),n.Wb("ngModelChange",(function(t){return e.search.query=t})),n.Nb(),n.Nb(),n.Nb(),n.Ob(22,"aside",16),n.Ob(23,"nav",17),n.Ob(24,"ul",18),n.Ob(25,"li",19),n.Ob(26,"div",20),n.Ob(27,"div",21),n.Ob(28,"form",22,13),n.Wb("ngSubmit",(function(){return e.onSubmit()})),n.Ob(30,"input",23,15),n.Wb("ngModelChange",(function(t){return e.search.query=t})),n.Nb(),n.Ob(32,"button",24),n.Mb(33,"i",25),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Ob(34,"li",26),n.Ob(35,"a",27),n.Mb(36,"span",28),n.zc(37," Home"),n.Nb(),n.Nb(),n.Ob(38,"li",29),n.Ob(39,"a",30),n.Mb(40,"span",31),n.zc(41," Letters"),n.Nb(),n.Nb(),n.Ob(42,"li",26),n.Ob(43,"a",32),n.Mb(44,"span",33),n.zc(45," Artists"),n.Nb(),n.Nb(),n.Ob(46,"li",26),n.Ob(47,"a",34),n.Mb(48,"span",35),n.zc(49," Albums"),n.Nb(),n.Nb(),n.Ob(50,"li",26),n.Ob(51,"a",36),n.Mb(52,"span",37),n.zc(53," Years"),n.Nb(),n.Nb(),n.Ob(54,"li",26),n.Ob(55,"a",38),n.Mb(56,"span",39),n.zc(57," Playlists"),n.Nb(),n.Nb(),n.Ob(58,"li",26),n.Ob(59,"a",40),n.Mb(60,"span",41),n.zc(61," Now playing"),n.Nb(),n.Nb(),n.xc(62,T,4,4,"li",42),n.Ob(63,"li",26),n.Ob(64,"a",43),n.Mb(65,"span",44),n.zc(66," Settings"),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Ob(67,"aside",45),n.Ob(68,"ul",18),n.Ob(69,"li",46),n.Ob(70,"a",47),n.Mb(71,"span",28),n.Nb(),n.Nb(),n.Ob(72,"li",48),n.Ob(73,"a",49),n.Mb(74,"span",31),n.Nb(),n.Nb(),n.Ob(75,"li",46),n.Ob(76,"a",50),n.Mb(77,"span",33),n.Nb(),n.Nb(),n.Ob(78,"li",46),n.Ob(79,"a",51),n.Mb(80,"span",35),n.Nb(),n.Nb(),n.Ob(81,"li",46),n.Ob(82,"a",52),n.Mb(83,"span",37),n.Nb(),n.Nb(),n.Ob(84,"li",46),n.Ob(85,"a",53),n.Mb(86,"span",39),n.Nb(),n.Nb(),n.Ob(87,"li",46),n.Ob(88,"a",54),n.Mb(89,"span",41),n.Nb(),n.Nb(),n.xc(90,M,3,4,"li",55),n.Ob(91,"li",46),n.Ob(92,"a",56),n.Mb(93,"span",44),n.Nb(),n.Nb(),n.Nb(),n.Nb()),2&t&&(n.zb(10),n.gc("ngIf",e.path&&e.path.album),n.zb(1),n.gc("ngIf",e.path&&e.path.artist&&!e.path.album),n.zb(1),n.gc("ngIf",e.path&&!e.path.artist),n.zb(1),n.gc("ngIf",!e.path&&e.page),n.zb(1),n.gc("ngIf",!e.path&&!e.page),n.zb(2),n.gc("ngIf",!e.topSearchVisible),n.zb(1),n.gc("ngIf",e.topSearchVisible),n.zb(1),n.gc("ngClass",n.jc(29,I,e.topSearchVisible)),n.zb(2),n.gc("ngModel",e.search.query),n.zb(2),n.gc("ngClass",n.jc(31,j,e.menuVisible)),n.zb(8),n.gc("ngModel",e.search.query),n.zb(4),n.gc("ngClass",n.jc(33,_,"Home"===e.page)),n.zb(4),n.gc("ngClass",n.jc(35,_,"Letters"===e.page)),n.zb(4),n.gc("ngClass",n.jc(37,_,"Artists"===e.page)),n.zb(4),n.gc("ngClass",n.jc(39,_,"Albums"===e.page)),n.zb(4),n.gc("ngClass",n.jc(41,_,"Years"===e.page)),n.zb(4),n.gc("ngClass",n.jc(43,_,"Playlists"===e.page)),n.zb(4),n.gc("ngClass",n.jc(45,_,"Now playing"===e.page)),n.zb(4),n.gc("ngIf",e.manualScrobblingList.length>0),n.zb(1),n.gc("ngClass",n.jc(47,_,"Settings"===e.page)),n.zb(6),n.gc("ngClass",n.jc(49,_,"Home"===e.page)),n.zb(3),n.gc("ngClass",n.jc(51,_,"Letters"===e.page)),n.zb(3),n.gc("ngClass",n.jc(53,_,"Artists"===e.page)),n.zb(3),n.gc("ngClass",n.jc(55,_,"Albums"===e.page)),n.zb(3),n.gc("ngClass",n.jc(57,_,"Years"===e.page)),n.zb(3),n.gc("ngClass",n.jc(59,_,"Playlists"===e.page)),n.zb(3),n.gc("ngClass",n.jc(61,_,"Now playing"===e.page)),n.zb(3),n.gc("ngIf",e.manualScrobblingList.length>0),n.zb(1),n.gc("ngClass",n.jc(63,_,"Settings"===e.page)))},directives:[v.l,r.p,r.g,r.h,v.j,r.a,r.f,r.i,w.d,o.a],encapsulation:2}),z),R=function(t){return{active:t}};function B(t,e){if(1&t){var i=n.Pb();n.Ob(0,"li",2),n.Ob(1,"a",3),n.Wb("click",(function(){n.rc(i);var t=e.$implicit;return n.ac().onSelect(t)})),n.zc(2),n.Nb(),n.Nb()}if(2&t){var a=e.$implicit;n.zb(1),n.gc("ngClass",n.jc(2,R,a.active)),n.zb(1),n.Ac(a.letter)}}var U,W=((U=function(){function t(e,i){var n=this;_classCallCheck(this,t),this.coreService=e,this.router=i,this.activeLetter=null,this.core=this.coreService.getCore(),this.subscription=this.core.coreParsed$.subscribe((function(t){n.ngOnInit()}))}return _createClass(t,[{key:"ngOnInit",value:function(){this.letters=this.core.sortedLetters}},{key:"onSelect",value:function(t){this.activeLetter&&(this.activeLetter.active=!1),this.activeLetter=t,this.router.navigate(["/letter",t.escapedLetter])}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}}]),t}()).\u0275fac=function(t){return new(t||U)(n.Lb(m.a),n.Lb(w.c))},U.\u0275cmp=n.Fb({type:U,selectors:[["mdb-letters"]],decls:2,vars:1,consts:[[1,"nav","d-none","d-md-flex","nav-letters"],["class","nav-item align-self-stretch flex-grow-1 text-center",4,"ngFor","ngForOf"],[1,"nav-item","align-self-stretch","flex-grow-1","text-center"],[3,"ngClass","click"]],template:function(t,e){1&t&&(n.Ob(0,"ul",0),n.xc(1,B,3,4,"li",1),n.Nb()),2&t&&(n.zb(1),n.gc("ngForOf",e.letters))},directives:[v.k,v.j],encapsulation:2}),U);i("hR/0");var F=i("KI15"),V=i("meIv"),q=i("Pbcf"),H=function(t){return t.r=Math.floor(t.r),t.g=Math.floor(t.g),t.b=Math.floor(t.b),t.a=1,t},X=function t(e,i){return V.a.isReadable(e,i)?H(new V.a(e).toRgb()):t("#000"===i?new V.a(e).lighten(3):new V.a(e).darken(3),i)};function $(t,e,i){if(window.runningInElectron&&!i)document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbuntaint",{detail:{url:t}}));else{var n=new Image;n.crossOrigin="Anonymous",n.addEventListener("load",(function(t){var i=document.createElement("canvas"),a=i.getContext("2d");i.width=n.width,i.height=n.height,a.drawImage(n,0,0);var r=(new q.a).getColor(i).value;e(H({r:r[0],g:r[1],b:r[2]}))}),!1),n.src=t}}function J(t){var e,i=H(new V.a(t).lighten().toRgb());return{rgba:t,textLight:X(t,"#fff"),textDark:X(t,"#000"),lighten:i,darken:H(new V.a(t).darken().toRgb()),letterColor:(e=new V.a(t),V.a.readability("#000",e)>V.a.readability("#fff",e)?"#000":"#fff")}}function G(t){var e=document.createElement("style"),i=t.rgba,n=t.darken,a=t.lighten,r=t.textLight,s=t.textDark,o=t.letterColor;e.setAttribute("type","text/css"),e.id="custom-css-node",e.textContent='\n      @charset "UTF-8";\n      :root {\n        --primary: rgba('.concat(i.r,", ").concat(i.g,", ").concat(i.b,", 1);\n        --darken: rgba(").concat(n.r,", ").concat(n.g,", ").concat(n.b,", 1);\n        --lighten: rgba(").concat(a.r,", ").concat(a.g,", ").concat(a.b,", 1);\n        --text-light: rgba(").concat(r.r,", ").concat(r.g,", ").concat(r.b,", 1);\n        --text-dark: rgba(").concat(s.r,", ").concat(s.g,", ").concat(s.b,", 1);\n        --letter-color: ").concat(o,";\n      }"),K(),document.querySelector("body").appendChild(e)}function K(){document.querySelector("#custom-css-node")&&document.querySelector("#custom-css-node").remove()}function Y(t,e){1&t&&n.Mb(0,"i",26)}function Z(t,e){1&t&&n.Mb(0,"i",27)}var Q=function(t){return{width:t}},tt=function(t,e){return{"glyph-volume":t,"glyph-mute":e}},et=function(t){return{active:t}};function it(t,e){if(1&t){var i=n.Pb();n.Ob(0,"div",1),n.Ob(1,"div",2),n.Ob(2,"div",3),n.Wb("click",(function(t){return n.rc(i),n.ac().jump(t)})),n.Mb(3,"div",4),n.Nb(),n.Nb(),n.Ob(4,"div",5),n.Ob(5,"div",6),n.Ob(6,"div",7),n.Wb("click",(function(){return n.rc(i),n.ac().navigateToNowPlaying()})),n.Ob(7,"album-art",8),n.Wb("art",(function(t){return n.rc(i),n.ac().onChangeArt(t)})),n.Nb(),n.Nb(),n.Ob(8,"div",9),n.Ob(9,"h4"),n.zc(10),n.Nb(),n.Ob(11,"h5"),n.Ob(12,"a",10),n.Wb("click",(function(){return n.rc(i),n.ac().navigateToArtist()})),n.zc(13),n.Nb(),n.Ob(14,"span",11),n.zc(15," \u2022 "),n.Ob(16,"a",10),n.Wb("click",(function(){return n.rc(i),n.ac().navigateToAlbum()})),n.zc(17),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Ob(18,"div",12),n.Ob(19,"a",13),n.Wb("click",(function(){return n.rc(i),n.ac().prev()})),n.Mb(20,"span",14),n.Nb(),n.Ob(21,"a",13),n.Wb("click",(function(){return n.rc(i),n.ac().togglePlayPause()})),n.xc(22,Y,1,0,"i",15),n.xc(23,Z,1,0,"i",16),n.Nb(),n.Ob(24,"a",13),n.Wb("click",(function(){return n.rc(i),n.ac().next()})),n.Mb(25,"span",17),n.Nb(),n.Ob(26,"a",18),n.Wb("click",(function(t){return n.rc(i),n.ac().toggleVolumeWindow(t)})),n.Mb(27,"span",19),n.Nb(),n.Ob(28,"a",20),n.Wb("click",(function(){return n.rc(i),n.ac().toggleLoved()})),n.Mb(29,"i",21),n.Nb(),n.Ob(30,"a",22),n.Wb("click",(function(){return n.rc(i),n.ac().toggleShuffle()})),n.Mb(31,"i",23),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Ob(32,"div",24),n.Ob(33,"input",25),n.Wb("ngModelChange",(function(t){return n.rc(i),n.ac().volume=t}))("input",(function(){return n.rc(i),n.ac().setVolume()}))("change",(function(){return n.rc(i),n.ac().setVolume()})),n.Nb(),n.Nb(),n.Nb()}if(2&t){var a=n.ac();n.zb(3),n.gc("ngStyle",n.jc(13,Q,a.track.position/a.track.duration*100+"%")),n.zb(4),n.gc("artist",a.track.trackArtist)("album",a.track.album.name),n.zb(3),n.Ac(a.track.title),n.zb(3),n.Ac(a.track.trackArtist),n.zb(4),n.Ac(a.track.album.name),n.zb(5),n.gc("ngIf",a.isPlaying),n.zb(1),n.gc("ngIf",a.isPaused),n.zb(4),n.gc("ngClass",n.kc(15,tt,a.volume>0,0==a.volume)),n.zb(1),n.gc("ngClass",n.jc(18,et,a.track.isLoved)),n.zb(2),n.gc("ngClass",n.jc(20,et,a.isShuffled)),n.zb(2),n.gc("hidden",!a.showVolumeWindow),n.zb(1),n.gc("ngModel",a.volume)}}var nt,at=((nt=function(){function t(e,i,n,a,r,s,o){var c=this;_classCallCheck(this,t),this.pathService=e,this.playerService=i,this.router=n,this.lastFMService=a,this.coreService=r,this.animationService=s,this.colorService=o,this.showPlayer=!1,this.usesDynamicAccentColor=this.booleanState("dynamic-accent-color"),this.isPlaying=!1,this.isPaused=!1,this.hasScrobbledCurrentTrack=!1,this.isCurrentPlaylistLoaded=!1,this.isShuffled=!1,this.forceRestart=!1,this.showVolumeWindow=!1,this.volume=100,this.isHostedApp="undefined"!=typeof Windows,this.analyserID=-1,this.subscription=this.playerService.playlistAnnounced$.subscribe((function(t){t?(c.playlist=t.playlist,c.trackIndex=t.startIndex,c.isPaused=t.isPaused,c.isPlaying=t.isPlaying,c.isShuffled=t.isShuffled,c.forceRestart=t.forceRestart,c.showPlayer=c.isPaused||c.isPlaying,c.setTrack(t.position)):(c.isPlaying=!1,c.showPlayer=!1,c.mediaObject.pause())})),this.subscription5=this.playerService.hideVolumeWindowAnnounced$.subscribe((function(){c.showVolumeWindow=!1})),this.mediaObject=document.querySelector("audio"),this.mediaObject.crossOrigin="anonymous",this.mediaObject.canPlayType("audio/flac"),this.mediaObject.addEventListener("ended",(function(){c.next()})),this.mediaObject.addEventListener("timeupdate",(function(){c.updateTime()})),this.mediaObject.addEventListener("play",(function(){c.onplay()})),this.mediaObject.addEventListener("progress",(function(){c.onprogress()})),this.mediaObject.addEventListener("pause",(function(){c.onpause()})),this.mediaObject.addEventListener("ended",(function(){c.onstop()}));var l=localStorage.getItem("dsm");if(l&&(this.url=l),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe((function(t){var e=localStorage.getItem("save-playlist-state");e&&"true"===e&&c.readCurrentPlaylist()})),this.subscription3=this.playerService.volumeAnnounced.subscribe((function(t){c.volume=t,c.mediaObject.volume=c.volume/100})),this.subscription4=e.pageAnnounced$.subscribe((function(t){"Now playing"===t.page?(c.showVolumeWindow=!1,c.booleanState("visualisation-state")?(c.requestAnimationFrameLimited=window.requestAnimationFrameRate(30),c.analyserID=c.requestAnimationFrameLimited(c.draw.bind(c))):window.cancelAnimationFrameRate(c.analyserID)):window.cancelAnimationFrameRate(c.analyserID)})),this.isHostedApp&&(this.systemMediaControls=Windows.Media.SystemMediaTransportControls.getForCurrentView(),this.displayUpdater=this.systemMediaControls.displayUpdater,this.systemMediaControls.isEnabled=!0,this.systemMediaControls.isPlayEnabled=!0,this.systemMediaControls.isPauseEnabled=!0,this.systemMediaControls.isStopEnabled=!0,this.systemMediaControls.isNextEnabled=!0,this.systemMediaControls.isPreviousEnabled=!0,this.systemMediaControls.addEventListener("buttonpressed",(function(t){var e=Windows.Media.SystemMediaTransportControlsButton;switch(t.button){case e.play:c.mediaObject.play();break;case e.pause:c.mediaObject.pause();break;case e.stop:c.playerService.stop();break;case e.next:c.next();break;case e.previous:c.prev();break;default:console.warn("key not mapped in application",t.button)}}),!1),this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.closed),-1===navigator.userAgent.indexOf("Mobi")){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser();var u=this.audioCtx.createMediaElementSource(this.mediaObject),h=this.audioCtx.sampleRate;this.analyser.fftSize=this.calculateFft(h),this.hearableBars=this.getHearableBars(h,this.analyser.fftSize),u.connect(this.analyser),u.connect(this.audioCtx.destination),this.dataArray=new Uint8Array(this.hearableBars),this.analyser.getByteFrequencyData(this.dataArray)}this.subscription6=this.colorService.color$.subscribe((function(t){c.rgba=t})),this.subscription7=this.colorService.blob$.subscribe((function(){var t=new Blob([window.externalBlob],{type:"image/png"}),e=URL.createObjectURL(t),i=new Image;i.src=e,$(i.src,(function(t){var e=J(t);c.colorService.setColor(e.rgba),G(e)}),!0)}))}return _createClass(t,[{key:"draw",value:function(){this.analyserID=this.requestAnimationFrameLimited(this.draw.bind(this));var t=document.querySelector("canvas"),e=t.offsetWidth,i=t.offsetHeight;if(e&&i){var n=t.getContext("2d");this.analyser.getByteFrequencyData(this.dataArray),t.width=e,t.height=i,n.clearRect(0,0,e,i);for(var a,r=this.rgba||{r:0,g:110,b:205,a:1},s=Math.floor(e/this.hearableBars*1.1),o=0,c=i/150*1.17,l=0;l<this.hearableBars;l++)a=this.dataArray[l]*c,n.fillStyle="rgba(".concat(r.r,",").concat(r.g,",").concat(r.b,",").concat(this.dataArray[l]/255,")"),n.fillRect(o,i-a/2,s,a/2),o+=s+1}}},{key:"calculateFft",value:function(t){return 128*Math.floor(t/44100)}},{key:"getHearableBars",value:function(t,e){var i=e/2;switch(t){case 48e3:return i-1;case 88200:return i/2;case 96e3:return i/2-2;case 176400:return i/4;case 192e3:return i/4-4;case 352800:return i/8;case 384e3:return i/8-8;case 705600:return i/16;case 768e3:return i/16-16;default:return i}}},{key:"setTrack",value:function(t){if(this.track=this.playlist.tracks[this.trackIndex],!this.currentTrack||this.track&&this.currentTrack.id!==this.track.id||this.forceRestart){var e=localStorage.getItem("dsm");e&&(this.url=e);var i=localStorage.getItem("jwt");this.mediaObject.src="".concat(this.url,"/listen?path=").concat(encodeURIComponent(this.track.source.url),"&jwt=").concat(i),this.currentTrack=this.track,this.hasScrobbledCurrentTrack=!1,this.animationService.requestAnimation("enter",document.querySelector(".player h4")),this.animationService.requestAnimation("enter",document.querySelector(".player h5"))}this.isPlaying?this.mediaObject.play():this.mediaObject.pause(),this.isCurrentPlaylistLoaded&&(this.mediaObject.currentTime=localStorage.getItem("current-time")||0,this.isCurrentPlaylistLoaded=!1),t&&(this.mediaObject.currentTime=t)}},{key:"readCurrentPlaylist",value:function(){var t=this;Object(y.c)("current-playlist").then((function(e){var i=e;if(i){var n=t.coreService.getCore(),a=[];i.ids.forEach((function(t){a.push(n.tracks[t])}));var r=new F.a;r.tracks=a,r.name="Current Playlist",r.isContinues=i.isContinues||!1,r.type=i.type,t.isShuffled=i.isShuffled,t.isCurrentPlaylistLoaded=!0,t.playerService.doPlayPlaylist(r,i.current,!1,i.isShuffled)}}))}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe(),this.subscription2.unsubscribe(),this.subscription3.unsubscribe(),this.subscription4.unsubscribe(),this.subscription5.unsubscribe(),this.subscription6.unsubscribe(),this.subscription7.unsubscribe(),this.mediaObject.removeEventListener("ended"),this.mediaObject.removeEventListener("timeupdate"),this.mediaObject.removeEventListener("play"),this.showVolumeWindow=!1}},{key:"navigateToArtist",value:function(){this.router.navigate(["/letter",this.track.album.artist.letter.escapedLetter,"artist",this.track.album.artist.sortName])}},{key:"navigateToAlbum",value:function(){this.router.navigate(["/letter",this.track.album.artist.letter.escapedLetter,"artist",this.track.album.artist.sortName,"album",this.track.album.sortName])}},{key:"navigateToNowPlaying",value:function(){this.router.navigate(["/now-playing"])}},{key:"next",value:function(){this.trackIndex<this.playlist.tracks.length-1?(this.trackIndex++,this.playerService.next()):this.playlist.isContinues?(this.trackIndex=0,"random"===this.playlist.type||"radio"===this.playlist.type?this.playerService.nextPlaylist(this.playlist.type):this.playerService.nextAlbum(this.track.album)):this.playerService.stop()}},{key:"prev",value:function(){this.trackIndex>0&&(this.trackIndex--,this.playerService.prev())}},{key:"togglePlayPause",value:function(){this.playerService.togglePlayPause()}},{key:"updateTime",value:function(){if(this.track.position=1e3*this.mediaObject.currentTime,!this.hasScrobbledCurrentTrack&&(this.track.position>=t.SCROBBLETIME||this.track.position/this.track.duration>=.5&&performance.now()>t.SCROBBLETIME)){this.hasScrobbledCurrentTrack=!0;try{this.lastFMService.scrobbleTrack(this.track).subscribe((function(){}))}catch(e){console.error(e)}}localStorage.setItem("current-time",this.mediaObject.currentTime.toString())}},{key:"onplay",value:function(){var t,e=this;try{this.lastFMService.announceNowPlaying(this.track).subscribe()}catch(i){}document.title="".concat(this.track.title," by ").concat(this.track.trackArtist),"mediaSession"in navigator&&Object(y.c)("art-".concat(this.track.trackArtist,"-").concat(this.track.album.name)).then((function(t){t&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.track.title,artist:e.track.trackArtist,album:e.track.album.name,artwork:[{src:t,sizes:"500x500",type:"image/png"}]})),navigator.mediaSession.setActionHandler("play",(function(){e.togglePlayPause()})),navigator.mediaSession.setActionHandler("pause",(function(){e.togglePlayPause()})),navigator.mediaSession.setActionHandler("previoustrack",(function(){e.prev()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){e.next()}))})),this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.playing,this.displayUpdater.type=Windows.Media.MediaPlaybackType.music,Object(y.c)("art-".concat(this.track.trackArtist,"-").concat(this.track.album.name)).then((function(t){try{void 0!==e.displayUpdater&&(e.displayUpdater.musicProperties.albumArtist=e.track.trackArtist,e.displayUpdater.musicProperties.artist=e.track.trackArtist,e.displayUpdater.musicProperties.albumTitle=e.track.album.name,e.displayUpdater.musicProperties.title=e.track.title,t&&(e.displayUpdater.thumbnail=Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new Windows.Foundation.Uri(t))),e.displayUpdater.update())}catch(i){console.error("error occurred",i)}e.updateWinTile(t)}))),document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbplaying",{detail:this.track})),this.audioCtx&&this.audioCtx.resume(),this.usesDynamicAccentColor=this.booleanState("dynamic-accent-color"),this.usesDynamicAccentColor&&(t=this.rgba)&&G(J(t))}},{key:"onstop",value:function(){document.querySelector("mdb-player").dispatchEvent(new Event("external.mdbstopped")),document.title="JSMusicDB Next",this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.stopped),this.audioCtx&&this.audioCtx.suspend(),K()}},{key:"onpause",value:function(){document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbpaused",{detail:this.track})),document.title="JSMusicDB Next",this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.paused),this.audioCtx&&this.audioCtx.suspend(),K()}},{key:"onChangeArt",value:function(t){var e=this;this.usesDynamicAccentColor?$(t.detail.art,(function(t){var i=J(t);e.colorService.setColor(i.rgba),G(i)}),!1):(this.colorService.setColor({r:0,g:110,b:205,a:1}),K())}},{key:"toggleShuffle",value:function(){this.isShuffled=!this.isShuffled,this.playerService.shufflePlaylist(this.isShuffled)}},{key:"toggleLoved",value:function(){this.track.isLoved=!this.track.isLoved,this.lastFMService.toggleLoved(this.track).subscribe()}},{key:"toggleVolumeWindow",value:function(t){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.showVolumeWindow=!this.showVolumeWindow}},{key:"onprogress",value:function(){var t=this.mediaObject.buffered;0!==t.length&&(this.track.buffered.start=1e3*t.start(0!==t.length?t.length-1:0),this.track.buffered.end=1e3*t.end(0!==t.length?t.length-1:0))}},{key:"setVolume",value:function(){this.mediaObject.volume=this.volume/100,this.playerService.setVolume(this.volume)}},{key:"jump",value:function(t){var e=(t.clientX||t.changedTouches[0].clientX)/document.querySelector(".player").clientWidth;this.playerService.setPosition(this.track.duration/1e3*e)}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}},{key:"updateWinTile",value:function(t){var e=Windows.UI.Notifications;e.TileUpdateManager.createTileUpdaterForApplication("App").clear();var i=e.TileUpdateManager.getTemplateContent(e.TileTemplateType.tileSquare150x150PeekImageAndText02),n=i.getElementsByTagName("text")[0];n.innerText=this.track.title,(n=i.getElementsByTagName("text")[1]).innerText=this.track.trackArtist,t&&(i.getElementsByTagName("image")[0].attributes[1].value=t);var a=new Date,r=new Date(a.getTime()+Number(this.track.duration)),s=i.importNode(this.getTileContent(t,"tileSquare310x310ImageAndText02").getElementsByTagName("binding").item(0),!0);i.getElementsByTagName("visual").item(0).appendChild(s),s=i.importNode(this.getTileContent(t,"tileWide310x150PeekImage02").getElementsByTagName("binding").item(0),!0),i.getElementsByTagName("visual").item(0).appendChild(s),s=i.importNode(this.getTileContent(t,"tileSquare71x71Image").getElementsByTagName("binding").item(0),!0),i.getElementsByTagName("visual").item(0).appendChild(s);var o=new e.TileNotification(i);o.expirationTime=r,e.TileUpdateManager.createTileUpdaterForApplication("App").update(o)}},{key:"getTileContent",value:function(t,e){var i=Windows.UI.Notifications,n=i.TileUpdateManager.getTemplateContent(i.TileTemplateType[e]);try{n.getElementsByTagName("text")[0].innerText=this.track.title}catch(a){console.error(a)}try{n.getElementsByTagName("text")[1].innerText=this.track.trackArtist}catch(a){console.error(a)}return t&&(n.getElementsByTagName("image")[0].attributes[1].value=t),n}}]),t}()).SCROBBLETIME=24e4,nt.\u0275fac=function(t){return new(t||nt)(n.Lb(g.a),n.Lb(l.a),n.Lb(w.c),n.Lb(p.a),n.Lb(m.a),n.Lb(h.a),n.Lb(f.a))},nt.\u0275cmp=n.Fb({type:nt,selectors:[["mdb-player"]],decls:1,vars:1,consts:[["class","player",4,"ngIf"],[1,"player"],[1,"row"],[1,"progress",3,"click"],["role","progressbar",1,"progress-bar",3,"ngStyle"],[1,"container-fluid"],[1,"row","row-sm"],[1,"col-xs-4","col-player-art",3,"click"],[3,"artist","album","art"],[1,"col-xs-11","col-player-special"],[3,"click"],[1,"hidden-xs","color-type-secondary"],[1,"col-xs-9","text-right","col-player-controls"],[1,"btn","btn-link",3,"click"],[1,"glyph","glyph-previous"],["class","glyph glyph-pause",4,"ngIf"],["class","glyph glyph-play",4,"ngIf"],[1,"glyph","glyph-next"],[1,"btn","btn-link","d-none","d-md-inline-block",3,"click"],[1,"glyph",3,"ngClass"],[1,"btn","btn-link","d-none","d-md-inline-block","btn-love",3,"ngClass","click"],[1,"glyph","glyph-star-outline"],[1,"btn","btn-link","d-none","d-md-inline-block","btn-shuffle",3,"ngClass","click"],[1,"glyph","glyph-shuffle"],[1,"volume-control",3,"hidden"],["type","range","min","0","max","100",3,"ngModel","ngModelChange","input","change"],[1,"glyph","glyph-pause"],[1,"glyph","glyph-play"]],template:function(t,e){1&t&&n.xc(0,it,34,22,"div",0),2&t&&n.gc("ngIf",e.showPlayer)},directives:[v.l,v.m,v.j,r.l,r.a,r.f,r.i],encapsulation:2}),nt);function rt(t,e){if(1&t&&(n.Ob(0,"div"),n.zc(1),n.Nb()),2&t){var i=n.ac(2);n.zb(1),n.Bc(" progress: ",i.scanperc,"% ")}}function st(t,e){if(1&t&&(n.Ob(0,"div",6),n.Ob(1,"div",7),n.Ob(2,"div",8),n.Ob(3,"div",9),n.zc(4," Collection is being reloaded, please wait. "),n.xc(5,rt,2,1,"div",10),n.Ob(6,"div",11),n.Mb(7,"div",12),n.Mb(8,"div",12),n.Mb(9,"div",12),n.Mb(10,"div",12),n.Mb(11,"div",12),n.Nb(),n.Nb(),n.Nb(),n.Nb(),n.Nb()),2&t){var i=n.ac();n.zb(5),n.gc("ngIf",i.scanperc)}}!function(t){t.requestAnimationFrameRate=function(e){var i,n,a;return e="number"!=typeof e?60:Math.max(1,Math.min(60,e)),a=(i=1e3/e)-.1*i,function(e){return i=t.requestAnimationFrame((function r(s){s-(n=n||s)<a?i=t.requestAnimationFrame(r):(e(s),n=s)})),function(){t.cancelAnimationFrame(i)};var i}},t.cancelAnimationFrameRate=function(t){"function"==typeof t&&t()}}(window);var ot,ct,lt,ut,ht=function(t){return{isPlaying:t}},dt=((ct=function(){function t(e,i,n,a,r,s,o){var c=this;_classCallCheck(this,t),this.collectionService=e,this.coreService=i,this.loginService=n,this.configService=a,this.playerService=r,this.colorService=s,this.isPlaying=!1,this.scanperc=0,this.isReloading=!1,this.letter="N",this.path="JSMusicDB Next",this.isLoading=!1,this.hasBeenReloading=!1,this.isHostedApp="undefined"!=typeof Windows,this.loginService.hasToken&&(this.isLoading=!0,this.poll()),this.viewContainerRef=o,this.subscription=this.playerService.playlistAnnounced$.subscribe((function(t){c.isPlaying=!!t})),this.booleanState("tracking-state")?navigator.geolocation.getCurrentPosition((function(t){c.configService.getSunriseInfo(t.coords.latitude,t.coords.longitude).subscribe((function(t){c.configService.startDate=new Date(t.results.sunset),c.configService.stopDate=new Date(t.results.sunrise),c.configService.stopDate.setDate(c.configService.stopDate.getDate()+1),c.configService.geoSource.next(),c.configService.applyTheme()}))}),(function(t){c.configService.startDate=new Date,c.configService.startDate.setHours(21,0,0),c.configService.stopDate=new Date,c.configService.stopDate.setDate(c.configService.stopDate.getDate()+1),c.configService.stopDate.setHours(7,0,0),c.configService.geoSource.next(),c.configService.applyTheme()})):(this.configService.startDate=new Date,this.configService.startDate.setHours(21,0,0),this.configService.stopDate=new Date,this.configService.stopDate.setDate(this.configService.stopDate.getDate()+1),this.configService.stopDate.setHours(7,0,0),this.configService.geoSource.next(),this.configService.applyTheme())}return _createClass(t,[{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"ngOnInit",value:function(){this.mediaObject=document.querySelector("audio");var t=this.mediaObject.canPlayType("audio/flac");this.isFlacSupported="probably"===t||"maybe"===t}},{key:"getCollection",value:function(){var t=this;this.collectionService.getCollection().subscribe((function(e){return t.fillCollection(e)}),(function(t){return console.error(t)}))}},{key:"fillCollection",value:function(t){localStorage.setItem("lastParsed",(new Date).getTime().toString()),this.coreService.getCore().parseSourceJson(t,this.isFlacSupported),this.isLoading=!1}},{key:"hideVolumeWindow",value:function(){this.playerService.hideVolumeControl()}},{key:"poll",value:function(){var t=this;this.collectionService.poll().subscribe((function(e){t.scanperc=e.progress,"ready"!==e.status?(t.isReloading=!0,document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbscanning",{detail:{percentage:t.scanperc}})),setTimeout((function(e){t.poll()}),5e3),t.hasBeenReloading=!0):(t.isReloading=!1,t.hasBeenReloading&&document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbscanstop")),t.getCollection())}))}},{key:"onExternalPrev",value:function(t){this.playerService.prev()}},{key:"onExternalNext",value:function(t){this.playerService.next()}},{key:"onExternalToggle",value:function(t){this.playerService.togglePlayPause()}},{key:"onExternalStop",value:function(t){this.playerService.stop()}},{key:"onExternalBlob",value:function(){this.colorService.setBlob()}},{key:"booleanState",value:function(t){var e=localStorage.getItem(t);return!(!e||"true"!==e)}}]),t}()).\u0275fac=function(t){return new(t||ct)(n.Lb(d.a),n.Lb(m.a),n.Lb(c.a),n.Lb(b.a),n.Lb(l.a),n.Lb(f.a),n.Lb(n.N))},ct.\u0275cmp=n.Fb({type:ct,selectors:[["mdb-root"]],features:[n.yb([d.a,m.a,g.a,l.a,p.a,h.a,b.a,u.a,f.a])],decls:10,vars:7,consts:[["id","reloading",4,"ngIf"],[3,"ngClass","click"],[1,"fixed-top",2,"z-index","1029",3,"click"],[1,"main-content",3,"ngClass","click"],[2,"display","none"],[3,"mdbprev","mdbnext","mdbtoggle","mdbstop","click","mdbblob"],["id","reloading"],[1,"container"],[1,"row"],[1,"col"],[4,"ngIf"],[1,"progress-bar"],[1,"progress-circle"]],template:function(t,e){1&t&&(n.xc(0,st,12,1,"div",0),n.Ob(1,"div",1),n.Wb("click",(function(){return e.hideVolumeWindow})),n.Mb(2,"mdb-topmenu"),n.Nb(),n.Ob(3,"div",2),n.Wb("click",(function(){return e.hideVolumeWindow})),n.Mb(4,"mdb-letters"),n.Nb(),n.Ob(5,"div",3),n.Wb("click",(function(){return e.hideVolumeWindow})),n.Mb(6,"router-outlet"),n.Nb(),n.Mb(7,"audio",4),n.Mb(8,"canvas"),n.Ob(9,"mdb-player",5),n.Wb("mdbprev",(function(t){return e.onExternalPrev(t)}))("mdbnext",(function(t){return e.onExternalNext(t)}))("mdbtoggle",(function(t){return e.onExternalToggle(t)}))("mdbstop",(function(t){return e.onExternalStop(t)}))("click",(function(){return e.hideVolumeWindow()}))("mdbblob",(function(){return e.onExternalBlob()})),n.Nb()),2&t&&(n.gc("ngIf",e.isReloading),n.zb(1),n.gc("ngClass",n.jc(3,ht,e.isPlaying)),n.zb(4),n.gc("ngClass",n.jc(5,ht,e.isPlaying)))},directives:[v.l,v.j,D,W,w.f,at],encapsulation:2}),ct),ft=((ot=function(){function t(e,i){_classCallCheck(this,t),this.loginService=e,this.router=i}return _createClass(t,[{key:"canActivate",value:function(t,e){var i=this;return new Promise((function(t){var n=e.url;window.scrollTo(0,0),t(i.checkLogin(n))}))}},{key:"checkLogin",value:function(t){return!!localStorage.getItem("jwt")||(this.router.navigate(["/login"]),!1)}}]),t}()).\u0275fac=function(t){return new(t||ot)(n.Sb(c.a),n.Sb(w.c))},ot.\u0275prov=n.Hb({token:ot,factory:ot.\u0275fac}),ot),bt=[ft,c.a],mt=w.e.forRoot([{path:"login",loadChildren:function(){return i.e(9).then(i.bind(null,"X3zk")).then((function(t){return t.LoginModule}))}},{path:"home",loadChildren:function(){return Promise.all([i.e(0),i.e(6)]).then(i.bind(null,"ct+p")).then((function(t){return t.HomeModule}))},canActivate:[ft]},{path:"letters",loadChildren:function(){return i.e(8).then(i.bind(null,"mCIM")).then((function(t){return t.LettersModule}))},canActivate:[ft]},{path:"artists",loadChildren:function(){return Promise.all([i.e(0),i.e(5)]).then(i.bind(null,"3r4j")).then((function(t){return t.ArtistsModule}))},canActivate:[ft]},{path:"albums",loadChildren:function(){return Promise.all([i.e(0),i.e(3)]).then(i.bind(null,"fX0g")).then((function(t){return t.AlbumsModule}))},canActivate:[ft]},{path:"years",loadChildren:function(){return Promise.all([i.e(0),i.e(20)]).then(i.bind(null,"ZutQ")).then((function(t){return t.YearsModule}))},canActivate:[ft]},{path:"playlists",loadChildren:function(){return Promise.all([i.e(0),i.e(12)]).then(i.bind(null,"kez3")).then((function(t){return t.PlaylistsModule}))},canActivate:[ft]},{path:"now-playing",loadChildren:function(){return Promise.all([i.e(0),i.e(11)]).then(i.bind(null,"YxDV")).then((function(t){return t.NowPlayingModule}))},canActivate:[ft]},{path:"settings",loadChildren:function(){return Promise.all([i.e(0),i.e(17)]).then(i.bind(null,"7wo0")).then((function(t){return t.SettingsModule}))},canActivate:[ft]},{path:"scrobble-cache",loadChildren:function(){return i.e(15).then(i.bind(null,"BSpc")).then((function(t){return t.ScrobbleCacheModule}))},canActivate:[ft]},{path:"search/:query",loadChildren:function(){return Promise.all([i.e(0),i.e(16)]).then(i.bind(null,"RmqX")).then((function(t){return t.SearchModule}))},canActivate:[ft]},{path:"letter/:letter",loadChildren:function(){return Promise.all([i.e(0),i.e(7)]).then(i.bind(null,"pJo8")).then((function(t){return t.LetterDetailModule}))},canActivate:[ft]},{path:"letter/:letter/artist/:artist",loadChildren:function(){return Promise.all([i.e(0),i.e(4)]).then(i.bind(null,"2+yB")).then((function(t){return t.ArtistDetailModule}))},canActivate:[ft]},{path:"letter/:letter/artist/:artist/album/:album",loadChildren:function(){return Promise.all([i.e(0),i.e(2)]).then(i.bind(null,"jJnS")).then((function(t){return t.AlbumDetailModule}))},canActivate:[ft]},{path:"",loadChildren:function(){return Promise.all([i.e(0),i.e(6)]).then(i.bind(null,"ct+p")).then((function(t){return t.HomeModule}))},canActivate:[ft]}],{preloadingStrategy:w.b}),pt=((lt=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"supports",value:function(t){var e=!1;return 0===t.indexOf("mdb")&&(e=!0),e}},{key:"addEventListener",value:function(t,e,i){var n=this,a=this.manager.getZone(),r=function(t){a.run((function(){return i(t)}))};return this.manager.getZone().runOutsideAngular((function(){n.manager.addEventListener(t,"external."+e,r)}))}},{key:"addGlobalEventListener",value:function(t,e,i){var n=this,a=this.manager.getZone(),r=function(t){return a.run((function(){return i(t)}))};return this.manager.getZone().runOutsideAngular((function(){n.manager.addGlobalEventListener(t,e,r)}))}}]),t}()).\u0275fac=function(t){return new(t||lt)},lt.\u0275prov=n.Hb({token:lt,factory:lt.\u0275fac}),lt),gt=i("hDf6"),vt=((ut=function t(){_classCallCheck(this,t),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then((function(t){})).catch((function(t){console.error("Registration failed with "+t)}))}).\u0275mod=n.Jb({type:ut,bootstrap:[dt]}),ut.\u0275inj=n.Ib({factory:function(t){return new(t||ut)},providers:[bt,{provide:s.b,useClass:pt,multi:!0},{provide:n.u,useValue:"en-GB"}],imports:[[s.a,a.b,r.b,mt,o.b.forRoot(),gt.a]]}),ut);Object(n.R)(),window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),window.deferredPrompt=t})),s.c().bootstrapModule(vt).catch((function(t){return console.error(t)}))}},[[0,1,19]]]);