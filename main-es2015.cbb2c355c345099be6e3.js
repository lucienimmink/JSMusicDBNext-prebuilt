(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"+ooL":function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("XNiG"),r=s("fXoL");let a=(()=>{class t{constructor(){this.colorSource=new i.a,this.blobSource=new i.a,this.color$=this.colorSource.asObservable(),this.blob$=this.blobSource.asObservable()}setColor(t){this.colorSource.next(t)}setBlob(){this.blobSource.next(!0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})()},"/1T7":function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t){this.tracks=[],this.discs=[],this.sortedDiscs=[],this.modified=0,this.isContinues=!0,t.album&&t.title&&(this.name=t.album,this.sortName=this.name.toUpperCase(),this.year=t.year,this.modified=t.modified,this.year&&-1!==this.year.indexOf("-")&&(this.year=this.year.split("-")[0]))}url(){return`/letter/${this.artist.letter.escapedLetter}/artist/${encodeURIComponent(this.artist.name)}/album/${encodeURIComponent(this.name)}`}}},0:function(t,e,s){t.exports=s("zUnb")},"1gFc":function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var i=s("fXoL");let r=(()=>{class t{requestAnimation(t="enter",e,s=!0){e&&(e.classList.contains(t)&&e.classList.remove(t),setTimeout(()=>{e.classList.add(t)},10),s&&setTimeout(()=>{e.classList.remove(t)},150))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Gb({token:t,factory:t.\u0275fac}),t})()},Gcu2:function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));var i=s("XNiG"),r=s("LNEh"),a=s("ktVm"),n=s("t083"),o=s("KI15"),c=s("fXoL");let l=(()=>{class t{constructor(t,e){this.coreService=t,this.lastfmservice=e,this.playlistSubject=new i.a,this.playlistAnnounced$=this.playlistSubject.asObservable(),this.numberOfTracksInAPlaylist=100,this.username=localStorage.getItem("lastfm-username"),this.core=this.coreService.getCore()}generateRandom(){const t=Object.keys(this.core.tracks),e=this.shuffle(t).splice(0,this.numberOfTracksInAPlaylist),s=new o.a;return s.name=`${this.numberOfTracksInAPlaylist} random tracks`,e.map(t=>{s.tracks.push(this.core.tracks[t])}),s}generateRadio(){this.lastfmservice.getTopArtists(this.username).subscribe(t=>{this.playlistSubject.next(this.extractArtists(t))})}extractTracks(t){const e=new o.a;return e.name="Loved tracks on Last.FM",t.map(t=>{const s=this.core.getTrackByArtistAndName(t.artist.name,t.name);s&&e.tracks.push(s)}),e}extractArtists(t){const e=[],s=[];return t.forEach((t,i)=>{t.dummy=!0;const a=new r.a(t),n=this.core.artists[a.sortName];n&&i<10?e.push(n):s.push(n)}),this.generateRadioList(e,s)}generateRadioList(t,e){const s=new o.a;s.name=`${this.numberOfTracksInAPlaylist} random tracks based on your recently listened tracks`;for(let i=0;i<this.numberOfTracksInAPlaylist;i++)s.tracks.push(this.getRandomTrackFromList(i%3==0||i%5==0?t:i%4==0||i%7==0?e:this.core.artistsList()));return s}getRandomTrackFromList(t){const e=this.shuffle(t)[0];if(e){const s=this.shuffle(e.albums)[0],i=this.shuffle(s.tracks)[0];return i.duration<=6e5?i:this.getRandomTrackFromList(t)}return this.getRandomTrackFromList(t)}shuffle(t){for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}return t}getNextTrackForPlaylist(t,e){const s=this.getRandomTrackFromList(t);if(s){const i=s.artist;return e.tracks.length>1&&e.tracks[e.tracks.length-1].artist===i&&t.length>1?this.getNextTrackForPlaylist(t,e):s}return null}}return t.\u0275fac=function(e){return new(e||t)(c.Rb(a.a),c.Rb(n.a))},t.\u0275prov=c.Gb({token:t,factory:t.\u0275fac}),t})()},KI15:function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(){this.tracks=[],this.isOwn=!1,this.isContinues=!1}}},LNEh:function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t){this.albums=[],(t.album&&t.title||t.dummy)&&(this.name=t.name||t.artist||"",this.albumArtist=t.albumartist||t.albumArtist||"",this.sortName=this.stripFromName(this.albumArtist?this.albumArtist.toUpperCase():t.sortName?t.sortName.toUpperCase():this.name.toUpperCase(),["the ",'"',"a "]),this.bio=t.bio,this.isCollection=!!this.albumArtist&&this.name!==this.albumArtist)}url(){return`/letter/${this.letter.escapedLetter}/artist/${encodeURIComponent(this.albumArtist||this.name)}/`}sortAlbumsBy(t="name",e="asc"){const s=new Intl.Collator("en");this.albums.sort((i,r)=>{let a,n;if(-1!==t.indexOf(".")){const e=t.split(".");a=i[e[0]][e[1]],n=r[e[0]][e[1]]}else a="year"!==t?i[t].toUpperCase():i[t],n="year"!==t?r[t].toUpperCase():r[t];const o=s.compare(a,n);return"asc"===e?o:-1*o})}sortAndReturnAlbumsBy(t="name",e="asc"){return this.sortAlbumsBy(t,e),this.albums}stripFromName(t,e){let s=t?t.toUpperCase():"";return s=s.trim(),e.forEach(t=>{const e=t.toUpperCase();0===s.indexOf(e)&&(s=s.substring(e.length))}),s}}},MDLy:function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var i=s("z6cu"),r=s("JIr8"),a=s("Kj3r"),n=s("fXoL"),o=s("tk/3");let c=(()=>{class t{constructor(t){this.http=t,this.collectionUrl="/data/node-music.json",this.reloadUrl="/rescan",this.pollUrl="/progress",this.dsm=localStorage.getItem("dsm")}getCollection(){return this.dsm=localStorage.getItem("dsm"),this.http.get(this.dsm+this.collectionUrl).pipe(Object(r.a)(this.handleError))}reload(){const t=this.dsm+this.reloadUrl,e=localStorage.getItem("jwt");return this.http.get(`${t}?_ts=${(new Date).getTime()}&jwt=${e}`).pipe(Object(r.a)(this.handleError))}poll(){const t=this.dsm+this.pollUrl,e=localStorage.getItem("jwt");return this.http.get(`${t}?_ts=${(new Date).getTime()}&jwt=${e}`).pipe(Object(a.a)(300),Object(r.a)(this.handleError))}handleError(t){const e=t.message?t.message:t.status?`${t.status} - ${t.statusText}`:"Server error";return Object(i.a)(e)}}return t.\u0275fac=function(e){return new(e||t)(n.Rb(o.a))},t.\u0275prov=n.Gb({token:t,factory:t.\u0275fac}),t})()},OgP6:function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var i=s("XNiG"),r=s("z6cu"),a=s("JIr8"),n=s("fXoL"),o=s("tk/3");let c=(()=>{class t{constructor(t){this.http=t,this.geoSource=new i.a,this.themeSource=new i.a,this.modeSource=new i.a,this.theme$=this.themeSource.asObservable(),this.mode$=this.modeSource.asObservable(),this.geo$=this.geoSource.asObservable(),this._theme=localStorage.getItem("theme")||"light",this._mode="light",this.counter=0,this.COUNTERTIMER=6e4}get theme(){return this._theme}get mode(){return this._mode}set theme(t){this._theme!==t&&(this._theme=t),"auto"!==this._theme||this.counter?"auto"===this._theme||(this.setStyleSheet(this._theme),clearInterval(this.counter),this.counter=0,this._mode=this._theme):(this.counter=setInterval(()=>{this.checkTheme()},this.COUNTERTIMER),this.checkTheme())}getSunriseInfo(t=51,e=5){return this.http.get(`https://api.sunrise-sunset.org/json?lat=${t}&lng=${e}&formatted=0`).pipe(Object(a.a)(this.handleError))}applyTheme(){"auto"===this._theme?(this.counter||(this.counter=setInterval(()=>{this.checkTheme()},this.COUNTERTIMER)),this.checkTheme(!0)):this.setStyleSheet(this._theme)}checkTheme(t=!1){const e=new Date;e<this.stopDate&&e>this.startDate&&"dark"!==this._mode?(this._mode="dark",this.setStyleSheet(this._mode)):(e>this.stopDate||e<this.startDate)&&"light"!==this._mode&&(this._mode="light",this.setStyleSheet(this._mode)),t&&this.setStyleSheet(this._mode)}handleError(t){return Object(r.a)(null)}setStyleSheet(t){const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","prod"!==window.ENV&&window.ENV?`/dist/sass/${t}.css`:`global/css/${t}.css`),e.setAttribute("id","customStylesheet");const s=document.getElementById("customStylesheet");s&&document.getElementsByTagName("head")[0].removeChild(s),document.getElementsByTagName("head")[0].appendChild(e),localStorage.setItem("theme",this._theme),localStorage.setItem("style",t),this.themeSource.next(this._theme),this.modeSource.next(t)}}return t.\u0275fac=function(e){return new(e||t)(n.Rb(o.a))},t.\u0275prov=n.Gb({token:t,factory:t.\u0275fac}),t})()},XNvx:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var i=s("z6cu"),r=s("tk/3"),a=s("JIr8"),n=s("fXoL");let o=(()=>{class t{constructor(t){this.http=t,this.hasToken=!1,localStorage.getItem("jwt")&&(this.hasToken=!0)}doLogin(t,e=!1){const s=t;if(!e)throw new Error("You should log in via the webcrypto flow; contact me");const i={headers:new r.c({"X-Cred":s})};return this.http.post(`${localStorage.getItem("dsm")}/login`,null,i).pipe(Object(a.a)(this.handleError))}autoLogin(){const t=localStorage.getItem("jwt");return t?this.doLogin(t,!0):(localStorage.removeItem("jwt"),Object(i.a)(null))}versionCheck(t){return this.http.get(`${t}/version`)}getPublicKey(t){return this.http.get(`${t}/public-key`)}authenticate(t,e){return this.http.post(`${t}/authenticate`,{encryptedPayload:this.arrayBufferToBase64(e)})}handleError(t){return Object(i.a)(null)}arrayBufferToBase64(t){return btoa(new Uint8Array(t).reduce((t,e)=>t+String.fromCharCode(e),""))}}return t.\u0275fac=function(e){return new(e||t)(n.Rb(r.a))},t.\u0275prov=n.Gb({token:t,factory:t.\u0275fac}),t})()},XtVx:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("XNiG"),r=s("fXoL");let a=(()=>{class t{constructor(){this.pathAnnouncementSource=new i.a,this.pageAnnouncementSource=new i.a,this.pathAnnounced$=this.pathAnnouncementSource.asObservable(),this.pageAnnounced$=this.pageAnnouncementSource.asObservable()}announcePath(t){this.pathAnnouncementSource.next(t)}announcePage(t,e=null){this.pageAnnouncementSource.next({page:t,letter:e})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})()},crnd:function(t,e){function s(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}s.keys=function(){return[]},s.resolve=s,t.exports=s,s.id="crnd"},hDf6:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("ofXK"),r=s("fXoL");let a=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},imports:[[i.b]]}),t})()},ktVm:function(t,e,s){"use strict";var i=s("XNiG"),r=s("/1T7"),a=s("LNEh"),n=s("o8Y7");class o{constructor(t){this.artists=[],this.active=!1,t.album&&t.title&&(this.letter=t.letter||this.getFirstLetterOf(t.albumArtist||t.albumartist||t.artist),"1"===this.letter&&(this.letter="#"),this.escapedLetter=encodeURIComponent(this.letter))}url(){return`/letter/${this.escapedLetter}/`}sortArtistsBy(t="sortName",e="asc"){if("albums"===t)this.artists.sort((t,s)=>t.albums.length>s.albums.length?"asc"===e?-1:1:t.albums.length<s.albums.length?"asc"===e?1:-1:0);else{const s=new Intl.Collator("en");this.artists.sort((i,r)=>{let a,n;if(-1!==t.indexOf(".")){const e=t.split(".");a=i[e[0]][e[1]],n=r[e[0]][e[1]]}else a=i[t].toUpperCase(),n=r[t].toUpperCase();const o=s.compare(a,n);return"asc"===e?o:-1*o})}}sortAndReturnArtistsBy(t="name",e="asc"){return this.sortArtistsBy(t,e),this.artists}getFirstLetterOf(t){let e="";return e=this.stripFromName(t,["the ",'"',"a "]),this.groupIfSpecialChar(e.substr(0,1))}stripFromName(t,e){let s=t?t.toUpperCase():"";return s=s.trim(),e.forEach(t=>{const e=t.toUpperCase();0===s.indexOf(e)&&(s=s.substring(e.length))}),Object(n.a)(s)}groupIfSpecialChar(t){return-1!==["1","2","3","4","5","6","7","8","9","0","(",")","[","]","{","}","_","-","."].indexOf(t)?"#":t}}var c=s("/+cc"),l=s.n(c);class h{constructor(){this.doSearch=({query:t,keys:e=["name"],list:s})=>new l.a(s,this.options(e)).search(t),this.options=t=>({keys:t,threshold:.25,shouldSort:!0})}}var u=s("uwnU");class d{constructor(t){this.albums=[],this.sanitize=t=>{let e=parseInt(t,10);return isNaN(e)&&(e=0),e},t.year&&(this.year=this.sanitize(t.year))}}class b{constructor(){this.artists={},this.albums={},this.tracks={},this.letters={},this.years={},this.sortedLetters=[],this.sortedAlbums=[],this.isCoreParsed=!1,this.coreParsedSource=new i.a,this.coreParsed$=this.coreParsedSource.asObservable(),this.totals={artists:0,albums:0,tracks:0,playingTime:0,parsingTime:0},this.latestAdditions=[],this.search=new h,console.info("Core init 1.6.0")}resetCollection(){this.artists={},this.albums={},this.tracks={},this.letters={},this.years={},this.sortedLetters=[],this.sortedAlbums=[],this.totals={artists:0,albums:0,tracks:0,playingTime:0,parsingTime:0},this.latestAdditions=[]}parseSourceJson(t,e=!0){const s=(new Date).getTime();if(t.length)for(const a of t)this.parseLine(a,e);else t.tree&&this.parseTree(t.tree);const i=Object.keys(this.letters).sort((t,e)=>t<e?-1:1),r=[];i.forEach((t,e)=>{r.push(this.letters[t]),this.letters[t].sortAndReturnArtistsBy("name","asc")}),this.sortedLetters=r,this.totals.parsingTime+=(new Date).getTime()-s,this.coreParsedSource.next(!0),this.isCoreParsed=!0}getTrackByArtistAndName(t,e){const s=new a.a({name:t,dummy:!0}),i=this.artists[s.sortName];let r=null;return i&&i.albums.some(t=>{t.tracks.some(t=>{if(t.title&&t.title.toLowerCase()===e.toLowerCase())return r||(r=t),!0})}),r}getTrackById(t){let e=new u.a({});return this.tracks.forEach(s=>{s.id===t&&(e=s)}),e}getArtistByName(t){const e=new a.a({name:t,dummy:!0});return this.artists[e.sortName]}getAlbumByArtistAndName(t,e){let s=null;return t.albums.forEach(t=>{t.name.toLowerCase()===e.toLowerCase()&&(s=t)}),s}getTrackByAlbumAndName(t,e){let s=null;return t.tracks.forEach(t=>{t.title.toLowerCase()===e.toLowerCase()&&(s=t)}),s}artistsList(){const t=[];return Object.keys(this.artists).sort((t,e)=>t<e?-1:1).forEach((e,s)=>{t.push(this.artists[e])}),t}trackList(){const t=[];return Object.keys(this.tracks).sort((t,e)=>t<e?-1:1).forEach((e,s)=>{t.push(this.tracks[e])}),t}searchArtist(t){return this.search.doSearch({query:t,list:this.artistsList()})}searchAlbum(t){return this.search.doSearch({query:t,list:this.sortedAlbums})}searchTrack(t){return this.search.doSearch({query:t,keys:["title"],list:this.trackList()})}getLatestAdditions(t=14){return 0!==this.latestAdditions.length?this.latestAdditions:(this.sortedAlbums.sort((t,e)=>t.modified>e.modified?-1:t.modified<e.modified?1:0),this.latestAdditions=this.sortedAlbums.splice(0,t),this.latestAdditions)}getNextAlbum(t){const e=t.artist,s=e.albums.indexOf(t);let i=e.albums[s+1];return i||(i=this.getNextArtist(e).albums[0]),i}getNextArtist(t){const e=t.letter,s=e.artists.indexOf(t);let i=e.artists[s+1];return i||(i=this.getNextLetter(e).artists[0]),i}getNextLetter(t){const e=this.sortedLetters.indexOf(t);let s=this.sortedLetters[e+1];return s||(s=this.sortedLetters[0]),s}instanceIfPresent(t,e,s,i,r){let a=null;return s[e]?a=s[e]:(s[e]=i,a=i,r(t)),a}handleLetter(t){return this.instanceIfPresent(this,t.letter,this.letters,t,t=>{})}handleArtist(t,e){return this.instanceIfPresent(this,e.sortName,this.artists,e,s=>{t.artists.push(e),e.letter=t,s.totals.artists++})}handleAlbum(t,e,s=!0){return this.instanceIfPresent(this,t.sortName+"|"+e.sortName,this.albums,e,i=>{if("flac"===e.type&&s||"flac"!==e.type)if(e.artist=t,t.albums.push(e),t.sortAndReturnAlbumsBy("year","asc"),i.sortedAlbums.push(e),i.totals.albums++,i.years[e.year])i.years[e.year].albums.push(e);else{const t=new d(e);t.albums.push(e),i.years[t.year]=t}})}handleTrack(t,e,s,i=!0){return this.instanceIfPresent(this,s.id,this.tracks,s,r=>{if(e.type=e.type&&e.type!==s.type?"mixed":s.type,"flac"===s.type&&i||"flac"!==s.type){r.totals.tracks++,r.totals.playingTime+=s.duration,s.artist=t,s.album=e,e.tracks.push(s);const i=s.disc;e.discs[`disc-${i}`]?e.discs[`disc-${i}`].push(s):(e.discs[`disc-${i}`]=[],e.discs[`disc-${i}`].push(s)),e.discs[`disc-${i}`].sort((t,e)=>t.number<e.number?-1:1),e.tracks.sort((t,e)=>t.disc<e.disc?-1:t.disc===e.disc&&t.number<e.number?-1:1)}else console.warn("skipping flac track, flac is not supported")})}parseLine(t,e=!0){let s=new o(t);s.letter&&(s=this.handleLetter(s));let i=new a.a(t);i.name&&(i=this.handleArtist(s,i));let n=new r.a(t);n.name&&(n=this.handleAlbum(i,n,e));let c=new u.a(t);c.title&&(c=this.handleTrack(i,n,c,e))}parseTree(t){for(const e in t){let s=new o(t[e]);s=this.handleLetter(s);for(const i in t[e].artists){let n=new a.a(t[e].artists[i]);n=this.handleArtist(s,n);for(const s in t[e].artists[i].albums){let a=new r.a(t[e].artists[i].albums[s]);a=this.handleAlbum(n,a);for(const r in t[e].artists[i].albums[s].tracks){let o=new u.a(t[e].artists[i].albums[s].tracks[r]);o=this.handleTrack(n,a,o)}}}}}}var m=s("fXoL");s.d(e,"a",(function(){return p}));let p=(()=>{class t{constructor(){this.core=new b}getCore(){return this.core}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=m.Gb({token:t,factory:t.\u0275fac}),t})()},t083:function(t,e,s){"use strict";var i=s("XNiG"),r=s("z6cu"),a=s("JIr8"),n=s("tk/3"),o=s("ztCj");class c{encodeKey(t){return encodeURIComponent(t)}encodeValue(t){return encodeURIComponent(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}var l=s("fXoL");s.d(e,"a",(function(){return d}));const h="956c1818ded606576d6941de5ff793a5",u="4d183e73f7578dee78557665e9be3acc";let d=(()=>{class t{constructor(t){this.http=t,this.manualScrobbleListSource=new i.a,this.manualScrobbleList$=this.manualScrobbleListSource.asObservable(),this.hexcase=0,this.b64pad=""}getLovedTracks(t){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{api_key:h,format:"json",limit:"1000",method:"user.getlovedtracks",user:t}}).pipe(Object(a.a)(this.handleError))}toggleLoved(t){const e=localStorage.getItem("lastfm-token"),s=(new URLSearchParams,t.isLoved?"track.love":"track.unlove"),i=new n.d({encoder:new c}).set("method",s).set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,null,e,s)).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("sk",e),r=new n.c({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:i,headers:r}).pipe(Object(a.a)(this.handleError))}getTrackInfo(t,e){if(t){const s=new n.d({encoder:new c}).set("method","track.getInfo").set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("api_key",h).set("format","json").set("user",e);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:s}).pipe(Object(a.a)(this.handleError))}return Object(r.a)(null)}getTopArtists(t){const e=new n.d({encoder:new c}).set("api_key",h).set("format","json").set("limit","50").set("method","user.gettopartists").set("period","1month").set("user",t);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:e}).pipe(Object(a.a)(this.handleError))}getSimilairArtists(t){const e=new n.d({encoder:new c}).set("api_key",h).set("format","json").set("limit","20").set("autocorrect","1").set("method","artist.getSimilar").set("artist",t.name);return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:e}).pipe(Object(a.a)(this.handleError))}authenticate(t){const e=new n.d({encoder:new c}).set("api_key",h).set("api_sig",this.signAuthentication(t.user,t.password)).set("format","json").set("username",t.user).set("password",t.password),s=new n.c({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post("https://ws.audioscrobbler.com/2.0/?method=auth.getMobileSession",null,{params:e,headers:s}).pipe(Object(a.a)(this.handleError))}announceNowPlaying(t){if("mdb-skipped"!==localStorage.getItem("lastfm-username")){const e=new Date,s=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()+e.getTimezoneOffset(),e.getSeconds())/1e3,i=localStorage.getItem("lastfm-token"),r=new n.c({"Content-Type":"application/x-www-form-urlencoded"}),o=new n.d({encoder:new c}).set("method","track.updateNowPlaying").set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,s,i,"track.updateNowPlaying")).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("timestamp",s.toString()).set("sk",i);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:o,headers:r}).pipe(Object(a.a)(this.handleError))}}scrobbleTrack(t){const e=localStorage.getItem("lastfm-username"),s=new Date,i=Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes()+s.getTimezoneOffset(),s.getSeconds())/1e3;if("mdb-skipped"!==e){const e=localStorage.getItem("lastfm-token");if(!this.booleanState("manual-scrobble-state")){const s=new n.c({"Content-Type":"application/x-www-form-urlencoded"}),r=new n.d({encoder:new c}).set("method","track.scrobble").set("api_key",h).set("api_sig",this.signTrack(t.trackArtist,t.album.name,t.title,i,e,"track.scrobble")).set("artist",t.trackArtist).set("album",t.album.name).set("track",t.title).set("timestamp",i.toString()).set("sk",e);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:r,headers:s}).pipe(Object(a.a)(this.handleError))}Object(o.c)("manual-scrobble-list").then(e=>{const s=e||[],r={artist:t.trackArtist,album:t.album.name,track:t.title,timestamp:i.toString()};s.unshift(r),Object(o.d)("manual-scrobble-list",s),this.manualScrobbleListSource.next(s)})}else{const e=`art-${t.trackArtist}-${t.album.name}`;Object(o.c)(e).then(e=>{this.saveInLocal(t,i,e||"global/images/no-cover.png")})}}updateManualScrobbleList(){Object(o.c)("manual-scrobble-list").then(t=>{this.manualScrobbleListSource.next(t||[])})}saveInLocal(t,e,s){const i={artist:{"#text":t.trackArtist},album:{"#text":t.album.name},image:[{"#text":s}],name:t.title,date:{uts:e}};let r=[],a=null;Object(o.c)("recentlyListened").then(t=>{t&&(r=t.tracks,r.length>10&&(r=r.splice(0,10)),a=t._rev),r.unshift(i);const e={_id:"recentlyListened",tracks:r};Object(o.d)(e._id,e.tracks)})}scrobbleCachedTrack(t){const e=localStorage.getItem("lastfm-token"),s=new n.c({"Content-Type":"application/x-www-form-urlencoded"}),i=new n.d({encoder:new c}).set("method","track.scrobble").set("api_key",h).set("api_sig",this.signTrack(t.artist,t.album,t.track,t.timestamp,e,"track.scrobble")).set("artist",t.artist).set("album",t.album).set("track",t.track).set("timestamp",t.timestamp.toString()).set("sk",e);return this.http.post("https://ws.audioscrobbler.com/2.0/",null,{params:i,headers:s,responseType:"text"}).pipe(Object(a.a)(this.handleError))}booleanState(t){const e=localStorage.getItem(t);return!(!e||"true"!==e)}signAuthentication(t,e){return this.hex_md5(`api_key${h}methodauth.getMobileSessionpassword${e}username${t}${u}`)}signTrack(t,e,s,i,r,a){return this.hex_md5(i?`album${e}api_key${h}artist${t}method${a}sk${r}timestamp${i}track${s}${u}`:`album${e}api_key${h}artist${t}method${a}sk${r}track${s}${u}`)}handleError(t){return Object(r.a)(null)}hex_md5(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))}rstr2hex(t){try{this.hexcase=this.hexcase}catch(r){this.hexcase=0}const e=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";let s,i="";for(let a=0;a<t.length;a++)s=t.charCodeAt(a),i+=e.charAt(s>>>4&15)+e.charAt(15&s);return i}rstr_md5(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))}str2rstr_utf8(t){let e,s,i="",r=-1;for(;++r<t.length;)e=t.charCodeAt(r),s=r+1<t.length?t.charCodeAt(r+1):0,55296<=e&&e<=56319&&56320<=s&&s<=57343&&(e=65536+((1023&e)<<10)+(1023&s),r++),e<=127?i+=String.fromCharCode(e):e<=2047?i+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?i+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(i+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return i}binl2rstr(t){let e="";for(let s=0;s<32*t.length;s+=8)e+=String.fromCharCode(t[s>>5]>>>s%32&255);return e}binl_md5(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let s=1732584193,i=-271733879,r=-1732584194,a=271733878;for(let n=0;n<t.length;n+=16){const e=s,o=i,c=r,l=a;s=this.md5_ff(s,i,r,a,t[n+0],7,-680876936),a=this.md5_ff(a,s,i,r,t[n+1],12,-389564586),r=this.md5_ff(r,a,s,i,t[n+2],17,606105819),i=this.md5_ff(i,r,a,s,t[n+3],22,-1044525330),s=this.md5_ff(s,i,r,a,t[n+4],7,-176418897),a=this.md5_ff(a,s,i,r,t[n+5],12,1200080426),r=this.md5_ff(r,a,s,i,t[n+6],17,-1473231341),i=this.md5_ff(i,r,a,s,t[n+7],22,-45705983),s=this.md5_ff(s,i,r,a,t[n+8],7,1770035416),a=this.md5_ff(a,s,i,r,t[n+9],12,-1958414417),r=this.md5_ff(r,a,s,i,t[n+10],17,-42063),i=this.md5_ff(i,r,a,s,t[n+11],22,-1990404162),s=this.md5_ff(s,i,r,a,t[n+12],7,1804603682),a=this.md5_ff(a,s,i,r,t[n+13],12,-40341101),r=this.md5_ff(r,a,s,i,t[n+14],17,-1502002290),i=this.md5_ff(i,r,a,s,t[n+15],22,1236535329),s=this.md5_gg(s,i,r,a,t[n+1],5,-165796510),a=this.md5_gg(a,s,i,r,t[n+6],9,-1069501632),r=this.md5_gg(r,a,s,i,t[n+11],14,643717713),i=this.md5_gg(i,r,a,s,t[n+0],20,-373897302),s=this.md5_gg(s,i,r,a,t[n+5],5,-701558691),a=this.md5_gg(a,s,i,r,t[n+10],9,38016083),r=this.md5_gg(r,a,s,i,t[n+15],14,-660478335),i=this.md5_gg(i,r,a,s,t[n+4],20,-405537848),s=this.md5_gg(s,i,r,a,t[n+9],5,568446438),a=this.md5_gg(a,s,i,r,t[n+14],9,-1019803690),r=this.md5_gg(r,a,s,i,t[n+3],14,-187363961),i=this.md5_gg(i,r,a,s,t[n+8],20,1163531501),s=this.md5_gg(s,i,r,a,t[n+13],5,-1444681467),a=this.md5_gg(a,s,i,r,t[n+2],9,-51403784),r=this.md5_gg(r,a,s,i,t[n+7],14,1735328473),i=this.md5_gg(i,r,a,s,t[n+12],20,-1926607734),s=this.md5_hh(s,i,r,a,t[n+5],4,-378558),a=this.md5_hh(a,s,i,r,t[n+8],11,-2022574463),r=this.md5_hh(r,a,s,i,t[n+11],16,1839030562),i=this.md5_hh(i,r,a,s,t[n+14],23,-35309556),s=this.md5_hh(s,i,r,a,t[n+1],4,-1530992060),a=this.md5_hh(a,s,i,r,t[n+4],11,1272893353),r=this.md5_hh(r,a,s,i,t[n+7],16,-155497632),i=this.md5_hh(i,r,a,s,t[n+10],23,-1094730640),s=this.md5_hh(s,i,r,a,t[n+13],4,681279174),a=this.md5_hh(a,s,i,r,t[n+0],11,-358537222),r=this.md5_hh(r,a,s,i,t[n+3],16,-722521979),i=this.md5_hh(i,r,a,s,t[n+6],23,76029189),s=this.md5_hh(s,i,r,a,t[n+9],4,-640364487),a=this.md5_hh(a,s,i,r,t[n+12],11,-421815835),r=this.md5_hh(r,a,s,i,t[n+15],16,530742520),i=this.md5_hh(i,r,a,s,t[n+2],23,-995338651),s=this.md5_ii(s,i,r,a,t[n+0],6,-198630844),a=this.md5_ii(a,s,i,r,t[n+7],10,1126891415),r=this.md5_ii(r,a,s,i,t[n+14],15,-1416354905),i=this.md5_ii(i,r,a,s,t[n+5],21,-57434055),s=this.md5_ii(s,i,r,a,t[n+12],6,1700485571),a=this.md5_ii(a,s,i,r,t[n+3],10,-1894986606),r=this.md5_ii(r,a,s,i,t[n+10],15,-1051523),i=this.md5_ii(i,r,a,s,t[n+1],21,-2054922799),s=this.md5_ii(s,i,r,a,t[n+8],6,1873313359),a=this.md5_ii(a,s,i,r,t[n+15],10,-30611744),r=this.md5_ii(r,a,s,i,t[n+6],15,-1560198380),i=this.md5_ii(i,r,a,s,t[n+13],21,1309151649),s=this.md5_ii(s,i,r,a,t[n+4],6,-145523070),a=this.md5_ii(a,s,i,r,t[n+11],10,-1120210379),r=this.md5_ii(r,a,s,i,t[n+2],15,718787259),i=this.md5_ii(i,r,a,s,t[n+9],21,-343485551),s=this.safe_add(s,e),i=this.safe_add(i,o),r=this.safe_add(r,c),a=this.safe_add(a,l)}return Array(s,i,r,a)}rstr2binl(t){const e=Array(t.length>>2);for(let s=0;s<e.length;s++)e[s]=0;for(let s=0;s<8*t.length;s+=8)e[s>>5]|=(255&t.charCodeAt(s/8))<<s%32;return e}md5_cmn(t,e,s,i,r,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(i,a)),r),s)}md5_ff(t,e,s,i,r,a,n){return this.md5_cmn(e&s|~e&i,t,e,r,a,n)}md5_gg(t,e,s,i,r,a,n){return this.md5_cmn(e&i|s&~i,t,e,r,a,n)}md5_hh(t,e,s,i,r,a,n){return this.md5_cmn(e^s^i,t,e,r,a,n)}md5_ii(t,e,s,i,r,a,n){return this.md5_cmn(s^(e|~i),t,e,r,a,n)}safe_add(t,e){const s=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(s>>16)<<16|65535&s}bit_rol(t,e){return t<<e|t>>>32-e}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(n.a))},t.\u0275prov=l.Gb({token:t,factory:t.\u0275fac}),t})()},ufXC:function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var i=s("ztCj"),r=s("XNiG"),a=s("KI15"),n=s("Gcu2"),o=s("ktVm"),c=s("t083"),l=s("fXoL");let h=(()=>{class t{constructor(t,e,s){this.lastFMService=t,this.coreService=e,this.playlistService=s,this.playlistSource=new r.a,this.volumeSource=new r.a,this.hideVolumeWindowAsSource=new r.a,this.playlistAnnounced$=this.playlistSource.asObservable(),this.volumeAnnounced=this.volumeSource.asObservable(),this.hideVolumeWindowAnnounced$=this.hideVolumeWindowAsSource.asObservable(),this.isPlaying=!1,this.isPaused=!1,this.isShuffled=!1,this.forceRestart=!1,this.volume=100,this.lastfmUserName=localStorage.getItem("lastfm-username"),this.subscription=this.playlistService.playlistAnnounced$.subscribe(t=>{this.doPlayPlaylist(t,0,!0,this.isShuffled)})}setPosition(t){this.position=t,this.announce(),this.position=null}doPlayAlbum(t,e,s=!1,i=!1){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.setPlaylist(t,e,s,i,"album"),this.announce()}doQueueAlbum(t){const{playlist:e,startIndex:s}=this.currentPlaylist,i=new a.a;i.name="queued playlist",i.type="queue",i.tracks=[...e.tracks,...t.tracks],this.setPlaylist(i,s,!1,!1,"playlist")}doPlayPlaylist(t,e,s=!1,i=!1){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.setPlaylist(t,e,s,i,"playlist"),this.announce()}doPlayTrack(t){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1);const e=new a.a;e.isOwn=!0,e.name=t.title,e.tracks.push(t),this.currentPlaylist={playlist:e,startIndex:0,isPlaying:this.isPlaying=!0,isPaused:this.isPaused=!1,isShuffled:!1,forceRestart:this.forceRestart=!0,isContinues:!1},this.announce()}nextPlaylist(t){if(this.booleanState("continues-play"))if("random"===t){const t=this.playlistService.generateRandom();this.doPlayPlaylist(t,0,!0,this.isShuffled)}else this.playlistService.generateRadio();else this.stop()}nextAlbum(t){if(this.booleanState("continues-play")){const e=this.coreService.getCore().getNextAlbum(t);e?this.doPlayAlbum(e,0,!0,this.isShuffled):(console.warn("no new album found, stopping playback"),this.stop())}else this.stop()}playlistToString(){const t=[];return this.currentPlaylist.playlist.tracks.forEach(e=>{e&&t.push(e.id)}),JSON.stringify({ids:t,isShuffled:this.isShuffled,isContinues:this.currentPlaylist.isContinues,current:this.currentPlaylist.startIndex,type:this.currentPlaylist.type})}playlistSync(){const t=[];return this.currentPlaylist.playlist.tracks.forEach(e=>{e&&t.push(e.id)}),{ids:t,isShuffled:this.isShuffled,isContinues:this.currentPlaylist.isContinues,current:this.currentPlaylist.startIndex,type:this.currentPlaylist.type}}getCurrentPlaylist(){return this.currentPlaylist}shufflePlaylist(t){this.isShuffled=t,this.currentPlaylist.playlist.tracks.sort(this.sortPlaylist),t&&(this.currentPlaylist.playlist.tracks=this.shuffle(this.currentPlaylist.playlist.tracks)),this.currentPlaylist.startIndex=this.currentPlaylist.playlist.tracks.indexOf(this.currentTrack),this.currentPlaylist.forceRestart=!1,this.announce()}sortPlaylist(t,e){return t.disc<e.disc?-1:t.disc>e.disc?1:t.number<e.number?-1:t.number>e.number?1:0}shuffle(t){for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}return t}next(){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.currentPlaylist&&(this.currentPlaylist.startIndex++,this.currentPlaylist.forceRestart=!1,this.announce())}prev(){this.currentTrack&&(this.currentTrack.isPaused=!1,this.currentTrack.isPlaying=!1),this.currentPlaylist&&(this.currentPlaylist.startIndex--,this.currentPlaylist.startIndex<=0&&(this.currentPlaylist.startIndex=0),this.currentPlaylist.forceRestart=!1,this.announce())}pause(){this.currentPlaylist&&(this.isPlaying=!1,this.isPaused=!0,this.currentPlaylist.forceRestart=!1,this.announce())}resume(){this.currentPlaylist&&(this.isPlaying=!0,this.isPaused=!1,this.currentPlaylist.forceRestart=!1,this.announce())}stop(){this.isPlaying=!1,this.isPaused=!1,this.currentPlaylist=null,Object(i.b)("current-playlist"),localStorage.removeItem("current-time"),this.playlistSource.next(this.currentPlaylist)}togglePlayPause(){this.isPlaying?this.pause():this.resume()}announce(){this.currentPlaylist&&(this.currentTrack=this.currentPlaylist.playlist.tracks[this.currentPlaylist.startIndex],this.lastfmUserName&&this.lastFMService.getTrackInfo(this.currentTrack,this.lastfmUserName).subscribe(t=>{this.currentTrack&&t.track&&(this.currentTrack.isLoved="1"===t.track.userloved)}),this.currentTrack&&(this.currentTrack.isPaused=this.isPaused,this.currentTrack.isPlaying=this.isPlaying,this.currentPlaylist.isPlaying=this.isPlaying,this.currentPlaylist.isPaused=this.isPaused,this.currentPlaylist.isShuffled=this.isShuffled,this.currentPlaylist.position=this.position,Object(i.d)("current-playlist",this.playlistSync()),this.playlistSource.next(this.currentPlaylist)))}getVolume(){return this.volume}setVolume(t){this.volume=t,this.volumeSource.next(this.volume)}hideVolumeControl(){this.hideVolumeWindowAsSource.next(!0)}booleanState(t){const e=localStorage.getItem(t);return!(!e||"true"!==e)}setPlaylist(t,e=0,s=!0,i=!1,r="album"){this.currentPlaylist={playlist:t,startIndex:e,isPlaying:this.isPlaying=!0,isPaused:this.isPaused=!1,isShuffled:this.isShuffled=i,forceRestart:this.forceRestart=s,isContinues:t.isContinues||"album"===r,type:t.type}}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(c.a),l.Rb(o.a),l.Rb(n.a))},t.\u0275prov=l.Gb({token:t,factory:t.\u0275fac}),t})()},uwnU:function(t,e,s){"use strict";class i{constructor(t){this.url=t.file||t.url||t.path||t.id}}s.d(e,"a",(function(){return r}));class r{constructor(t){this.isPlaying=!1,this.isPaused=!1,this.isLoved=!1,this.position=0,this.buffered={start:0,end:0},this.showActions=!1,this.image="",t.album&&t.title&&(this.id=t.id,this.duration=t.seconds?1e3*t.seconds:t.duration&&!isNaN(t.duration)?t.duration:0,this.title=t.title,this.source=new i(t),this.disc=t.disc||this.guessBySource(t),this.number=t.number,this.trackArtist=t.artist,this.type=t.type||"mp3")}url(){return`/letter/${this.artist.letter.escapedLetter}/artist/${encodeURIComponent(this.artist.name)}/album/${encodeURIComponent(this.album.name)}/track/${encodeURIComponent(this.title)}`}toJSON(){return this.id}guessBySource(t){const e=this.source.url,s=[1,2,3,4,5,6,7,8,9,10];for(const i of s)if(-1!==e.indexOf(` - ${i}.`)||-1!==e.indexOf(`(${i}) - `)||-1!==e.indexOf(`CD${i}`)||-1!==e.indexOf(`\\${i}-`))return i;return 1}}},zUnb:function(t,e,s){"use strict";s.r(e);var i=s("fXoL"),r=s("tk/3"),a=s("3Pt+"),n=s("jhN1"),o=s("Mfq2"),c=s("XNvx"),l=s("ufXC"),h=s("Gcu2"),u=s("1gFc"),d=s("MDLy"),b=s("+ooL"),m=s("OgP6"),p=s("ktVm"),g=s("t083"),f=s("XtVx"),y=s("ofXK"),v=s("ztCj");class k{}var S=s("tyNb");function w(t,e){if(1&t){const t=i.Ob();i.Nb(0,"span"),i.Nb(1,"span",57),i.Vb("click",(function(){i.oc(t);const e=i.Zb();return e.selectArtist(e.path)})),i.sc(2),i.Mb(),i.sc(3," \u2022 "),i.Nb(4,"span"),i.sc(5),i.Mb(),i.Mb()}if(2&t){const t=i.Zb();i.zb(2),i.tc(t.path.artist.albumArtist||t.path.artist.name),i.zb(3),i.tc(t.path.album.name)}}function C(t,e){if(1&t&&(i.Nb(0,"span"),i.sc(1),i.Mb()),2&t){const t=i.Zb();i.zb(1),i.tc(t.path.artist.albumArtist||t.path.artist.name)}}function L(t,e){1&t&&(i.Nb(0,"span"),i.sc(1,"JSMusicDB Next"),i.Mb())}function P(t,e){if(1&t&&(i.Nb(0,"span"),i.sc(1),i.Mb()),2&t){const t=i.Zb();i.zb(1),i.tc(t.page)}}function A(t,e){1&t&&(i.Nb(0,"span"),i.sc(1,"JSMusicDB Next"),i.Mb())}function M(t,e){1&t&&i.Lb(0,"i",25)}function x(t,e){1&t&&i.Lb(0,"i",58)}const N=function(t){return{active:t}};function T(t,e){if(1&t&&(i.Nb(0,"li",26),i.Nb(1,"a",59),i.Lb(2,"span",60),i.sc(3),i.Mb(),i.Mb()),2&t){const t=i.Zb();i.fc("ngClass",i.ic(2,N,"Scrobble cache"===t.page)),i.zb(3),i.uc(" Scrobble cache (",t.manualScrobblingList.length,")")}}function I(t,e){if(1&t&&(i.Nb(0,"li",46),i.Nb(1,"a",61),i.Lb(2,"span",60),i.Mb(),i.Mb()),2&t){const t=i.Zb();i.fc("ngClass",i.ic(2,N,"Scrobble cache"===t.page)),i.zb(1),i.hc("tooltip","Scrobble cache (",t.manualScrobblingList.length,")")}}const _=function(t){return{visible:t}},O=function(t){return{"side-nav--visible":t}};function E(){return Object.assign(new o.a,{placement:"right",delay:250})}let $=(()=>{class t{constructor(t,e,s,i){this.pathService=t,this.router=e,this.lastFMService=s,this.coreService=i,this.menuVisible=!1,this.topSearchVisible=!1,this.manualScrobblingList=[],this.onDocumentClick=t=>{t.target.classList.contains("side-nav--visible")&&this.toggleMenu()},this.core=this.coreService.getCore(),this.subscription=t.pathAnnounced$.subscribe(t=>{this.path=t,this.page=null,this.menuVisible=!1,this.disableActiveLetter(),this.activateLetter(t.letter)}),this.subscription2=t.pageAnnounced$.subscribe(t=>{this.page=t.page,this.path=null,this.menuVisible=!1,this.disableActiveLetter(),this.activateLetter(t.letter)}),this.subscription3=this.lastFMService.manualScrobbleList$.subscribe(t=>{this.manualScrobblingList=t}),this.subscription4=this.core.coreParsed$.subscribe(t=>{this.ngOnInit()}),this.search=new k,Object(v.c)("manual-scrobble-list").then(t=>{this.manualScrobblingList=t||[]})}ngOnInit(){this.letters=this.core.sortedLetters}disableActiveLetter(){this.letters.forEach(t=>{t.active&&(t.active=!1)})}activateLetter(t){t&&(t.active=!0)}ngOnDestroy(){this.subscription.unsubscribe(),this.subscription2.unsubscribe()}toggleMenu(){this.menuVisible=!this.menuVisible,this.menuVisible?this.slideOut():this.slideIn()}slideOut(){const t=document.querySelector(".js-side-nav");t.classList.add("side-nav--animatable"),t.classList.add("side-nav--visible"),document.addEventListener("click",this.onDocumentClick),t.addEventListener("transitionend",this.onTransitionEnd)}slideIn(){const t=document.querySelector(".js-side-nav");t.classList.add("side-nav--animatable"),t.classList.remove("side-nav--visible"),document.removeEventListener("click",this.onDocumentClick),t.addEventListener("transitionend",this.onTransitionEnd)}onTransitionEnd(t){const e=document.querySelector(".js-side-nav");e.classList.remove("side-nav--animatable"),e.removeEventListener("transitionend",this.onTransitionEnd)}onSubmit(){this.topSearchVisible=!1,this.menuVisible&&this.toggleMenu(),this.router.navigate(["/search",this.search.query])}toggleSearch(){this.topSearchVisible=!this.topSearchVisible,!0===this.topSearchVisible&&setTimeout(()=>{document.getElementById("mobileSearch").focus()},100)}selectArtist(t){this.router.navigate(["letter",t.artist.letter.escapedLetter,"artist",t.artist.sortName])}selectAlbum(t){this.router.navigate(["letter",t.album.artist.letter.escapedLetter,"artist",t.album.artist.sortName,"album",t.album.sortName])}}return t.\u0275fac=function(e){return new(e||t)(i.Kb(f.a),i.Kb(S.c),i.Kb(g.a),i.Kb(p.a))},t.\u0275cmp=i.Eb({type:t,selectors:[["mdb-topmenu"]],features:[i.yb([{provide:o.a,useFactory:E}])],decls:94,vars:65,consts:[[1,"menu-top","fixed-top"],[1,"menu-toggle",3,"click"],["aria-label","menu button",1,"btn","btn-menu","d-md-none"],["aria-hidden","true",1,"glyph","glyph-hamburger"],[1,"d-none","d-md-inline-block"],["version","1.1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","width","276.164px","height","276.164px","viewBox","0 0 276.164 276.164",0,"xml","space","preserve",1,"logo"],["d","M156.716,61.478c-4.111,6.276-8.881,11.511-14.212,15.609l-8.728,6.962c-13.339,11.855-22.937,21.433-28.542,28.464\n                  c-10.209,12.788-15.806,25.779-16.65,38.611c-0.942,14.473,3.187,28.21,12.275,40.84c9.636,13.458,21.8,20.754,36.164,21.69\n                  c3.291,0.218,6.897,0.182,9.896-0.015l-1.121-10.104c-2.09,0.192-4.306,0.223-6.628,0.068c-9.437-0.617-17.864-4.511-25.064-11.573\n                  c-7.524-7.333-10.895-15.415-10.287-24.7c1.149-17.59,12.562-35.004,33.925-51.792l9.543-7.599\n                  c8.394-7.174,15.192-16.191,20.216-26.825c4.971-10.556,7.886-21.983,8.673-33.96c0.466-7.037-0.513-15.775-2.874-25.965\n                  c-3.241-13.839-7.854-20.765-14.136-21.179c-2.232-0.138-4.676,0.986-7.658,3.617c-7.252,6.548-12.523,14.481-15.683,23.542\n                  c-2.438,6.926-4.057,16.189-4.805,27.529c-0.313,4.72,0.313,13.438,1.805,23.962l8.844-8.192c-0.028-1.183,0.005-2.413,0.096-3.703\n                  c0.466-7.221,2.289-15.062,5.394-23.293c3.956-10.296,7.689-13.409,10.133-14.204c0.668-0.218,1.32-0.298,2.015-0.254\n                  c3.185,0.212,6.358,1.559,5.815,9.979C164.664,46.132,161.831,53.693,156.716,61.478z"],["d","M164.55,209.161c5.728-2.568,10.621-6.478,14.576-11.651c5.055-6.561,7.897-14.316,8.467-23.047\n                  c0.72-10.719-1.854-20.438-7.617-28.895c-6.322-9.264-14.98-14.317-25.745-15.026c-1.232-0.081-2.543-0.075-3.895,0.025\n                  l-2.304-17.191l-9.668,7.112l1.483,12.194c-5.789,2.393-10.827,6.17-15.017,11.255c-4.823,5.924-7.508,12.443-7.964,19.382\n                  c-0.466,7.208,1.142,13.81,4.782,19.583c1.895,3.081,4.507,5.82,7.498,8.058c4.906,3.65,10.563,3.376,11.459,1.393\n                  c0.906-1.983-2.455-5.095-5.09-9.248c-1.502-2.351-2.242-5.173-2.242-8.497c0-7.053,4.256-13.116,10.317-15.799l5.673,44.211\n                  l1.325,10.258c0.864,4.873,1.719,9.725,2.537,14.52c1,6.488,1.352,12.112,1.041,16.715c-0.419,6.375-2.408,11.584-5.919,15.493\n                  c-2.234,2.485-4.844,4.055-7.795,4.925c3.961-3.962,6.414-9.43,6.414-15.478c0-12.075-9.792-21.872-21.87-21.872\n                  c-3.353,0-6.491,0.812-9.329,2.159c-0.36,0.155-0.699,0.388-1.054,0.574c-0.779,0.425-1.559,0.85-2.286,1.362\n                  c-0.249,0.187-0.487,0.403-0.732,0.605c-4.888,3.816-8.091,9.616-8.375,16.229c0,0.01-0.011,0.021-0.011,0.031\n                  c0,0.005,0,0.01,0,0.016c-0.013,0.311-0.09,0.59-0.09,0.896c0,0.259,0.067,0.492,0.078,0.74\n                  c-0.011,7.084,2.933,13.179,8.839,18.118c5.584,4.666,12.277,7.28,19.892,7.777c4.327,0.28,8.505-0.217,12.407-1.485\n                  c3.189-1.041,6.275-2.62,9.149-4.687c6.96-5.022,10.75-11.584,11.272-19.532c0.399-6.063,0.094-13.235-0.937-21.411l-2.838-18.429\n                  l-7.156-52.899c7.984,1.532,14.027,8.543,14.027,16.968c0,5.986-1.937,15.431-5.551,20.376L164.55,209.161z"],[4,"ngIf"],["aria-label","search button",1,"btn","btn-menu","btn-search","d-md-none",3,"click"],["class","glyph glyph-magnifier",4,"ngIf"],["class","glyph glyph-clear",4,"ngIf"],["role","form",3,"ngClass","ngSubmit"],["searchForm","ngForm"],["type","text","id","mobileSearch","placeholder","Search for","name","search",1,"form-control",3,"ngModel","ngModelChange"],["name","ngModel"],[1,"js-side-nav","side-nav",3,"ngClass"],[1,"js-side-nav-container","side-nav__container"],[1,"side-nav__content","nav","flex-column"],[1,"d-none","d-md-block","search-bar"],[1,"form-group"],[1,"input-group"],["role","form",3,"ngSubmit"],["type","text","id","search","placeholder","Search for","name","search",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-addon"],[1,"glyph","glyph-magnifier"],[3,"ngClass"],["routerLink","/home"],[1,"glyph","glyph-home"],[1,"d-sm-none",3,"ngClass"],["routerLink","/letters"],[1,"glyph","glyph-characters"],["routerLink","/artists"],[1,"glyph","glyph-people"],["routerLink","/albums"],[1,"glyph","glyph-music-album"],["routerLink","/years"],[1,"glyph","glyph-calendar"],["routerLink","/playlists"],[1,"glyph","glyph-music-info"],["routerLink","/now-playing"],[1,"glyph","glyph-audio"],[3,"ngClass",4,"ngIf"],["routerLink","/settings"],[1,"glyph","glyph-settings"],[1,"d-none","d-lg-block","side-nav-xl"],[1,"nav-item",3,"ngClass"],["routerLink","/home","tooltip","Home","triggers","hover"],[1,"d-md-none","nav-item",3,"ngClass"],["routerLink","/letters","tooltip","Letters","triggers","hover"],["routerLink","/artists","tooltip","Artists","triggers","hover"],["routerLink","/albums","tooltip","Albums","triggers","hover"],["routerLink","/years","tooltip","Years","triggers","hover"],["routerLink","/playlists","tooltip","Playlists","triggers","hover"],["routerLink","/now-playing","tooltip","Now Playing","triggers","hover"],["class","nav-item",3,"ngClass",4,"ngIf"],["routerLink","/settings","tooltip","Settings","triggers","hover"],[1,"clickable","d-none","d-sm-inline",3,"click"],[1,"glyph","glyph-clear"],["routerLink","/scrobble-cache"],[1,"glyph","glyph-upload"],["routerLink","/scrobble-cache","triggers","hover",3,"tooltip"]],template:function(t,e){1&t&&(i.Nb(0,"div",0),i.Nb(1,"span",1),i.Vb("click",(function(){return e.toggleMenu()})),i.Nb(2,"button",2),i.Lb(3,"span",3),i.Mb(),i.Nb(4,"a",4),i.Yb(),i.Nb(5,"svg",5),i.Nb(6,"g"),i.Lb(7,"path",6),i.Lb(8,"path",7),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Xb(),i.Nb(9,"h1"),i.rc(10,w,6,2,"span",8),i.rc(11,C,2,1,"span",8),i.rc(12,L,2,0,"span",8),i.rc(13,P,2,1,"span",8),i.rc(14,A,2,0,"span",8),i.Mb(),i.Nb(15,"button",9),i.Vb("click",(function(){return e.toggleSearch()})),i.rc(16,M,1,0,"i",10),i.rc(17,x,1,0,"i",11),i.Mb(),i.Nb(18,"form",12,13),i.Vb("ngSubmit",(function(){return e.onSubmit()})),i.Nb(20,"input",14,15),i.Vb("ngModelChange",(function(t){return e.search.query=t})),i.Mb(),i.Mb(),i.Mb(),i.Nb(22,"aside",16),i.Nb(23,"nav",17),i.Nb(24,"ul",18),i.Nb(25,"li",19),i.Nb(26,"div",20),i.Nb(27,"div",21),i.Nb(28,"form",22,13),i.Vb("ngSubmit",(function(){return e.onSubmit()})),i.Nb(30,"input",23,15),i.Vb("ngModelChange",(function(t){return e.search.query=t})),i.Mb(),i.Nb(32,"button",24),i.Lb(33,"i",25),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Nb(34,"li",26),i.Nb(35,"a",27),i.Lb(36,"span",28),i.sc(37," Home"),i.Mb(),i.Mb(),i.Nb(38,"li",29),i.Nb(39,"a",30),i.Lb(40,"span",31),i.sc(41," Letters"),i.Mb(),i.Mb(),i.Nb(42,"li",26),i.Nb(43,"a",32),i.Lb(44,"span",33),i.sc(45," Artists"),i.Mb(),i.Mb(),i.Nb(46,"li",26),i.Nb(47,"a",34),i.Lb(48,"span",35),i.sc(49," Albums"),i.Mb(),i.Mb(),i.Nb(50,"li",26),i.Nb(51,"a",36),i.Lb(52,"span",37),i.sc(53," Years"),i.Mb(),i.Mb(),i.Nb(54,"li",26),i.Nb(55,"a",38),i.Lb(56,"span",39),i.sc(57," Playlists"),i.Mb(),i.Mb(),i.Nb(58,"li",26),i.Nb(59,"a",40),i.Lb(60,"span",41),i.sc(61," Now playing"),i.Mb(),i.Mb(),i.rc(62,T,4,4,"li",42),i.Nb(63,"li",26),i.Nb(64,"a",43),i.Lb(65,"span",44),i.sc(66," Settings"),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Nb(67,"aside",45),i.Nb(68,"ul",18),i.Nb(69,"li",46),i.Nb(70,"a",47),i.Lb(71,"span",28),i.Mb(),i.Mb(),i.Nb(72,"li",48),i.Nb(73,"a",49),i.Lb(74,"span",31),i.Mb(),i.Mb(),i.Nb(75,"li",46),i.Nb(76,"a",50),i.Lb(77,"span",33),i.Mb(),i.Mb(),i.Nb(78,"li",46),i.Nb(79,"a",51),i.Lb(80,"span",35),i.Mb(),i.Mb(),i.Nb(81,"li",46),i.Nb(82,"a",52),i.Lb(83,"span",37),i.Mb(),i.Mb(),i.Nb(84,"li",46),i.Nb(85,"a",53),i.Lb(86,"span",39),i.Mb(),i.Mb(),i.Nb(87,"li",46),i.Nb(88,"a",54),i.Lb(89,"span",41),i.Mb(),i.Mb(),i.rc(90,I,3,4,"li",55),i.Nb(91,"li",46),i.Nb(92,"a",56),i.Lb(93,"span",44),i.Mb(),i.Mb(),i.Mb(),i.Mb()),2&t&&(i.zb(10),i.fc("ngIf",e.path&&e.path.album),i.zb(1),i.fc("ngIf",e.path&&e.path.artist&&!e.path.album),i.zb(1),i.fc("ngIf",e.path&&!e.path.artist),i.zb(1),i.fc("ngIf",!e.path&&e.page),i.zb(1),i.fc("ngIf",!e.path&&!e.page),i.zb(2),i.fc("ngIf",!e.topSearchVisible),i.zb(1),i.fc("ngIf",e.topSearchVisible),i.zb(1),i.fc("ngClass",i.ic(29,_,e.topSearchVisible)),i.zb(2),i.fc("ngModel",e.search.query),i.zb(2),i.fc("ngClass",i.ic(31,O,e.menuVisible)),i.zb(8),i.fc("ngModel",e.search.query),i.zb(4),i.fc("ngClass",i.ic(33,N,"Home"===e.page)),i.zb(4),i.fc("ngClass",i.ic(35,N,"Letters"===e.page)),i.zb(4),i.fc("ngClass",i.ic(37,N,"Artists"===e.page)),i.zb(4),i.fc("ngClass",i.ic(39,N,"Albums"===e.page)),i.zb(4),i.fc("ngClass",i.ic(41,N,"Years"===e.page)),i.zb(4),i.fc("ngClass",i.ic(43,N,"Playlists"===e.page)),i.zb(4),i.fc("ngClass",i.ic(45,N,"Now playing"===e.page)),i.zb(4),i.fc("ngIf",e.manualScrobblingList.length>0),i.zb(1),i.fc("ngClass",i.ic(47,N,"Settings"===e.page)),i.zb(6),i.fc("ngClass",i.ic(49,N,"Home"===e.page)),i.zb(3),i.fc("ngClass",i.ic(51,N,"Letters"===e.page)),i.zb(3),i.fc("ngClass",i.ic(53,N,"Artists"===e.page)),i.zb(3),i.fc("ngClass",i.ic(55,N,"Albums"===e.page)),i.zb(3),i.fc("ngClass",i.ic(57,N,"Years"===e.page)),i.zb(3),i.fc("ngClass",i.ic(59,N,"Playlists"===e.page)),i.zb(3),i.fc("ngClass",i.ic(61,N,"Now playing"===e.page)),i.zb(3),i.fc("ngIf",e.manualScrobblingList.length>0),i.zb(1),i.fc("ngClass",i.ic(63,N,"Settings"===e.page)))},directives:[y.k,a.m,a.d,a.e,y.i,a.a,a.c,a.f,S.d,o.b],encapsulation:2}),t})();const j=function(t){return{active:t}};function R(t,e){if(1&t){const t=i.Ob();i.Nb(0,"li",2),i.Nb(1,"a",3),i.Vb("click",(function(){i.oc(t);const s=e.$implicit;return i.Zb().onSelect(s)})),i.sc(2),i.Mb(),i.Mb()}if(2&t){const t=e.$implicit;i.zb(1),i.fc("ngClass",i.ic(2,j,t.active)),i.zb(1),i.tc(t.letter)}}let D=(()=>{class t{constructor(t,e){this.coreService=t,this.router=e,this.activeLetter=null,this.core=this.coreService.getCore(),this.subscription=this.core.coreParsed$.subscribe(t=>{this.ngOnInit()})}ngOnInit(){this.letters=this.core.sortedLetters}onSelect(t){this.activeLetter&&(this.activeLetter.active=!1),this.activeLetter=t,this.router.navigate(["/letter",t.escapedLetter])}ngOnDestroy(){this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(i.Kb(p.a),i.Kb(S.c))},t.\u0275cmp=i.Eb({type:t,selectors:[["mdb-letters"]],decls:2,vars:1,consts:[[1,"nav","d-none","d-md-flex","nav-letters"],["class","nav-item align-self-stretch flex-grow-1 text-center",4,"ngFor","ngForOf"],[1,"nav-item","align-self-stretch","flex-grow-1","text-center"],[3,"ngClass","click"]],template:function(t,e){1&t&&(i.Nb(0,"ul",0),i.rc(1,R,3,4,"li",1),i.Mb()),2&t&&(i.zb(1),i.fc("ngForOf",e.letters))},directives:[y.j,y.i],encapsulation:2}),t})();s("hR/0");var V=s("KI15"),z=s("meIv"),B=s("Pbcf");const U=t=>(t.r=Math.floor(t.r),t.g=Math.floor(t.g),t.b=Math.floor(t.b),t.a=1,t),F=(t,e)=>z.a.isReadable(t,e)?U(new z.a(t).toRgb()):F("#000"===e?new z.a(t).lighten(3):new z.a(t).darken(3),e),q=t=>z.a.readability("#000",t)>z.a.readability("#fff",t)?"#000":"#fff";function W(t,e,s){if(window.runningInElectron&&!s)document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbuntaint",{detail:{url:t}}));else{const s=new Image;s.crossOrigin="Anonymous",s.addEventListener("load",t=>{const i=document.createElement("canvas"),r=i.getContext("2d");i.width=s.width,i.height=s.height,r.drawImage(s,0,0);const a=(new B.a).getColor(i).value;e(U({r:a[0],g:a[1],b:a[2]}))},!1),s.src=t}}function X(t,e){const s=F(t,e),i=F(t,e);return{rgba:t,textLight:s,textDark:i,lighten:U(new z.a(s).lighten().toRgb()),darken:U(new z.a(i).darken().toRgb()),letterColor:q(new z.a(t))}}function K(t){const e=document.createElement("style"),{rgba:s,darken:i,lighten:r,textLight:a,textDark:n,letterColor:o}=t;e.setAttribute("type","text/css"),e.id="custom-css-node",e.textContent=`\n      @charset "UTF-8";\n      :root {\n        --primary: rgba(${s.r}, ${s.g}, ${s.b}, 1);\n        --darken: rgba(${i.r}, ${i.g}, ${i.b}, 1);\n        --lighten: rgba(${r.r}, ${r.g}, ${r.b}, 1);\n        --text-light: rgba(${a.r}, ${a.g}, ${a.b}, 1);\n        --text-dark: rgba(${n.r}, ${n.g}, ${n.b}, 1);\n        --letter-color: ${o};\n      }`,Z(),document.querySelector("body").appendChild(e)}function Z(){document.querySelector("#custom-css-node")&&document.querySelector("#custom-css-node").remove()}function H(t,e){1&t&&i.Lb(0,"i",26)}function G(t,e){1&t&&i.Lb(0,"i",27)}const J=function(t){return{width:t}},Y=function(t,e){return{"glyph-volume":t,"glyph-mute":e}},Q=function(t){return{active:t}};function tt(t,e){if(1&t){const t=i.Ob();i.Nb(0,"div",1),i.Nb(1,"div",2),i.Nb(2,"div",3),i.Vb("click",(function(e){return i.oc(t),i.Zb().jump(e)})),i.Lb(3,"div",4),i.Mb(),i.Mb(),i.Nb(4,"div",5),i.Nb(5,"div",6),i.Nb(6,"div",7),i.Vb("click",(function(){return i.oc(t),i.Zb().navigateToNowPlaying()})),i.Nb(7,"album-art",8),i.Vb("art",(function(e){return i.oc(t),i.Zb().onChangeArt(e)})),i.Mb(),i.Mb(),i.Nb(8,"div",9),i.Nb(9,"h4"),i.sc(10),i.Mb(),i.Nb(11,"h5"),i.Nb(12,"a",10),i.Vb("click",(function(){return i.oc(t),i.Zb().navigateToArtist()})),i.sc(13),i.Mb(),i.Nb(14,"span",11),i.sc(15," \u2022 "),i.Nb(16,"a",10),i.Vb("click",(function(){return i.oc(t),i.Zb().navigateToAlbum()})),i.sc(17),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Nb(18,"div",12),i.Nb(19,"a",13),i.Vb("click",(function(){return i.oc(t),i.Zb().prev()})),i.Lb(20,"span",14),i.Mb(),i.Nb(21,"a",13),i.Vb("click",(function(){return i.oc(t),i.Zb().togglePlayPause()})),i.rc(22,H,1,0,"i",15),i.rc(23,G,1,0,"i",16),i.Mb(),i.Nb(24,"a",13),i.Vb("click",(function(){return i.oc(t),i.Zb().next()})),i.Lb(25,"span",17),i.Mb(),i.Nb(26,"a",18),i.Vb("click",(function(e){return i.oc(t),i.Zb().toggleVolumeWindow(e)})),i.Lb(27,"span",19),i.Mb(),i.Nb(28,"a",20),i.Vb("click",(function(){return i.oc(t),i.Zb().toggleLoved()})),i.Lb(29,"i",21),i.Mb(),i.Nb(30,"a",22),i.Vb("click",(function(){return i.oc(t),i.Zb().toggleShuffle()})),i.Lb(31,"i",23),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Nb(32,"div",24),i.Nb(33,"input",25),i.Vb("ngModelChange",(function(e){return i.oc(t),i.Zb().volume=e}))("input",(function(){return i.oc(t),i.Zb().setVolume()}))("change",(function(){return i.oc(t),i.Zb().setVolume()})),i.Mb(),i.Mb(),i.Mb()}if(2&t){const t=i.Zb();i.zb(3),i.fc("ngStyle",i.ic(13,J,t.track.position/t.track.duration*100+"%")),i.zb(4),i.fc("artist",t.track.trackArtist)("album",t.track.album.name),i.zb(3),i.tc(t.track.title),i.zb(3),i.tc(t.track.trackArtist),i.zb(4),i.tc(t.track.album.name),i.zb(5),i.fc("ngIf",t.isPlaying),i.zb(1),i.fc("ngIf",t.isPaused),i.zb(4),i.fc("ngClass",i.jc(15,Y,t.volume>0,0==t.volume)),i.zb(1),i.fc("ngClass",i.ic(18,Q,t.track.isLoved)),i.zb(2),i.fc("ngClass",i.ic(20,Q,t.isShuffled)),i.zb(2),i.fc("hidden",!t.showVolumeWindow),i.zb(1),i.fc("ngModel",t.volume)}}let et=(()=>{class t{constructor(t,e,s,i,r,a,n,o){this.pathService=t,this.playerService=e,this.router=s,this.lastFMService=i,this.coreService=r,this.animationService=a,this.colorService=n,this.configService=o,this.showPlayer=!1,this.usesDynamicAccentColor=this.booleanState("dynamic-accent-color"),this.isPlaying=!1,this.isPaused=!1,this.hasScrobbledCurrentTrack=!1,this.isCurrentPlaylistLoaded=!1,this.isShuffled=!1,this.forceRestart=!1,this.showVolumeWindow=!1,this.volume=100,this.isHostedApp="undefined"!=typeof Windows,this.analyserID=-1,this.canShowAnimation=!1,this.bgColor="#fff",this.subscription=this.playerService.playlistAnnounced$.subscribe(t=>{t?(this.playlist=t.playlist,this.trackIndex=t.startIndex,this.isPaused=t.isPaused,this.isPlaying=t.isPlaying,this.isShuffled=t.isShuffled,this.forceRestart=t.forceRestart,this.showPlayer=this.isPaused||this.isPlaying,this.setTrack(t.position)):(this.isPlaying=!1,this.showPlayer=!1,this.mediaObject.pause())}),this.subscription5=this.playerService.hideVolumeWindowAnnounced$.subscribe(()=>{this.showVolumeWindow=!1}),this.mediaObject=document.querySelector("audio"),this.mediaObject.crossOrigin="anonymous",this.mediaObject.canPlayType("audio/flac"),this.mediaObject.addEventListener("ended",()=>{this.next()}),this.mediaObject.addEventListener("timeupdate",()=>{this.updateTime()}),this.mediaObject.addEventListener("play",()=>{this.onplay()}),this.mediaObject.addEventListener("progress",()=>{this.onprogress()}),this.mediaObject.addEventListener("pause",()=>{this.onpause()}),this.mediaObject.addEventListener("ended",()=>{this.onstop()});const c=localStorage.getItem("dsm");if(c&&(this.url=c),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe(t=>{const e=localStorage.getItem("save-playlist-state");e&&"true"===e&&this.readCurrentPlaylist()}),this.subscription3=this.playerService.volumeAnnounced.subscribe(t=>{this.volume=t,this.mediaObject.volume=this.volume/100}),this.subscription4=t.pageAnnounced$.subscribe(t=>{"Now playing"===t.page?(this.showVolumeWindow=!1,this.canShowAnimation=this.booleanState("visualisation-state"),this.canShowAnimation&&(this.analyserID=window.requestAnimationFrame(this.draw.bind(this)))):this.canShowAnimation=!1}),this.isHostedApp&&(this.systemMediaControls=Windows.Media.SystemMediaTransportControls.getForCurrentView(),this.displayUpdater=this.systemMediaControls.displayUpdater,this.systemMediaControls.isEnabled=!0,this.systemMediaControls.isPlayEnabled=!0,this.systemMediaControls.isPauseEnabled=!0,this.systemMediaControls.isStopEnabled=!0,this.systemMediaControls.isNextEnabled=!0,this.systemMediaControls.isPreviousEnabled=!0,this.systemMediaControls.addEventListener("buttonpressed",t=>{const e=Windows.Media.SystemMediaTransportControlsButton;switch(t.button){case e.play:this.mediaObject.play();break;case e.pause:this.mediaObject.pause();break;case e.stop:this.playerService.stop();break;case e.next:this.next();break;case e.previous:this.prev();break;default:console.warn("key not mapped in application",t.button)}},!1),this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.closed),-1===navigator.userAgent.indexOf("Mobi")){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser();const t=this.audioCtx.createMediaElementSource(this.mediaObject),e=this.audioCtx.sampleRate;this.analyser.fftSize=this.calculateFft(e),this.hearableBars=this.getHearableBars(e,this.analyser.fftSize),t.connect(this.analyser),t.connect(this.audioCtx.destination),this.dataArray=new Uint8Array(this.hearableBars),this.analyser.getByteFrequencyData(this.dataArray)}this.subscription6=this.colorService.color$.subscribe(t=>{this.rgba=t}),this.subscription7=this.colorService.blob$.subscribe(()=>{const t=new Blob([window.externalBlob],{type:"image/png"}),e=URL.createObjectURL(t),s=new Image;s.src=e,W(s.src,t=>{const e=X(t,this.bgColor);this.colorService.setColor(e.rgba),e.rgba=e.textLight,K(e)},!0)}),this.subscription8=this.configService.mode$.subscribe(t=>{if(this.bgColor="light"===t?"#fff":"#000",this.usesDynamicAccentColor&&this.rgba){const t=X(this.rgba,this.bgColor);t.rgba=t.textLight,K(t)}})}draw(){setTimeout(()=>{this.analyserID=window.requestAnimationFrame(this.draw.bind(this)),this.canShowAnimation||window.cancelAnimationFrame(this.analyserID)},1e3/30);const t=document.querySelector("canvas"),e=t.offsetWidth,s=t.offsetHeight;if(e&&s){const i=t.getContext("2d");this.analyser.getByteFrequencyData(this.dataArray),t.width=e,t.height=s,i.clearRect(0,0,e,s);const r=this.rgba||{r:0,g:110,b:205,a:1},a=Math.floor(e/this.hearableBars*1.1);let n,o=0;const c=s/150*1.17;for(let t=0;t<this.hearableBars;t++)n=this.dataArray[t]*c,i.fillStyle=`rgba(${r.r},${r.g},${r.b},${this.dataArray[t]/255})`,i.fillRect(o,s-n/2,a,n/2),o+=a+1}}calculateFft(t){return 128*Math.floor(t/44100)}getHearableBars(t,e){const s=e/2;switch(t){case 48e3:return s-1;case 88200:return s/2;case 96e3:return s/2-2;case 176400:return s/4;case 192e3:return s/4-4;case 352800:return s/8;case 384e3:return s/8-8;case 705600:return s/16;case 768e3:return s/16-16;default:return s}}setTrack(t){if(this.track=this.playlist.tracks[this.trackIndex],!this.currentTrack||this.track&&this.currentTrack.id!==this.track.id||this.forceRestart){const t=localStorage.getItem("dsm");t&&(this.url=t);const e=localStorage.getItem("jwt");this.mediaObject.src=`${this.url}/listen?path=${encodeURIComponent(this.track.source.url)}&jwt=${e}`,this.currentTrack=this.track,this.hasScrobbledCurrentTrack=!1,this.animationService.requestAnimation("enter",document.querySelector(".player h4")),this.animationService.requestAnimation("enter",document.querySelector(".player h5"))}this.isPlaying?this.mediaObject.play():this.mediaObject.pause(),this.isCurrentPlaylistLoaded&&(this.mediaObject.currentTime=localStorage.getItem("current-time")||0,this.isCurrentPlaylistLoaded=!1),t&&(this.mediaObject.currentTime=t)}readCurrentPlaylist(){Object(v.c)("current-playlist").then(t=>{const e=t;if(e){const t=this.coreService.getCore(),s=[];e.ids.forEach(e=>{s.push(t.tracks[e])});const i=new V.a;i.tracks=s,i.name="Current Playlist",i.isContinues=e.isContinues||!1,i.type=e.type,this.isShuffled=e.isShuffled,this.isCurrentPlaylistLoaded=!0,this.playerService.doPlayPlaylist(i,e.current,!1,e.isShuffled)}})}ngOnDestroy(){this.subscription.unsubscribe(),this.subscription2.unsubscribe(),this.subscription3.unsubscribe(),this.subscription4.unsubscribe(),this.subscription5.unsubscribe(),this.subscription6.unsubscribe(),this.subscription7.unsubscribe(),this.subscription8.unsubscribe(),this.mediaObject.removeEventListener("ended"),this.mediaObject.removeEventListener("timeupdate"),this.mediaObject.removeEventListener("play"),this.showVolumeWindow=!1}navigateToArtist(){this.router.navigate(["/letter",this.track.album.artist.letter.escapedLetter,"artist",this.track.album.artist.sortName])}navigateToAlbum(){this.router.navigate(["/letter",this.track.album.artist.letter.escapedLetter,"artist",this.track.album.artist.sortName,"album",this.track.album.sortName])}navigateToNowPlaying(){this.router.navigate(["/now-playing"])}next(){this.trackIndex<this.playlist.tracks.length-1?(this.trackIndex++,this.playerService.next()):this.playlist.isContinues?(this.trackIndex=0,"random"===this.playlist.type||"radio"===this.playlist.type?this.playerService.nextPlaylist(this.playlist.type):this.playerService.nextAlbum(this.track.album)):this.playerService.stop()}prev(){this.trackIndex>0&&(this.trackIndex--,this.playerService.prev())}togglePlayPause(){this.playerService.togglePlayPause()}updateTime(){if(this.track.position=1e3*this.mediaObject.currentTime,!this.hasScrobbledCurrentTrack&&(this.track.position>=t.SCROBBLETIME||this.track.position/this.track.duration>=.5&&performance.now()>t.SCROBBLETIME)){this.hasScrobbledCurrentTrack=!0;try{this.lastFMService.scrobbleTrack(this.track).subscribe(()=>{})}catch(e){console.error(e)}}localStorage.setItem("current-time",this.mediaObject.currentTime.toString())}onplay(){try{this.lastFMService.announceNowPlaying(this.track).subscribe()}catch(e){}var t;document.title=`${this.track.title} \u2022 ${this.track.trackArtist}`,"mediaSession"in navigator&&Object(v.c)(`art-${this.track.trackArtist}-${this.track.album.name}`).then(t=>{t&&(navigator.mediaSession.metadata=new MediaMetadata({title:this.track.title,artist:this.track.trackArtist,album:this.track.album.name,artwork:[{src:t,sizes:"500x500",type:"image/png"}]})),navigator.mediaSession.setActionHandler("play",()=>{this.togglePlayPause()}),navigator.mediaSession.setActionHandler("pause",()=>{this.togglePlayPause()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{this.prev()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{this.next()})}),this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.playing,this.displayUpdater.type=Windows.Media.MediaPlaybackType.music,Object(v.c)(`art-${this.track.trackArtist}-${this.track.album.name}`).then(t=>{try{void 0!==this.displayUpdater&&(this.displayUpdater.musicProperties.albumArtist=this.track.trackArtist,this.displayUpdater.musicProperties.artist=this.track.trackArtist,this.displayUpdater.musicProperties.albumTitle=this.track.album.name,this.displayUpdater.musicProperties.title=this.track.title,t&&(this.displayUpdater.thumbnail=Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new Windows.Foundation.Uri(t))),this.displayUpdater.update())}catch(e){console.error("error occurred",e)}this.updateWinTile(t)})),document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbplaying",{detail:this.track})),this.audioCtx&&this.audioCtx.resume(),this.usesDynamicAccentColor=this.booleanState("dynamic-accent-color"),this.usesDynamicAccentColor&&(t=this.rgba)&&K(function(t){const e=F(t,"#fff"),s=F(t,"#000");return{rgba:t,textLight:e,textDark:s,lighten:U(new z.a(e).lighten().toRgb()),darken:U(new z.a(s).darken().toRgb()),letterColor:q(new z.a(t))}}(t))}onstop(){document.querySelector("mdb-player").dispatchEvent(new Event("external.mdbstopped")),document.title="JSMusicDB Next",this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.stopped),this.audioCtx&&this.audioCtx.suspend(),Z()}onpause(){document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbpaused",{detail:this.track})),document.title="JSMusicDB Next",this.isHostedApp&&(this.systemMediaControls.playbackStatus=Windows.Media.MediaPlaybackStatus.paused),this.audioCtx&&this.audioCtx.suspend(),Z()}onChangeArt(t){if(this.usesDynamicAccentColor){const{art:e}=t.detail;W(e,t=>{const e=X(t,this.bgColor);this.colorService.setColor(e.rgba),e.rgba=e.textLight,K(e)},!1)}else this.colorService.setColor({r:0,g:110,b:205,a:1}),Z()}toggleShuffle(){this.isShuffled=!this.isShuffled,this.playerService.shufflePlaylist(this.isShuffled)}toggleLoved(){this.track.isLoved=!this.track.isLoved,this.lastFMService.toggleLoved(this.track).subscribe()}toggleVolumeWindow(t){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.showVolumeWindow=!this.showVolumeWindow}onprogress(){const t=this.mediaObject.buffered;0!==t.length&&(this.track.buffered.start=1e3*t.start(0!==t.length?t.length-1:0),this.track.buffered.end=1e3*t.end(0!==t.length?t.length-1:0))}setVolume(){this.mediaObject.volume=this.volume/100,this.playerService.setVolume(this.volume)}jump(t){const e=(t.clientX||t.changedTouches[0].clientX)/document.querySelector(".player").clientWidth;this.playerService.setPosition(this.track.duration/1e3*e)}booleanState(t){const e=localStorage.getItem(t);return!(!e||"true"!==e)}updateWinTile(t){const e=Windows.UI.Notifications;e.TileUpdateManager.createTileUpdaterForApplication("App").clear();const s=e.TileUpdateManager.getTemplateContent(e.TileTemplateType.tileSquare150x150PeekImageAndText02);let i=s.getElementsByTagName("text")[0];i.innerText=this.track.title,i=s.getElementsByTagName("text")[1],i.innerText=this.track.trackArtist,t&&(s.getElementsByTagName("image")[0].attributes[1].value=t);const r=new Date,a=new Date(r.getTime()+Number(this.track.duration));let n=s.importNode(this.getTileContent(t,"tileSquare310x310ImageAndText02").getElementsByTagName("binding").item(0),!0);s.getElementsByTagName("visual").item(0).appendChild(n),n=s.importNode(this.getTileContent(t,"tileWide310x150PeekImage02").getElementsByTagName("binding").item(0),!0),s.getElementsByTagName("visual").item(0).appendChild(n),n=s.importNode(this.getTileContent(t,"tileSquare71x71Image").getElementsByTagName("binding").item(0),!0),s.getElementsByTagName("visual").item(0).appendChild(n);const o=new e.TileNotification(s);o.expirationTime=a,e.TileUpdateManager.createTileUpdaterForApplication("App").update(o)}getTileContent(t,e){const s=Windows.UI.Notifications,i=s.TileUpdateManager.getTemplateContent(s.TileTemplateType[e]);try{i.getElementsByTagName("text")[0].innerText=this.track.title}catch(r){console.error(r)}try{i.getElementsByTagName("text")[1].innerText=this.track.trackArtist}catch(r){console.error(r)}return t&&(i.getElementsByTagName("image")[0].attributes[1].value=t),i}}return t.SCROBBLETIME=24e4,t.\u0275fac=function(e){return new(e||t)(i.Kb(f.a),i.Kb(l.a),i.Kb(S.c),i.Kb(g.a),i.Kb(p.a),i.Kb(u.a),i.Kb(b.a),i.Kb(m.a))},t.\u0275cmp=i.Eb({type:t,selectors:[["mdb-player"]],decls:1,vars:1,consts:[["class","player",4,"ngIf"],[1,"player"],[1,"row"],[1,"progress",3,"click"],["role","progressbar",1,"progress-bar",3,"ngStyle"],[1,"container-fluid"],[1,"row","row-sm"],[1,"col-xs-4","col-player-art",3,"click"],[3,"artist","album","art"],[1,"col-xs-11","col-player-special"],[3,"click"],[1,"hidden-xs","color-type-secondary"],[1,"col-xs-9","text-right","col-player-controls"],[1,"btn","btn-link",3,"click"],[1,"glyph","glyph-previous"],["class","glyph glyph-pause",4,"ngIf"],["class","glyph glyph-play",4,"ngIf"],[1,"glyph","glyph-next"],[1,"btn","btn-link","d-none","d-md-inline-block",3,"click"],[1,"glyph",3,"ngClass"],[1,"btn","btn-link","d-none","d-md-inline-block","btn-love",3,"ngClass","click"],[1,"glyph","glyph-star-outline"],[1,"btn","btn-link","d-none","d-md-inline-block","btn-shuffle",3,"ngClass","click"],[1,"glyph","glyph-shuffle"],[1,"volume-control",3,"hidden"],["type","range","min","0","max","100",3,"ngModel","ngModelChange","input","change"],[1,"glyph","glyph-pause"],[1,"glyph","glyph-play"]],template:function(t,e){1&t&&i.rc(0,tt,34,22,"div",0),2&t&&i.fc("ngIf",e.showPlayer)},directives:[y.k,y.l,y.i,a.i,a.a,a.c,a.f],encapsulation:2}),t})();function st(t,e){if(1&t&&(i.Nb(0,"div"),i.sc(1),i.Mb()),2&t){const t=i.Zb(2);i.zb(1),i.uc(" progress: ",t.scanperc,"% ")}}function it(t,e){if(1&t&&(i.Nb(0,"div",6),i.Nb(1,"div",7),i.Nb(2,"div",8),i.Nb(3,"div",9),i.sc(4," Collection is being reloaded, please wait. "),i.rc(5,st,2,1,"div",10),i.Nb(6,"div",11),i.Lb(7,"div",12),i.Lb(8,"div",12),i.Lb(9,"div",12),i.Lb(10,"div",12),i.Lb(11,"div",12),i.Mb(),i.Mb(),i.Mb(),i.Mb(),i.Mb()),2&t){const t=i.Zb();i.zb(5),i.fc("ngIf",t.scanperc)}}const rt=function(t){return{isPlaying:t}};let at=(()=>{class t{constructor(t,e,s,i,r,a,n){this.collectionService=t,this.coreService=e,this.loginService=s,this.configService=i,this.playerService=r,this.colorService=a,this.isPlaying=!1,this.scanperc=0,this.isReloading=!1,this.letter="N",this.path="JSMusicDB Next",this.isLoading=!1,this.hasBeenReloading=!1,this.isHostedApp="undefined"!=typeof Windows,this.loginService.hasToken&&(this.isLoading=!0,this.poll()),this.viewContainerRef=n,this.subscription=this.playerService.playlistAnnounced$.subscribe(t=>{this.isPlaying=!!t}),this.booleanState("tracking-state")?navigator.geolocation.getCurrentPosition(t=>{this.configService.getSunriseInfo(t.coords.latitude,t.coords.longitude).subscribe(t=>{this.configService.startDate=new Date(t.results.sunset),this.configService.stopDate=new Date(t.results.sunrise),this.configService.stopDate.setDate(this.configService.stopDate.getDate()+1),this.configService.geoSource.next(),this.configService.applyTheme()})},t=>{this.configService.startDate=new Date,this.configService.startDate.setHours(21,0,0),this.configService.stopDate=new Date,this.configService.stopDate.setDate(this.configService.stopDate.getDate()+1),this.configService.stopDate.setHours(7,0,0),this.configService.geoSource.next(),this.configService.applyTheme()}):(this.configService.startDate=new Date,this.configService.startDate.setHours(21,0,0),this.configService.stopDate=new Date,this.configService.stopDate.setDate(this.configService.stopDate.getDate()+1),this.configService.stopDate.setHours(7,0,0),this.configService.geoSource.next(),this.configService.applyTheme())}ngOnDestroy(){this.subscription.unsubscribe()}ngOnInit(){this.mediaObject=document.querySelector("audio");const t=this.mediaObject.canPlayType("audio/flac");this.isFlacSupported="probably"===t||"maybe"===t}getCollection(){this.collectionService.getCollection().subscribe(t=>this.fillCollection(t),t=>console.error(t))}fillCollection(t){localStorage.setItem("lastParsed",(new Date).getTime().toString()),this.coreService.getCore().parseSourceJson(t,this.isFlacSupported),this.isLoading=!1}hideVolumeWindow(){this.playerService.hideVolumeControl()}poll(){this.collectionService.poll().subscribe(t=>{this.scanperc=t.progress,"ready"!==t.status?(this.isReloading=!0,document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbscanning",{detail:{percentage:this.scanperc}})),setTimeout(t=>{this.poll()},5e3),this.hasBeenReloading=!0):(this.isReloading=!1,this.hasBeenReloading&&document.querySelector("mdb-player").dispatchEvent(new CustomEvent("external.mdbscanstop")),this.getCollection())})}onExternalPrev(t){this.playerService.prev()}onExternalNext(t){this.playerService.next()}onExternalToggle(t){this.playerService.togglePlayPause()}onExternalStop(t){this.playerService.stop()}onExternalBlob(){this.colorService.setBlob()}booleanState(t){const e=localStorage.getItem(t);return!(!e||"true"!==e)}}return t.\u0275fac=function(e){return new(e||t)(i.Kb(d.a),i.Kb(p.a),i.Kb(c.a),i.Kb(m.a),i.Kb(l.a),i.Kb(b.a),i.Kb(i.N))},t.\u0275cmp=i.Eb({type:t,selectors:[["mdb-root"]],features:[i.yb([d.a,p.a,f.a,l.a,g.a,u.a,m.a,h.a,b.a])],decls:10,vars:7,consts:[["id","reloading",4,"ngIf"],[3,"ngClass","click"],[1,"fixed-top",2,"z-index","1029",3,"click"],[1,"main-content",3,"ngClass","click"],[2,"display","none"],[3,"mdbprev","mdbnext","mdbtoggle","mdbstop","click","mdbblob"],["id","reloading"],[1,"container"],[1,"row"],[1,"col"],[4,"ngIf"],[1,"progress-bar"],[1,"progress-circle"]],template:function(t,e){1&t&&(i.rc(0,it,12,1,"div",0),i.Nb(1,"div",1),i.Vb("click",(function(){return e.hideVolumeWindow})),i.Lb(2,"mdb-topmenu"),i.Mb(),i.Nb(3,"div",2),i.Vb("click",(function(){return e.hideVolumeWindow})),i.Lb(4,"mdb-letters"),i.Mb(),i.Nb(5,"div",3),i.Vb("click",(function(){return e.hideVolumeWindow})),i.Lb(6,"router-outlet"),i.Mb(),i.Lb(7,"audio",4),i.Lb(8,"canvas"),i.Nb(9,"mdb-player",5),i.Vb("mdbprev",(function(t){return e.onExternalPrev(t)}))("mdbnext",(function(t){return e.onExternalNext(t)}))("mdbtoggle",(function(t){return e.onExternalToggle(t)}))("mdbstop",(function(t){return e.onExternalStop(t)}))("click",(function(){return e.hideVolumeWindow()}))("mdbblob",(function(){return e.onExternalBlob()})),i.Mb()),2&t&&(i.fc("ngIf",e.isReloading),i.zb(1),i.fc("ngClass",i.ic(3,rt,e.isPlaying)),i.zb(4),i.fc("ngClass",i.ic(5,rt,e.isPlaying)))},directives:[y.k,y.i,$,D,S.f,et],encapsulation:2}),t})(),nt=(()=>{class t{constructor(t,e){this.loginService=t,this.router=e}canActivate(t,e){return new Promise(t=>{const s=e.url;window.scrollTo(0,0),t(this.checkLogin(s))})}checkLogin(t){return!!localStorage.getItem("jwt")||(this.router.navigate(["/login"]),!1)}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(c.a),i.Rb(S.c))},t.\u0275prov=i.Gb({token:t,factory:t.\u0275fac}),t})();const ot=[nt,c.a],ct=S.e.forRoot([{path:"login",loadChildren:()=>s.e(9).then(s.bind(null,"X3zk")).then(t=>t.LoginModule)},{path:"home",loadChildren:()=>Promise.all([s.e(0),s.e(6)]).then(s.bind(null,"ct+p")).then(t=>t.HomeModule),canActivate:[nt]},{path:"letters",loadChildren:()=>s.e(8).then(s.bind(null,"mCIM")).then(t=>t.LettersModule),canActivate:[nt]},{path:"artists",loadChildren:()=>Promise.all([s.e(0),s.e(5)]).then(s.bind(null,"3r4j")).then(t=>t.ArtistsModule),canActivate:[nt]},{path:"albums",loadChildren:()=>Promise.all([s.e(0),s.e(3)]).then(s.bind(null,"fX0g")).then(t=>t.AlbumsModule),canActivate:[nt]},{path:"years",loadChildren:()=>Promise.all([s.e(0),s.e(20)]).then(s.bind(null,"ZutQ")).then(t=>t.YearsModule),canActivate:[nt]},{path:"playlists",loadChildren:()=>Promise.all([s.e(0),s.e(12)]).then(s.bind(null,"kez3")).then(t=>t.PlaylistsModule),canActivate:[nt]},{path:"now-playing",loadChildren:()=>Promise.all([s.e(0),s.e(11)]).then(s.bind(null,"YxDV")).then(t=>t.NowPlayingModule),canActivate:[nt]},{path:"settings",loadChildren:()=>Promise.all([s.e(0),s.e(17)]).then(s.bind(null,"7wo0")).then(t=>t.SettingsModule),canActivate:[nt]},{path:"scrobble-cache",loadChildren:()=>s.e(15).then(s.bind(null,"BSpc")).then(t=>t.ScrobbleCacheModule),canActivate:[nt]},{path:"search/:query",loadChildren:()=>Promise.all([s.e(0),s.e(16)]).then(s.bind(null,"RmqX")).then(t=>t.SearchModule),canActivate:[nt]},{path:"letter/:letter",loadChildren:()=>Promise.all([s.e(0),s.e(7)]).then(s.bind(null,"pJo8")).then(t=>t.LetterDetailModule),canActivate:[nt]},{path:"letter/:letter/artist/:artist",loadChildren:()=>Promise.all([s.e(0),s.e(4)]).then(s.bind(null,"2+yB")).then(t=>t.ArtistDetailModule),canActivate:[nt]},{path:"letter/:letter/artist/:artist/album/:album",loadChildren:()=>Promise.all([s.e(0),s.e(2)]).then(s.bind(null,"jJnS")).then(t=>t.AlbumDetailModule),canActivate:[nt]},{path:"",loadChildren:()=>Promise.all([s.e(0),s.e(6)]).then(s.bind(null,"ct+p")).then(t=>t.HomeModule),canActivate:[nt]}],{preloadingStrategy:S.b});let lt=(()=>{class t{supports(t){let e=!1;return 0===t.indexOf("mdb")&&(e=!0),e}addEventListener(t,e,s){const i=this.manager.getZone(),r=t=>{i.run(()=>s(t))};return this.manager.getZone().runOutsideAngular(()=>{this.manager.addEventListener(t,"external."+e,r)})}addGlobalEventListener(t,e,s){const i=this.manager.getZone(),r=t=>i.run(()=>s(t));return this.manager.getZone().runOutsideAngular(()=>{this.manager.addGlobalEventListener(t,e,r)})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Gb({token:t,factory:t.\u0275fac}),t})();var ht=s("hDf6"),ut=s("R1ws");let dt=(()=>{class t{constructor(){"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(t=>{}).catch(t=>{console.error("Registration failed with "+t)})}}return t.\u0275mod=i.Ib({type:t,bootstrap:[at]}),t.\u0275inj=i.Hb({factory:function(e){return new(e||t)},providers:[ot,{provide:n.b,useClass:lt,multi:!0},{provide:i.u,useValue:"en-GB"}],imports:[[n.a,r.b,a.b,ct,o.c.forRoot(),ht.a,ut.a]]}),t})();Object(i.R)(),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),window.deferredPrompt=t}),n.c().bootstrapModule(dt).catch(t=>console.error(t))}},[[0,1,19]]]);