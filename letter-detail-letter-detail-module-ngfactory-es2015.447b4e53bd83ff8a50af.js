(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"0/mZ":function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s("ztCj"),a=(s("xOws"),function(t,e,s,i){return new(s||(s=Promise))(function(a,n){function r(t){try{o(i.next(t))}catch(e){n(e)}}function l(t){try{o(i.throw(t))}catch(e){n(e)}}function o(t){t.done?a(t.value):new s(function(e){e(t.value)}).then(r,l)}o((i=i.apply(t,e||[])).next())})});class n{constructor(t,e){this.backgroundArtService=e,this.NOIMAGE="global/images/no-cover.png",this.loading=!1,this.loaded=!1,this.error=!1,this.loadingClass="loading",this.loadedClass="loaded",this.errorClass="error",this.el=t.nativeElement,setTimeout(()=>{this.loadImage()},100)}loadImage(){if(!this.loaded&&!this.loading||this.hasClassName("always-replace")){this.loading=!0,this.addClassName(this.loadingClass);let t=`art-${this.media.name}`;this.media.artist&&!this.media.trackArtist?t=`art-${this.media.artist.name}-${this.media.name}`:this.media.trackArtist&&(t=`art-${this.media.trackArtist}-${this.media.album.name}`),Object(i.c)(t).then(t=>{t?this.setImage(t):this.backgroundArtService.getMediaArt(this.media).subscribe(t=>this.setImage(t),t=>{this.el.style.backgroundImage=`url(${this.NOIMAGE})`,this.error=!0,this.loading=!1,this.removeClassName(this.loadingClass),this.addClassName(this.errorClass)})})}}setImage(t){return a(this,void 0,void 0,function*(){let e=localStorage.getItem("dsm");if(e&&(e+="/data/image-proxy?url="),!this.loaded||this.hasClassName("always-replace")){if(t!==this.NOIMAGE&&""!==t&&t){this.el.style.backgroundImage=(t=yield this.backgroundArtService.returnImageUrlFromLastFMResponse(t))?`url(${t})`:`url(${this.NOIMAGE})`;const e={_id:`art-${this.media.name}`,url:t||this.NOIMAGE};this.media.artist&&(e._id=`art-${this.media.artist.name}-${this.media.name}`),Object(i.d)(e._id,e.url)}else this.backgroundArtService.getMediaArtFromLastFm(this.media).subscribe(t=>a(this,void 0,void 0,function*(){(t=yield this.backgroundArtService.returnImageUrlFromLastFMResponse(t))&&t!==this.NOIMAGE?this.el.style.backgroundImage=`url(${e}${encodeURIComponent(t)})`:(t||(t=this.NOIMAGE),this.el.style.backgroundImage=`url(${t})`);const s={_id:`art-${this.media.name}`,url:t||this.NOIMAGE};this.media.artist&&(s._id=`art-${this.media.artist.name}-${this.media.name}`),Object(i.d)(s._id,s.url)}),t=>this.el.style.backgroundImage=`url(${this.NOIMAGE})`);this.loading=!1,this.toggleLoaded(!0)}})}getPosition(){const t=this.el.getBoundingClientRect(),e=t.top+(window.pageYOffset-document.documentElement.clientTop);return{top:e,left:t.left+(window.pageXOffset-document.documentElement.clientLeft),bottom:e+this.el.clientHeight}}getLoadingContainer(){return this.el}hasClassName(t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(this.getLoadingContainer().className)}addClassName(t){if(!this.hasClassName(t)){const e=this.getLoadingContainer();e.className=e.className?[e.className,t].join(" "):t}}removeClassName(t){if(this.hasClassName(t)){const e=this.getLoadingContainer();e.className=e.className.replace(new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)","g"),"")}}toggleLoaded(t){this.loaded=t,t?(this.removeClassName(this.loadingClass),this.addClassName(this.loadedClass)):this.removeClassName(this.loadedClass)}}},g2JG:function(t,e,s){"use strict";s.r(e);var i=s("8Y7J");class a{}var n=s("pMnS"),r=s("BZiF"),l=s("EAnT"),o=s("iInd"),u=s("SVse"),c=s("ktVm"),h=s("XtVx");class d{constructor(t,e,s,i){this.coreService=t,this.router=e,this.pathService=s,this.route=i,this.artists=[],this.sorting=[{name:"name",value:"sortName"},{name:"albums",value:"albums"}],this.core=this.coreService.getCore(),this.subscription=this.core.coreParsed$.subscribe(t=>{this.ngOnInit()}),this.letter=decodeURIComponent(this.route.snapshot.params.letter),this.route.params.subscribe(t=>{this.letter=decodeURIComponent(t.letter),this.ngOnInit()})}ngOnInit(){this.coreletter=this.core.letters[this.letter],this.coreletter&&(this.pathService.announcePage("JSMusicDB Next",this.coreletter),this.artists=this.coreletter.sortAndReturnArtistsBy("sortName","asc"))}onSelect(t){this.router.navigate(["Artist",{letter:t.letter.escapedLetter,artist:t.sortName}])}ngOnDestroy(){this.subscription.unsubscribe()}onSortChange(t,e){this.artists=this.coreletter.sortAndReturnArtistsBy(e,"asc")}}var m=i.mb({encapsulation:2,styles:[],data:{}});function g(t){return i.Jb(0,[(t()(),i.ob(0,0,null,null,2,"div",[["class","artist-panel media-panel"]],null,null,null,null,null)),(t()(),i.ob(1,0,null,null,1,"mdb-artist",[],null,null,null,r.b,r.a)),i.nb(2,49152,null,0,l.a,[o.k],{artist:[0,"artist"]},null)],function(t,e){t(e,2,0,e.context.$implicit)},null)}function b(t){return i.Jb(0,[(t()(),i.ob(0,0,null,null,2,"div",[["class","media-container animated-page"]],null,null,null,null,null)),(t()(),i.eb(16777216,null,null,1,null,g)),i.nb(2,278528,null,0,u.j,[i.M,i.J,i.q],{ngForOf:[0,"ngForOf"]},null)],function(t,e){t(e,2,0,e.component.artists)},null)}function f(t){return i.Jb(0,[(t()(),i.ob(0,0,null,null,1,"app-letter-detail",[],null,null,null,b,m)),i.nb(1,245760,null,0,d,[c.a,o.k,h.a,o.a],null,null)],function(t,e){t(e,1,0)},null)}var p=i.kb("app-letter-detail",d,f,{},{},[]);class v{}var A=s("hDf6");s.d(e,"LetterDetailModuleNgFactory",function(){return I});var I=i.lb(a,[],function(t){return i.xb([i.yb(512,i.j,i.X,[[8,[n.a,p]],[3,i.j],i.v]),i.yb(4608,u.m,u.l,[i.s,[2,u.z]]),i.yb(1073742336,u.b,u.b,[]),i.yb(1073742336,o.m,o.m,[[2,o.r],[2,o.k]]),i.yb(1073742336,v,v,[]),i.yb(1073742336,A.a,A.a,[]),i.yb(1073742336,a,a,[]),i.yb(256,i.s,"en-GB",[]),i.yb(1024,o.i,function(){return[[{path:"",component:d}]]},[])])})},xOws:function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s("XWo6"),a=function(t,e,s,i){return new(s||(s=Promise))(function(a,n){function r(t){try{o(i.next(t))}catch(e){n(e)}}function l(t){try{o(i.throw(t))}catch(e){n(e)}}function o(t){t.done?a(t.value):new s(function(e){e(t.value)}).then(r,l)}o((i=i.apply(t,e||[])).next())})};class n{constructor(t){this.http=t,this.API_KEY="639fca5adcf955a19f9a04f8985e9ded",this.lastFMImageRetriever=new i.a(t)}getMediaArt(t){const e=this.extractInfo(t);return this.lastFMImageRetriever.getMediaArt(e.artist,e.album,e.type)}getMediaArtFromLastFm(t){const e=this.extractInfo(t);return this.lastFMImageRetriever.getMediaArt(e.artist,e.album,e.type)}returnImageUrlFromLastFMResponse(t){return a(this,void 0,void 0,function*(){if(t.album)return t.album.image[t.album.image.length-1]["#text"];if(t.artist){const e=t.artist.mbid;return e?this.getArtistURLArtFormFanart(e,t.artist):t.artist.image[t.artist.image.length-1]["#text"]}return t})}getArtistURLArtFormFanart(t,e){return a(this,void 0,void 0,function*(){const s=yield fetch(`https://webservice.fanart.tv/v3/music/${t}&?api_key=${this.API_KEY}&format=json`);if(200===s.status){const t=yield s.json();if(t.artistbackground)return t.artistbackground[0].url}return this.getArtistURLArtFromAudioDB(e)})}getArtistURLArtFromAudioDB(t){return a(this,void 0,void 0,function*(){const e=yield fetch(`https://www.theaudiodb.com/api/v1/json/1/search.php?s=${encodeURIComponent(t.name)}`);if(200===e.status){const t=yield e.json();if(t&&t.artists)return t.artists[0].strArtistFanart}return t.image[t.image.length-1]["#text"]})}extractInfo(t){let e="",s="",i="artist";return t.trackArtist&&t.album.artist.isCollection?e=t.trackArtist:t.artist?(e=t.artist.albumArtist||t.artist.name,s=t.name||t.album.name,i="album"):e=t.albumArtist||t.name,{artist:e,album:s,type:i}}}}}]);