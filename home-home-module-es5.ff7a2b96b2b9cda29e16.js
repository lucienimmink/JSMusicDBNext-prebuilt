(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"ct+p":function(e,t,n){"use strict";n.r(t);var i=n("Valr"),c=n("TYT/"),r=n("QJY3"),a=n("XlPw"),s=n("9Z1F"),o=n("cUzu"),l=function(){function e(e){this.http=e}return e.prototype.getRecentlyListened=function(e){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{user:e,method:"user.getrecenttracks",api_key:"956c1818ded606576d6941de5ff793a5",format:"json",limit:"6"}}).pipe(Object(s.a)(this.handleError))},e.prototype.handleError=function(e){var t=e.message?e.message:e.status?e.status+" - "+e.statusText:"Server error";return Object(a.a)(t)},e.ngInjectableDef=c.Nb({token:e,factory:function(t){return new(t||e)(c.Zb(o.a))},providedIn:null}),e}(),u=n("hDf6"),d=n("DUip"),b=n("ztCj"),m=n("uwnU"),g=n("ufXC"),p=n("MDLy"),f=n("OgP6"),h=n("ktVm"),y=n("t083"),v=n("XtVx"),T=function(){return function(){}}(),w=n("UrAU"),k=[1,"animated-page"],V=["class","container",4,"ngIf"],L=[1,"container"],I=[1,"row"],A=[1,"col"],S=["class","wrapper-home",4,"ngIf"],P=[1,"wrapper-home"],D=[1,"list-group","list-recently"],R=["class","list-group-item d-flex",3,"click",4,"ngFor","ngForOf"],C=[1,"list-group-item","d-flex",3,"click"],x=[1,"image-wrapper","col-3","col-md-2","col-lg-1"],J=["class","glyph glyph-play","aria-hidden","true",4,"ngIf"],M=["class","nowplaying-image",3,"src",4,"ngIf"],H=[1,"details-wrapper","col-6","col-md-7","col-lg-8"],j=[1,"small","muted"],E=[1,"time-wrapper","text-right","col-3"],O=[4,"ngIf"],F=[3,"ngClass",4,"ngIf"],N=["class","small muted",4,"ngIf"],$=["aria-hidden","true",1,"glyph","glyph-play"];function U(e,t){1&e&&c.Sb(0,"span",$)}var B=[1,"nowplaying-image",3,"src"];function z(e,t){if(1&e&&c.Sb(0,"img",B),2&e){var n=c.gc().$implicit;c.nc("src",n.image,c.zc)}}function Y(e,t){if(1&e&&(c.Vb(0,"span"),c.Jc(1),c.hc(2,"date"),c.Tb()),2&e){var n=c.gc(2).$implicit;c.Ac(1),c.Kc(c.jc(2,1,n.date,"mediumDate"))}}function X(e,t){if(1&e&&(c.Vb(0,"span"),c.Jc(1),c.hc(2,"date"),c.Vb(3,"span",j),c.Hc(4,Y,3,4,"span",O),c.Tb(),c.Tb()),2&e){var n=c.gc().$implicit;c.Ac(1),c.Lc(" ",c.jc(2,2,n.date,"shortTime")," "),c.Ac(4),c.mc("ngIf",!n.nowPlaying)}}var q=[3,"ngClass"],G=function(e){return{"now-playing":e}};function W(e,t){if(1&e&&(c.Vb(0,"span",q),c.Jc(1," Playing "),c.Tb()),2&e){var n=c.gc().$implicit;c.mc("ngClass",c.pc(1,G,n.nowPlaying))}}function Z(e,t){1&e&&(c.Vb(0,"span",j),c.Jc(1," right now "),c.Tb())}function K(e,t){if(1&e){var n=c.Wb();c.Vb(0,"li",C),c.bc("click",function(e){c.xc(n);var i=t.$implicit;return c.gc(3).playTrack(i)}),c.Vb(1,"div",x),c.Hc(2,U,1,0,"span",J),c.Hc(3,z,1,1,"img",M),c.Tb(),c.Vb(4,"div",H),c.Jc(5),c.Sb(6,"br"),c.Vb(7,"span",j),c.Jc(8),c.Tb(),c.Tb(),c.Vb(9,"div",E),c.Hc(10,X,5,5,"span",O),c.Hc(11,W,2,3,"span",F),c.Hc(12,Z,2,0,"span",N),c.Tb(),c.Tb()}if(2&e){var i=t.$implicit;c.Ac(2),c.mc("ngIf",!0===i.nowPlaying),c.Ac(3),c.mc("ngIf",!1===i.nowPlaying),c.Ac(5),c.Mc(" ",i.artist," \u2022 ",i.title," "),c.Ac(8),c.Lc("",i.album," "),c.Ac(10),c.mc("ngIf",!i.nowPlaying),c.Ac(11),c.mc("ngIf",i.nowPlaying),c.Ac(12),c.mc("ngIf",i.nowPlaying)}}function Q(e,t){if(1&e&&(c.Vb(0,"div",P),c.Vb(1,"h4"),c.Jc(2,"Recently listened"),c.Tb(),c.Vb(3,"ol",D),c.Hc(4,K,13,8,"li",R),c.Tb(),c.Tb()),2&e){var n=c.gc(2);c.Ac(4),c.mc("ngForOf",n.recentlyListenedTracks)}}var _=[1,"media-container","col","list-recently-added"],ee=["class","album-panel media-panel",4,"ngFor","ngForOf"],te=[1,"album-panel","media-panel"],ne=[3,"album"];function ie(e,t){if(1&e&&(c.Vb(0,"div",te),c.Sb(1,"mdb-album",ne),c.Tb()),2&e){var n=t.$implicit;c.Ac(1),c.mc("album",n)}}function ce(e,t){if(1&e&&(c.Vb(0,"div",P),c.Vb(1,"h4"),c.Jc(2,"Recently added / modified"),c.Tb(),c.Vb(3,"div",I),c.Vb(4,"div",_),c.Hc(5,ie,2,1,"div",ee),c.Tb(),c.Tb(),c.Tb()),2&e){var n=c.gc(2);c.Ac(5),c.mc("ngForOf",n.recentlyAdded)}}function re(e,t){if(1&e&&(c.Vb(0,"div",L),c.Vb(1,"div",I),c.Vb(2,"div",A),c.Hc(3,Q,5,1,"div",S),c.Hc(4,ce,6,1,"div",S),c.Tb(),c.Tb(),c.Tb()),2&e){var n=c.gc();c.Ac(3),c.mc("ngIf",n.recentlyListenedTracks.length>0),c.Ac(4),c.mc("ngIf",n.recentlyAdded.length>0)}}var ae=["role","form",1,"form-horizontal",3,"ngClass","ngSubmit"],se=["lastfmForm","ngForm"],oe=[1,"form-group","row"],le=["for","name",1,"col-12","col-sm-4","col-lg-2","col-form-label"],ue=[1,"col","col-sm-8","col-lg-10"],de=["type","text","id","name","placeholder","e.g. JohnDoe","required","","name","name",1,"form-control",3,"ngModel","ngModelChange"],be=["name","ngModel"],me=["for","password",1,"col-12","col-sm-4","col-lg-2","col-form-label"],ge=["type","password","id","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],pe=["password","ngModel"],fe=[1,"col","offset-md-4","offset-lg-2"],he=["type","submit",1,"btn","btn-primary",3,"disabled"],ye=["type","button",1,"btn","btn-link",3,"click"],ve=function(e){return{"theme-alt":e}};function Te(e,t){if(1&e){var n=c.Wb();c.Vb(0,"div",L),c.Vb(1,"div",I),c.Vb(2,"div",A),c.Vb(3,"h4"),c.Jc(4,"Login to last.fm"),c.Tb(),c.Sb(5,"br"),c.Vb(6,"form",ae,se),c.bc("ngSubmit",function(e){return c.xc(n),c.gc().onSubmit()}),c.Vb(8,"div",oe),c.Vb(9,"label",le),c.Jc(10,"Username"),c.Tb(),c.Vb(11,"div",ue),c.Vb(12,"input",de,be),c.bc("ngModelChange",function(e){return c.xc(n),c.gc().user.name=e}),c.Tb(),c.Tb(),c.Tb(),c.Vb(14,"div",oe),c.Vb(15,"label",me),c.Jc(16,"Password"),c.Tb(),c.Vb(17,"div",ue),c.Vb(18,"input",ge,pe),c.bc("ngModelChange",function(e){return c.xc(n),c.gc().user.password=e}),c.Tb(),c.Tb(),c.Tb(),c.Vb(20,"div",oe),c.Vb(21,"div",fe),c.Vb(22,"button",he),c.Jc(23," Login "),c.Tb(),c.Vb(24,"button",ye),c.bc("click",function(e){return c.xc(n),c.gc().skipLastfm()}),c.Jc(25," Skip "),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb()}if(2&e){var i=c.vc(7),r=c.gc();c.Ac(6),c.mc("ngClass",c.pc(4,ve,"dark"===r.theme)),c.Ac(12),c.mc("ngModel",r.user.name),c.Ac(18),c.mc("ngModel",r.user.password),c.Ac(22),c.mc("disabled",!i.form.valid)}}var we=[{path:"",component:function(){function e(e,t,n,i,c,r,a,s){var o=this;this.playerService=e,this.collectionService=t,this.coreService=n,this.router=i,this.recentlyListened=c,this.pathService=r,this.lastFMService=a,this.configService=s,this.recentlyListenedTracks=[],this.RECENTLYLISTENEDINTERVAL=6e4,this.newListenedTracks=[],this.loading=!0,this.recentlyAdded=[],this.user=new T,this.subscription=this.configService.mode$.subscribe(function(e){o.theme=e}),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe(function(e){o.init(!0)}),this.theme=s.mode,this.pathService.announcePage("Home"),localStorage.getItem("lastfm-username")&&(this.username=localStorage.getItem("lastfm-username")),this.init()}return e.prototype.onSubmit=function(){var e=this;this.lastFMService.authenticate({user:this.user.name,password:this.user.password}).subscribe(function(t){localStorage.setItem("lastfm-token",t.session.key),localStorage.setItem("lastfm-username",e.user.name),e.username=e.user.name,e.startPolling()})},e.prototype.init=function(e){var t=this;void 0===e&&(e=!1),(this.core.isCoreParsed||e)&&localStorage.getItem("lastfm-username")&&this.startPolling(),this.recentlyAdded=this.core.getLatestAdditions(14),Object(b.c)("cached-recently-listened").then(function(e){e&&t.populate(e),t.loading=!1})},e.prototype.ngOnDestroy=function(){clearInterval(this.counter),this.subscription.unsubscribe(),this.subscription2.unsubscribe()},e.prototype.startPolling=function(){var e=this;this.counter||(this.counter=setInterval(function(){e.checkRecentlyListened()},this.RECENTLYLISTENEDINTERVAL),this.checkRecentlyListened())},e.prototype.checkRecentlyListened=function(){var e=this;this.newListenedTracks=[],this.loading=!0,"mdb-skipped"!==this.username?this.recentlyListened.getRecentlyListened(this.username).subscribe(function(t){Object(b.d)("cached-recently-listened",t.recenttracks.track),e.populate(t.recenttracks.track)},function(e){return console.error(e)}):Object(b.c)("recentlyListened").then(function(t){t&&e.populate(t),e.loading=!1})},e.prototype.setDate=function(e){return e["@attr"]&&e["@attr"].nowplaying?new Date:new Date(1e3*Number(e.date.uts))},e.prototype.setImage=function(e){return e.image&&e.image[e.image.length-1]["#text"]||"/global/images/no-cover.png"},e.prototype.populate=function(e){var t=this;this.newListenedTracks=[],e.forEach(function(e){var n=new m.a({});n.artist=e.artist["#text"],n.album=e.album["#text"],n.title=e.name,n.image=t.setImage(e),n.nowPlaying=!(!e["@attr"]||!e["@attr"].nowplaying),n.date=t.setDate(e),n.trackArtist=e.artist["#text"],n.isPlaying=!1,n.isPaused=!1,n.isLoved=!1,n.id=e.artist["#text"]+"-"+e.album["#text"]+"-"+e.name,t.newListenedTracks.push(n)}),this.recentlyListenedTracks!==this.newListenedTracks&&(this.recentlyListenedTracks=this.newListenedTracks),this.loading=!1},e.prototype.skipLastfm=function(){localStorage.setItem("lastfm-username","mdb-skipped"),this.username="mdb-skipped",this.startPolling()},e.prototype.playTrack=function(e){var t=this,n=this.core.getArtistByName(e.artist);if(n){var i=this.core.getAlbumByArtistAndName(n,e.album);if(i){var c=this.core.getTrackByAlbumAndName(i,e.title);c?(this.playerService.doPlayTrack(c),setTimeout(function(){t.checkRecentlyListened()},500)):console.warn("track not found",e)}else console.warn("album not found",e)}else console.warn("artist not found",e)},e.ngComponentDef=c.Lb({type:e,selectors:[["app-home"]],factory:function(t){return new(t||e)(c.Rb(g.a),c.Rb(p.a),c.Rb(h.a),c.Rb(d.c),c.Rb(l),c.Rb(v.a),c.Rb(y.a),c.Rb(f.a))},consts:3,vars:2,template:function(e,t){1&e&&(c.Vb(0,"div",k),c.Hc(1,re,5,2,"div",V),c.Hc(2,Te,26,6,"div",V),c.Tb()),2&e&&(c.Ac(1),c.mc("ngIf",t.recentlyListenedTracks&&t.username),c.Ac(2),c.mc("ngIf",!t.username))},directives:[i.l,i.k,i.j,w.a,r.p,r.g,r.h,r.a,r.m,r.f,r.i],pipes:[i.e],encapsulation:2}),e}()}],ke=function(){function e(){}return e.ngModuleDef=c.Pb({type:e}),e.ngInjectorDef=c.Ob({factory:function(t){return new(t||e)},imports:[[d.e.forChild(we)],d.e]}),e.ngLocaleIdDef="en-GB",e}();d.e.forChild(we),n.d(t,"HomeModule",function(){return Ve});var Ve=function(){function e(){}return e.ngModuleDef=c.Pb({type:e}),e.ngInjectorDef=c.Ob({factory:function(t){return new(t||e)},providers:[l],imports:[[i.c,ke,u.a,r.b]]}),e.ngLocaleIdDef="en-GB",e}()}}]);