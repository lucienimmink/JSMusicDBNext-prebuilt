(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{L6id:function(l,n,u){"use strict";u.r(n);var t=u("8Y7J");class e{}var s=u("pMnS"),i=u("SVse"),a=u("Z8Ug"),r=u("UrAU"),o=u("iInd"),c=u("s7LF"),b=u("ztCj"),m=u("uwnU"),d=u("ufXC"),g=u("MDLy"),p=u("OgP6"),h=u("ktVm"),f=u("t083"),w=u("XtVx"),v=u("z6cu"),k=u("JIr8");class y{constructor(l){this.http=l}getRecentlyListened(l){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{user:l,method:"user.getrecenttracks",api_key:"956c1818ded606576d6941de5ff793a5",format:"json",limit:"6"}}).pipe(Object(k.a)(this.handleError))}handleError(l){const n=l.message?l.message:l.status?`${l.status} - ${l.statusText}`:"Server error";return Object(v.a)(n)}}class I{}class C{constructor(l,n,u,t,e,s,i,a){this.playerService=l,this.collectionService=n,this.coreService=u,this.router=t,this.recentlyListened=e,this.pathService=s,this.lastFMService=i,this.configService=a,this.recentlyListenedTracks=[],this.RECENTLYLISTENEDINTERVAL=6e4,this.newListenedTracks=[],this.loading=!0,this.recentlyAdded=[],this.user=new I,this.subscription=this.configService.mode$.subscribe(l=>{this.theme=l}),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe(l=>{this.init(!0)}),this.theme=a.mode,this.pathService.announcePage("Home"),localStorage.getItem("lastfm-username")&&(this.username=localStorage.getItem("lastfm-username")),this.init()}onSubmit(){this.lastFMService.authenticate({user:this.user.name,password:this.user.password}).subscribe(l=>{localStorage.setItem("lastfm-token",l.session.key),localStorage.setItem("lastfm-username",this.user.name),this.username=this.user.name,this.startPolling()})}init(l=!1){(this.core.isCoreParsed||l)&&localStorage.getItem("lastfm-username")&&this.startPolling(),this.recentlyAdded=this.core.getLatestAdditions(14),Object(b.b)("cached-recently-listened").then(l=>{l&&this.populate(l),this.loading=!1})}ngOnDestroy(){clearInterval(this.counter),this.subscription.unsubscribe(),this.subscription2.unsubscribe()}startPolling(){this.counter||(this.counter=setInterval(()=>{this.checkRecentlyListened()},this.RECENTLYLISTENEDINTERVAL),this.checkRecentlyListened())}checkRecentlyListened(){this.newListenedTracks=[],this.loading=!0,"mdb-skipped"!==this.username?this.recentlyListened.getRecentlyListened(this.username).subscribe(l=>{Object(b.c)("cached-recently-listened",l.recenttracks.track),this.populate(l.recenttracks.track)},l=>console.error(l)):Object(b.b)("recentlyListened").then(l=>{l&&this.populate(l),this.loading=!1})}setDate(l){return l["@attr"]&&l["@attr"].nowplaying?new Date:new Date(1e3*Number(l.date.uts))}setImage(l){return l.image&&l.image[l.image.length-1]["#text"]||"/global/images/no-cover.png"}populate(l){this.newListenedTracks=[],l.forEach(l=>{const n=new m.a({});n.artist=l.artist["#text"],n.album=l.album["#text"],n.title=l.name,n.image=this.setImage(l),n.nowPlaying=!(!l["@attr"]||!l["@attr"].nowplaying),n.date=this.setDate(l),n.trackArtist=l.artist["#text"],n.isPlaying=!1,n.isPaused=!1,n.isLoved=!1,n.id=`${l.artist["#text"]}-${l.album["#text"]}-${l.name}`,this.newListenedTracks.push(n)}),this.recentlyListenedTracks!==this.newListenedTracks&&(this.recentlyListenedTracks=this.newListenedTracks),this.loading=!1}skipLastfm(){localStorage.setItem("lastfm-username","mdb-skipped"),this.username="mdb-skipped",this.startPolling()}playTrack(l){const n=this.core.getArtistByName(l.artist);if(n){const u=this.core.getAlbumByArtistAndName(n,l.album);if(u){const n=this.core.getTrackByAlbumAndName(u,l.title);n?(this.playerService.doPlayTrack(n),setTimeout(()=>{this.checkRecentlyListened()},500)):console.warn("track not found",l)}else console.warn("album not found",l)}else console.warn("artist not found",l)}}var L=t.kb({encapsulation:2,styles:[],data:{}});function S(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,0,"span",[["aria-hidden","true"],["class","glyph glyph-play"]],null,null,null,null,null))],null,null)}function T(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,0,"img",[["class","nowplaying-image"]],[[8,"src",4]],null,null,null,null))],null,function(l,n){l(n,0,0,t.ob(1,"",n.parent.context.$implicit.image,""))})}function x(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,2,"span",[],null,null,null,null,null)),(l()(),t.Db(1,null,["",""])),t.zb(2,2)],null,function(l,n){var u=t.Eb(n,1,0,l(n,2,0,t.wb(n.parent.parent.parent.parent.parent,0),n.parent.parent.context.$implicit.date,"mediumDate"));l(n,1,0,u)})}function D(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,5,"span",[],null,null,null,null,null)),(l()(),t.Db(1,null,[" "," "])),t.zb(2,2),(l()(),t.mb(3,0,null,null,2,"span",[["class","small muted"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,x)),t.lb(5,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],function(l,n){l(n,5,0,!n.parent.context.$implicit.nowPlaying)},function(l,n){var u=t.Eb(n,1,0,l(n,2,0,t.wb(n.parent.parent.parent.parent,0),n.parent.context.$implicit.date,"shortTime"));l(n,1,0,u)})}function P(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,4,"span",[],null,null,null,null,null)),t.Ab(512,null,i.u,i.v,[t.q,t.r,t.k,t.B]),t.lb(2,278528,null,0,i.i,[i.u],{ngClass:[0,"ngClass"]},null),t.yb(3,{"now-playing":0}),(l()(),t.Db(-1,null,[" Playing "]))],function(l,n){var u=l(n,3,0,n.parent.context.$implicit.nowPlaying);l(n,2,0,u)},null)}function A(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,1,"span",[["class","small muted"]],null,null,null,null,null)),(l()(),t.Db(-1,null,[" right now "]))],null,null)}function F(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,17,"li",[["class","list-group-item d-flex"]],null,[[null,"click"]],function(l,n,u){var t=!0;return"click"===n&&(t=!1!==l.component.playTrack(l.context.$implicit)&&t),t},null,null)),(l()(),t.mb(1,0,null,null,4,"div",[["class","image-wrapper col-3 col-md-2 col-lg-1"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,S)),t.lb(3,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.cb(16777216,null,null,1,null,T)),t.lb(5,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.mb(6,0,null,null,4,"div",[["class","details-wrapper col-6 col-md-7 col-lg-8"]],null,null,null,null,null)),(l()(),t.Db(7,null,[" "," \u2022 "," "])),(l()(),t.mb(8,0,null,null,0,"br",[],null,null,null,null,null)),(l()(),t.mb(9,0,null,null,1,"span",[["class","small muted"]],null,null,null,null,null)),(l()(),t.Db(10,null,[""," "])),(l()(),t.mb(11,0,null,null,6,"div",[["class","time-wrapper text-right col-3"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,D)),t.lb(13,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.cb(16777216,null,null,1,null,P)),t.lb(15,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.cb(16777216,null,null,1,null,A)),t.lb(17,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],function(l,n){l(n,3,0,!0===n.context.$implicit.nowPlaying),l(n,5,0,!1===n.context.$implicit.nowPlaying),l(n,13,0,!n.context.$implicit.nowPlaying),l(n,15,0,n.context.$implicit.nowPlaying),l(n,17,0,n.context.$implicit.nowPlaying)},function(l,n){l(n,7,0,n.context.$implicit.artist,n.context.$implicit.title),l(n,10,0,n.context.$implicit.album)})}function M(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,5,"div",[["class","wrapper-home"]],null,null,null,null,null)),(l()(),t.mb(1,0,null,null,1,"h4",[],null,null,null,null,null)),(l()(),t.Db(-1,null,["Recently listened"])),(l()(),t.mb(3,0,null,null,2,"ol",[["class","list-group list-recently"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,F)),t.lb(5,278528,null,0,i.j,[t.M,t.J,t.q],{ngForOf:[0,"ngForOf"]},null)],function(l,n){l(n,5,0,n.component.recentlyListenedTracks)},null)}function $(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,2,"div",[["class","album-panel media-panel"]],null,null,null,null,null)),(l()(),t.mb(1,0,null,null,1,"mdb-album",[],null,null,null,a.b,a.a)),t.lb(2,49152,null,0,r.a,[o.k],{album:[0,"album"]},null)],function(l,n){l(n,2,0,n.context.$implicit)},null)}function E(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,6,"div",[["class","wrapper-home"]],null,null,null,null,null)),(l()(),t.mb(1,0,null,null,1,"h4",[],null,null,null,null,null)),(l()(),t.Db(-1,null,["Recently added / modified"])),(l()(),t.mb(3,0,null,null,3,"div",[["class","row"]],null,null,null,null,null)),(l()(),t.mb(4,0,null,null,2,"div",[["class","media-container col list-recently-added"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,$)),t.lb(6,278528,null,0,i.j,[t.M,t.J,t.q],{ngForOf:[0,"ngForOf"]},null)],function(l,n){l(n,6,0,n.component.recentlyAdded)},null)}function J(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,6,"div",[["class","container"]],null,null,null,null,null)),(l()(),t.mb(1,0,null,null,5,"div",[["class","row"]],null,null,null,null,null)),(l()(),t.mb(2,0,null,null,4,"div",[["class","col"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,M)),t.lb(4,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.cb(16777216,null,null,1,null,E)),t.lb(6,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],function(l,n){var u=n.component;l(n,4,0,u.recentlyListenedTracks.length>0),l(n,6,0,u.recentlyAdded.length>0)},null)}function q(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,43,"div",[["class","container"]],null,null,null,null,null)),(l()(),t.mb(1,0,null,null,42,"div",[["class","row"]],null,null,null,null,null)),(l()(),t.mb(2,0,null,null,41,"div",[["class","col"]],null,null,null,null,null)),(l()(),t.mb(3,0,null,null,1,"h4",[],null,null,null,null,null)),(l()(),t.Db(-1,null,["Login to last.fm"])),(l()(),t.mb(5,0,null,null,0,"br",[],null,null,null,null,null)),(l()(),t.mb(6,0,null,null,37,"form",[["class","form-horizontal"],["novalidate",""],["role","form"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(l,n,u){var e=!0,s=l.component;return"submit"===n&&(e=!1!==t.wb(l,11).onSubmit(u)&&e),"reset"===n&&(e=!1!==t.wb(l,11).onReset()&&e),"ngSubmit"===n&&(e=!1!==s.onSubmit()&&e),e},null,null)),t.Ab(512,null,i.u,i.v,[t.q,t.r,t.k,t.B]),t.lb(8,278528,null,0,i.i,[i.u],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.yb(9,{"theme-alt":0}),t.lb(10,16384,null,0,c.t,[],null,null),t.lb(11,4210688,[["lastfmForm",4]],0,c.j,[[8,null],[8,null]],null,{ngSubmit:"ngSubmit"}),t.Ab(2048,null,c.b,null,[c.j]),t.lb(13,16384,null,0,c.i,[[4,c.b]],null,null),(l()(),t.mb(14,0,null,null,11,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),t.mb(15,0,null,null,1,"label",[["class","col-12 col-sm-4 col-lg-2 col-form-label"],["for","name"]],null,null,null,null,null)),(l()(),t.Db(-1,null,["Username"])),(l()(),t.mb(17,0,null,null,8,"div",[["class","col col-sm-8 col-lg-10"]],null,null,null,null,null)),(l()(),t.mb(18,0,null,null,7,"input",[["class","form-control"],["id","name"],["name","name"],["placeholder","e.g. JohnDoe"],["required",""],["type","text"]],[[1,"required",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(l,n,u){var e=!0,s=l.component;return"input"===n&&(e=!1!==t.wb(l,19)._handleInput(u.target.value)&&e),"blur"===n&&(e=!1!==t.wb(l,19).onTouched()&&e),"compositionstart"===n&&(e=!1!==t.wb(l,19)._compositionStart()&&e),"compositionend"===n&&(e=!1!==t.wb(l,19)._compositionEnd(u.target.value)&&e),"ngModelChange"===n&&(e=!1!==(s.user.name=u)&&e),e},null,null)),t.lb(19,16384,null,0,c.c,[t.B,t.k,[2,c.a]],null,null),t.lb(20,16384,null,0,c.o,[],{required:[0,"required"]},null),t.Ab(1024,null,c.e,function(l){return[l]},[c.o]),t.Ab(1024,null,c.f,function(l){return[l]},[c.c]),t.lb(23,671744,[["name",4]],0,c.k,[[2,c.b],[6,c.e],[8,null],[6,c.f]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),t.Ab(2048,null,c.g,null,[c.k]),t.lb(25,16384,null,0,c.h,[[4,c.g]],null,null),(l()(),t.mb(26,0,null,null,11,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),t.mb(27,0,null,null,1,"label",[["class","col-12 col-sm-4 col-lg-2 col-form-label"],["for","password"]],null,null,null,null,null)),(l()(),t.Db(-1,null,["Password"])),(l()(),t.mb(29,0,null,null,8,"div",[["class","col col-sm-8 col-lg-10"]],null,null,null,null,null)),(l()(),t.mb(30,0,null,null,7,"input",[["class","form-control"],["id","password"],["name","password"],["placeholder","password"],["required",""],["type","password"]],[[1,"required",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(l,n,u){var e=!0,s=l.component;return"input"===n&&(e=!1!==t.wb(l,31)._handleInput(u.target.value)&&e),"blur"===n&&(e=!1!==t.wb(l,31).onTouched()&&e),"compositionstart"===n&&(e=!1!==t.wb(l,31)._compositionStart()&&e),"compositionend"===n&&(e=!1!==t.wb(l,31)._compositionEnd(u.target.value)&&e),"ngModelChange"===n&&(e=!1!==(s.user.password=u)&&e),e},null,null)),t.lb(31,16384,null,0,c.c,[t.B,t.k,[2,c.a]],null,null),t.lb(32,16384,null,0,c.o,[],{required:[0,"required"]},null),t.Ab(1024,null,c.e,function(l){return[l]},[c.o]),t.Ab(1024,null,c.f,function(l){return[l]},[c.c]),t.lb(35,671744,[["password",4]],0,c.k,[[2,c.b],[6,c.e],[8,null],[6,c.f]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),t.Ab(2048,null,c.g,null,[c.k]),t.lb(37,16384,null,0,c.h,[[4,c.g]],null,null),(l()(),t.mb(38,0,null,null,5,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),t.mb(39,0,null,null,4,"div",[["class","col offset-md-4 offset-lg-2"]],null,null,null,null,null)),(l()(),t.mb(40,0,null,null,1,"button",[["class","btn btn-primary"],["type","submit"]],[[8,"disabled",0]],null,null,null,null)),(l()(),t.Db(-1,null,[" Login "])),(l()(),t.mb(42,0,null,null,1,"button",[["class","btn btn-link"],["type","button"]],null,[[null,"click"]],function(l,n,u){var t=!0;return"click"===n&&(t=!1!==l.component.skipLastfm()&&t),t},null,null)),(l()(),t.Db(-1,null,[" Skip "]))],function(l,n){var u=n.component,t=l(n,9,0,"dark"===u.theme);l(n,8,0,"form-horizontal",t),l(n,20,0,""),l(n,23,0,"name",u.user.name),l(n,32,0,""),l(n,35,0,"password",u.user.password)},function(l,n){l(n,6,0,t.wb(n,13).ngClassUntouched,t.wb(n,13).ngClassTouched,t.wb(n,13).ngClassPristine,t.wb(n,13).ngClassDirty,t.wb(n,13).ngClassValid,t.wb(n,13).ngClassInvalid,t.wb(n,13).ngClassPending),l(n,18,0,t.wb(n,20).required?"":null,t.wb(n,25).ngClassUntouched,t.wb(n,25).ngClassTouched,t.wb(n,25).ngClassPristine,t.wb(n,25).ngClassDirty,t.wb(n,25).ngClassValid,t.wb(n,25).ngClassInvalid,t.wb(n,25).ngClassPending),l(n,30,0,t.wb(n,32).required?"":null,t.wb(n,37).ngClassUntouched,t.wb(n,37).ngClassTouched,t.wb(n,37).ngClassPristine,t.wb(n,37).ngClassDirty,t.wb(n,37).ngClassValid,t.wb(n,37).ngClassInvalid,t.wb(n,37).ngClassPending),l(n,40,0,!t.wb(n,11).form.valid)})}function j(l){return t.Fb(0,[t.xb(0,i.d,[t.s]),(l()(),t.mb(1,0,null,null,4,"div",[["class","animated-page"]],null,null,null,null,null)),(l()(),t.cb(16777216,null,null,1,null,J)),t.lb(3,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.cb(16777216,null,null,1,null,q)),t.lb(5,16384,null,0,i.k,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],function(l,n){var u=n.component;l(n,3,0,u.recentlyListenedTracks&&u.username),l(n,5,0,!u.username)},null)}function R(l){return t.Fb(0,[(l()(),t.mb(0,0,null,null,1,"app-home",[],null,null,null,j,L)),t.lb(1,180224,null,0,C,[d.a,g.a,h.a,o.k,y,w.a,f.a,p.a],null,null)],null,null)}var N=t.ib("app-home",C,R,{},{},[]),O=u("IheW");class B{}var U=u("hDf6");u.d(n,"HomeModuleNgFactory",function(){return V});var V=t.jb(e,[],function(l){return t.tb([t.ub(512,t.j,t.X,[[8,[s.a,N]],[3,t.j],t.v]),t.ub(4608,i.m,i.l,[t.s,[2,i.z]]),t.ub(4608,c.r,c.r,[]),t.ub(4608,y,y,[O.c]),t.ub(1073742336,i.b,i.b,[]),t.ub(1073742336,o.m,o.m,[[2,o.r],[2,o.k]]),t.ub(1073742336,B,B,[]),t.ub(1073742336,U.a,U.a,[]),t.ub(1073742336,c.q,c.q,[]),t.ub(1073742336,c.d,c.d,[]),t.ub(1073742336,e,e,[]),t.ub(256,t.s,"en-GB",[]),t.ub(1024,o.i,function(){return[[{path:"",component:C}]]},[])])})}}]);