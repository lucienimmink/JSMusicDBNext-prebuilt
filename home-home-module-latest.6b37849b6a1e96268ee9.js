function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"ct+p":function(e,t,n){"use strict";n.r(t);var i,c=n("ofXK"),a=n("fXoL"),r=n("3Pt+"),s=n("z6cu"),o=n("JIr8"),l=n("tk/3"),u=((i=function(){function e(t){_classCallCheck(this,e),this.http=t}return _createClass(e,[{key:"getRecentlyListened",value:function(e){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{user:e,method:"user.getrecenttracks",api_key:"956c1818ded606576d6941de5ff793a5",format:"json",limit:"6"}}).pipe(Object(o.a)(this.handleError))}},{key:"handleError",value:function(e){var t=e.message?e.message:e.status?"".concat(e.status," - ").concat(e.statusText):"Server error";return Object(s.a)(t)}}]),e}()).ngInjectableDef=a.Nb({token:i,factory:function(e){return new(e||i)(a.Zb(l.a))},providedIn:null}),i),d=n("hDf6"),b=n("tyNb"),m=n("ztCj"),f=n("uwnU"),g=n("ufXC"),h=n("MDLy"),p=n("OgP6"),v=n("ktVm"),y=n("t083"),k=n("XtVx"),T=function e(){_classCallCheck(this,e)},w=n("UrAU"),V=[1,"animated-page"],L=["class","container",4,"ngIf"],I=[1,"container"],A=[1,"row"],C=[1,"col"],S=["class","wrapper-home",4,"ngIf"],P=[1,"wrapper-home"],R=[1,"list-group","list-recently"],D=["class","list-group-item d-flex",3,"click",4,"ngFor","ngForOf"],x=[1,"list-group-item","d-flex",3,"click"],J=[1,"image-wrapper","col-3","col-md-2","col-lg-1"],M=["class","glyph glyph-play","aria-hidden","true",4,"ngIf"],j=["class","nowplaying-image",3,"src",4,"ngIf"],E=[1,"details-wrapper","col-6","col-md-7","col-lg-8"],H=[1,"small","muted"],O=[1,"time-wrapper","text-right","col-3"],_=[4,"ngIf"],N=[3,"ngClass",4,"ngIf"],F=["class","small muted",4,"ngIf"],$=["aria-hidden","true",1,"glyph","glyph-play"];function B(e,t){1&e&&a.Sb(0,"span",$)}var z=[1,"nowplaying-image",3,"src"];function U(e,t){if(1&e&&a.Sb(0,"img",z),2&e){var n=a.gc().$implicit;a.nc("src",n.image,a.zc)}}function X(e,t){if(1&e&&(a.Vb(0,"span"),a.Jc(1),a.hc(2,"date"),a.Tb()),2&e){var n=a.gc(2).$implicit;a.Ac(1),a.Kc(a.jc(2,1,n.date,"mediumDate"))}}function q(e,t){if(1&e&&(a.Vb(0,"span"),a.Jc(1),a.hc(2,"date"),a.Vb(3,"span",H),a.Hc(4,X,3,4,"span",_),a.Tb(),a.Tb()),2&e){var n=a.gc().$implicit;a.Ac(1),a.Lc(" ",a.jc(2,2,n.date,"shortTime")," "),a.Ac(4),a.mc("ngIf",!n.nowPlaying)}}var G=[3,"ngClass"],K=function(e){return{"now-playing":e}};function W(e,t){if(1&e&&(a.Vb(0,"span",G),a.Jc(1," Playing "),a.Tb()),2&e){var n=a.gc().$implicit;a.mc("ngClass",a.pc(1,K,n.nowPlaying))}}function Y(e,t){1&e&&(a.Vb(0,"span",H),a.Jc(1," right now "),a.Tb())}function Z(e,t){if(1&e){var n=a.Wb();a.Vb(0,"li",x),a.bc("click",(function(e){a.xc(n);var i=t.$implicit;return a.gc(3).playTrack(i)})),a.Vb(1,"div",J),a.Hc(2,B,1,0,"span",M),a.Hc(3,U,1,1,"img",j),a.Tb(),a.Vb(4,"div",E),a.Jc(5),a.Sb(6,"br"),a.Vb(7,"span",H),a.Jc(8),a.Tb(),a.Tb(),a.Vb(9,"div",O),a.Hc(10,q,5,5,"span",_),a.Hc(11,W,2,3,"span",N),a.Hc(12,Y,2,0,"span",F),a.Tb(),a.Tb()}if(2&e){var i=t.$implicit;a.Ac(2),a.mc("ngIf",!0===i.nowPlaying),a.Ac(3),a.mc("ngIf",!1===i.nowPlaying),a.Ac(5),a.Mc(" ",i.artist," \u2022 ",i.title," "),a.Ac(8),a.Lc("",i.album," "),a.Ac(10),a.mc("ngIf",!i.nowPlaying),a.Ac(11),a.mc("ngIf",i.nowPlaying),a.Ac(12),a.mc("ngIf",i.nowPlaying)}}function Q(e,t){if(1&e&&(a.Vb(0,"div",P),a.Vb(1,"h4"),a.Jc(2,"Recently listened"),a.Tb(),a.Vb(3,"ol",R),a.Hc(4,Z,13,8,"li",D),a.Tb(),a.Tb()),2&e){var n=a.gc(2);a.Ac(4),a.mc("ngForOf",n.recentlyListenedTracks)}}var ee=[1,"media-container","col","list-recently-added"],te=["class","album-panel media-panel",4,"ngFor","ngForOf"],ne=[1,"album-panel","media-panel"],ie=[3,"album"];function ce(e,t){if(1&e&&(a.Vb(0,"div",ne),a.Sb(1,"mdb-album",ie),a.Tb()),2&e){var n=t.$implicit;a.Ac(1),a.mc("album",n)}}function ae(e,t){if(1&e&&(a.Vb(0,"div",P),a.Vb(1,"h4"),a.Jc(2,"Recently added / modified"),a.Tb(),a.Vb(3,"div",A),a.Vb(4,"div",ee),a.Hc(5,ce,2,1,"div",te),a.Tb(),a.Tb(),a.Tb()),2&e){var n=a.gc(2);a.Ac(5),a.mc("ngForOf",n.recentlyAdded)}}function re(e,t){if(1&e&&(a.Vb(0,"div",I),a.Vb(1,"div",A),a.Vb(2,"div",C),a.Hc(3,Q,5,1,"div",S),a.Hc(4,ae,6,1,"div",S),a.Tb(),a.Tb(),a.Tb()),2&e){var n=a.gc();a.Ac(3),a.mc("ngIf",n.recentlyListenedTracks.length>0),a.Ac(4),a.mc("ngIf",n.recentlyAdded.length>0)}}var se=["role","form",1,"form-horizontal",3,"ngClass","ngSubmit"],oe=["lastfmForm","ngForm"],le=[1,"form-group","row"],ue=["for","name",1,"col-12","col-sm-4","col-lg-2","col-form-label"],de=[1,"col","col-sm-8","col-lg-10"],be=["type","text","id","name","placeholder","e.g. JohnDoe","required","","name","name",1,"form-control",3,"ngModel","ngModelChange"],me=["name","ngModel"],fe=["for","password",1,"col-12","col-sm-4","col-lg-2","col-form-label"],ge=["type","password","id","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],he=["password","ngModel"],pe=[1,"col","offset-md-4","offset-lg-2"],ve=["type","submit",1,"btn","btn-primary",3,"disabled"],ye=["type","button",1,"btn","btn-link",3,"click"],ke=function(e){return{"theme-alt":e}};function Te(e,t){if(1&e){var n=a.Wb();a.Vb(0,"div",I),a.Vb(1,"div",A),a.Vb(2,"div",C),a.Vb(3,"h4"),a.Jc(4,"Login to last.fm"),a.Tb(),a.Sb(5,"br"),a.Vb(6,"form",se,oe),a.bc("ngSubmit",(function(e){return a.xc(n),a.gc().onSubmit()})),a.Vb(8,"div",le),a.Vb(9,"label",ue),a.Jc(10,"Username"),a.Tb(),a.Vb(11,"div",de),a.Vb(12,"input",be,me),a.bc("ngModelChange",(function(e){return a.xc(n),a.gc().user.name=e})),a.Tb(),a.Tb(),a.Tb(),a.Vb(14,"div",le),a.Vb(15,"label",fe),a.Jc(16,"Password"),a.Tb(),a.Vb(17,"div",de),a.Vb(18,"input",ge,he),a.bc("ngModelChange",(function(e){return a.xc(n),a.gc().user.password=e})),a.Tb(),a.Tb(),a.Tb(),a.Vb(20,"div",le),a.Vb(21,"div",pe),a.Vb(22,"button",ve),a.Jc(23," Login "),a.Tb(),a.Vb(24,"button",ye),a.bc("click",(function(e){return a.xc(n),a.gc().skipLastfm()})),a.Jc(25," Skip "),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb()}if(2&e){var i=a.vc(7),c=a.gc();a.Ac(6),a.mc("ngClass",a.pc(4,ke,"dark"===c.theme)),a.Ac(12),a.mc("ngModel",c.user.name),a.Ac(18),a.mc("ngModel",c.user.password),a.Ac(22),a.mc("disabled",!i.form.valid)}}var we,Ve,Le=[{path:"",component:(we=function(){function e(t,n,i,c,a,r,s,o){var l=this;_classCallCheck(this,e),this.playerService=t,this.collectionService=n,this.coreService=i,this.router=c,this.recentlyListened=a,this.pathService=r,this.lastFMService=s,this.configService=o,this.recentlyListenedTracks=[],this.RECENTLYLISTENEDINTERVAL=6e4,this.newListenedTracks=[],this.loading=!0,this.recentlyAdded=[],this.user=new T,this.subscription=this.configService.mode$.subscribe((function(e){l.theme=e})),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe((function(e){l.init(!0)})),this.theme=o.mode,this.pathService.announcePage("Home"),localStorage.getItem("lastfm-username")&&(this.username=localStorage.getItem("lastfm-username")),this.init()}return _createClass(e,[{key:"onSubmit",value:function(){var e=this;this.lastFMService.authenticate({user:this.user.name,password:this.user.password}).subscribe((function(t){localStorage.setItem("lastfm-token",t.session.key),localStorage.setItem("lastfm-username",e.user.name),e.username=e.user.name,e.startPolling()}))}},{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.core.isCoreParsed||t)&&localStorage.getItem("lastfm-username")&&this.startPolling(),this.recentlyAdded=this.core.getLatestAdditions(14),Object(m.c)("cached-recently-listened").then((function(t){t&&e.populate(t),e.loading=!1}))}},{key:"ngOnDestroy",value:function(){clearInterval(this.counter),this.subscription.unsubscribe(),this.subscription2.unsubscribe()}},{key:"startPolling",value:function(){var e=this;this.counter||(this.counter=setInterval((function(){e.checkRecentlyListened()}),this.RECENTLYLISTENEDINTERVAL),this.checkRecentlyListened())}},{key:"checkRecentlyListened",value:function(){var e=this;this.newListenedTracks=[],this.loading=!0,"mdb-skipped"!==this.username?this.recentlyListened.getRecentlyListened(this.username).subscribe((function(t){Object(m.d)("cached-recently-listened",t.recenttracks.track),e.populate(t.recenttracks.track)}),(function(e){return console.error(e)})):Object(m.c)("recentlyListened").then((function(t){t&&e.populate(t),e.loading=!1}))}},{key:"setDate",value:function(e){return e["@attr"]&&e["@attr"].nowplaying?new Date:new Date(1e3*Number(e.date.uts))}},{key:"setImage",value:function(e){return e.image&&e.image[e.image.length-1]["#text"]||"/global/images/no-cover.png"}},{key:"populate",value:function(e){var t=this;this.newListenedTracks=[],e.forEach((function(e){var n=new f.a({});n.artist=e.artist["#text"],n.album=e.album["#text"],n.title=e.name,n.image=t.setImage(e),n.nowPlaying=!(!e["@attr"]||!e["@attr"].nowplaying),n.date=t.setDate(e),n.trackArtist=e.artist["#text"],n.isPlaying=!1,n.isPaused=!1,n.isLoved=!1,n.id="".concat(e.artist["#text"],"-").concat(e.album["#text"],"-").concat(e.name),t.newListenedTracks.push(n)})),this.recentlyListenedTracks!==this.newListenedTracks&&(this.recentlyListenedTracks=this.newListenedTracks),this.loading=!1}},{key:"skipLastfm",value:function(){localStorage.setItem("lastfm-username","mdb-skipped"),this.username="mdb-skipped",this.startPolling()}},{key:"playTrack",value:function(e){var t=this,n=this.core.getArtistByName(e.artist);if(n){var i=this.core.getAlbumByArtistAndName(n,e.album);if(i){var c=this.core.getTrackByAlbumAndName(i,e.title);c?(this.playerService.doPlayTrack(c),setTimeout((function(){t.checkRecentlyListened()}),500)):console.warn("track not found",e)}else console.warn("album not found",e)}else console.warn("artist not found",e)}}]),e}(),we.ngComponentDef=a.Lb({type:we,selectors:[["app-home"]],factory:function(e){return new(e||we)(a.Rb(g.a),a.Rb(h.a),a.Rb(v.a),a.Rb(b.c),a.Rb(u),a.Rb(k.a),a.Rb(y.a),a.Rb(p.a))},consts:3,vars:2,template:function(e,t){1&e&&(a.Vb(0,"div",V),a.Hc(1,re,5,2,"div",L),a.Hc(2,Te,26,6,"div",L),a.Tb()),2&e&&(a.Ac(1),a.mc("ngIf",t.recentlyListenedTracks&&t.username),a.Ac(2),a.mc("ngIf",!t.username))},directives:[c.l,c.k,c.j,w.a,r.p,r.g,r.h,r.a,r.m,r.f,r.i],pipes:[c.e],encapsulation:2}),we)}],Ie=((Ve=function e(){_classCallCheck(this,e)}).ngModuleDef=a.Pb({type:Ve}),Ve.ngInjectorDef=a.Ob({factory:function(e){return new(e||Ve)},imports:[[b.e.forChild(Le)],b.e]}),Ve.ngLocaleIdDef="en-GB",Ve);b.e.forChild(Le),n.d(t,"HomeModule",(function(){return Ce}));var Ae,Ce=((Ae=function e(){_classCallCheck(this,e)}).ngModuleDef=a.Pb({type:Ae}),Ae.ngInjectorDef=a.Ob({factory:function(e){return new(e||Ae)},providers:[u],imports:[[c.c,Ie,d.a,r.b]]}),Ae.ngLocaleIdDef="en-GB",Ae)}}]);