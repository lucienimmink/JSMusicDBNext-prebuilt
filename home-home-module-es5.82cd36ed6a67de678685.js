function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"ct+p":function(e,t,n){"use strict";n.r(t),n.d(t,"HomeModule",(function(){return $}));var i,a=n("ofXK"),c=n("3Pt+"),s=n("z6cu"),r=n("JIr8"),o=n("fXoL"),l=n("tk/3"),b=((i=function(){function e(t){_classCallCheck(this,e),this.http=t}return _createClass(e,[{key:"getRecentlyListened",value:function(e){return this.http.get("https://ws.audioscrobbler.com/2.0/",{params:{user:e,method:"user.getrecenttracks",api_key:"956c1818ded606576d6941de5ff793a5",format:"json",limit:"6"}}).pipe(Object(r.a)(this.handleError))}},{key:"handleError",value:function(e){var t=e.message?e.message:e.status?"".concat(e.status," - ").concat(e.statusText):"Server error";return Object(s.a)(t)}}]),e}()).\u0275fac=function(e){return new(e||i)(o.Pb(l.a))},i.\u0275prov=o.Eb({token:i,factory:i.\u0275fac}),i),u=n("hDf6"),d=n("tyNb"),f=n("ztCj"),m=n("uwnU"),p=n("ufXC"),g=n("MDLy"),h=n("OgP6"),v=n("ktVm"),y=n("t083"),L=n("XtVx"),k=function e(){_classCallCheck(this,e)},w=n("UrAU");function I(e,t){1&e&&o.Jb(0,"span",19)}function K(e,t){if(1&e&&o.Jb(0,"img",20),2&e){var n=o.Wb().$implicit;o.dc("src",n.image,o.mc)}}function x(e,t){if(1&e&&(o.Lb(0,"span"),o.pc(1),o.Xb(2,"date"),o.Kb()),2&e){var n=o.Wb(2).$implicit;o.xb(1),o.qc(o.Zb(2,1,n.date,"mediumDate"))}}function C(e,t){if(1&e&&(o.Lb(0,"span"),o.pc(1),o.Xb(2,"date"),o.Lb(3,"span",14),o.oc(4,x,3,4,"span",16),o.Kb(),o.Kb()),2&e){var n=o.Wb().$implicit;o.xb(1),o.rc(" ",o.Zb(2,2,n.date,"shortTime")," "),o.xb(3),o.cc("ngIf",!n.nowPlaying)}}var S=function(e){return{"now-playing":e}};function P(e,t){if(1&e&&(o.Lb(0,"span",21),o.pc(1," Playing "),o.Kb()),2&e){var n=o.Wb().$implicit;o.cc("ngClass",o.fc(1,S,n.nowPlaying))}}function T(e,t){1&e&&(o.Lb(0,"span",14),o.pc(1," right now "),o.Kb())}function M(e,t){if(1&e){var n=o.Mb();o.Lb(0,"li",9),o.Sb("click",(function(){o.lc(n);var e=t.$implicit;return o.Wb(3).playTrack(e)})),o.Lb(1,"div",10),o.oc(2,I,1,0,"span",11),o.oc(3,K,1,1,"img",12),o.Kb(),o.Lb(4,"div",13),o.pc(5),o.Jb(6,"br"),o.Lb(7,"span",14),o.pc(8),o.Kb(),o.Kb(),o.Lb(9,"div",15),o.oc(10,C,5,5,"span",16),o.oc(11,P,2,3,"span",17),o.oc(12,T,2,0,"span",18),o.Kb(),o.Kb()}if(2&e){var i=t.$implicit;o.xb(2),o.cc("ngIf",!0===i.nowPlaying),o.xb(1),o.cc("ngIf",!1===i.nowPlaying),o.xb(2),o.sc(" ",i.artist," \u2022 ",i.title," "),o.xb(3),o.rc("",i.album," "),o.xb(2),o.cc("ngIf",!i.nowPlaying),o.xb(1),o.cc("ngIf",i.nowPlaying),o.xb(1),o.cc("ngIf",i.nowPlaying)}}function A(e,t){if(1&e&&(o.Lb(0,"div",6),o.Lb(1,"h4"),o.pc(2,"Recently listened"),o.Kb(),o.Lb(3,"ol",7),o.oc(4,M,13,8,"li",8),o.Kb(),o.Kb()),2&e){var n=o.Wb(2);o.xb(4),o.cc("ngForOf",n.recentlyListenedTracks)}}function E(e,t){if(1&e&&(o.Lb(0,"div",24),o.Jb(1,"mdb-album",25),o.Kb()),2&e){var n=t.$implicit;o.xb(1),o.cc("album",n)}}function j(e,t){if(1&e&&(o.Lb(0,"div",6),o.Lb(1,"h4"),o.pc(2,"Recently added / modified"),o.Kb(),o.Lb(3,"div",3),o.Lb(4,"div",22),o.oc(5,E,2,1,"div",23),o.Kb(),o.Kb(),o.Kb()),2&e){var n=o.Wb(2);o.xb(5),o.cc("ngForOf",n.recentlyAdded)}}function W(e,t){if(1&e&&(o.Lb(0,"div",2),o.Lb(1,"div",3),o.Lb(2,"div",4),o.oc(3,A,5,1,"div",5),o.oc(4,j,6,1,"div",5),o.Kb(),o.Kb(),o.Kb()),2&e){var n=o.Wb();o.xb(3),o.cc("ngIf",n.recentlyListenedTracks.length>0),o.xb(1),o.cc("ngIf",n.recentlyAdded.length>0)}}var _=function(e){return{"theme-alt":e}};function F(e,t){if(1&e){var n=o.Mb();o.Lb(0,"div",2),o.Lb(1,"div",3),o.Lb(2,"div",4),o.Lb(3,"h4"),o.pc(4,"Login to last.fm"),o.Kb(),o.Jb(5,"br"),o.Lb(6,"form",26,27),o.Sb("ngSubmit",(function(){return o.lc(n),o.Wb().onSubmit()})),o.Lb(8,"div",28),o.Lb(9,"label",29),o.pc(10,"Username"),o.Kb(),o.Lb(11,"div",30),o.Lb(12,"input",31,32),o.Sb("ngModelChange",(function(e){return o.lc(n),o.Wb().user.name=e})),o.Kb(),o.Kb(),o.Kb(),o.Lb(14,"div",28),o.Lb(15,"label",33),o.pc(16,"Password"),o.Kb(),o.Lb(17,"div",30),o.Lb(18,"input",34,35),o.Sb("ngModelChange",(function(e){return o.lc(n),o.Wb().user.password=e})),o.Kb(),o.Kb(),o.Kb(),o.Lb(20,"div",28),o.Lb(21,"div",36),o.Lb(22,"button",37),o.pc(23," Login "),o.Kb(),o.Lb(24,"button",38),o.Sb("click",(function(){return o.lc(n),o.Wb().skipLastfm()})),o.pc(25," Skip "),o.Kb(),o.Kb(),o.Kb(),o.Kb(),o.Kb(),o.Kb(),o.Kb()}if(2&e){var i=o.jc(7),a=o.Wb();o.xb(6),o.cc("ngClass",o.fc(4,_,"dark"===a.theme)),o.xb(6),o.cc("ngModel",a.user.name),o.xb(6),o.cc("ngModel",a.user.password),o.xb(4),o.cc("disabled",!i.form.valid)}}var O,R,D,N=[{path:"",component:(O=function(){function e(t,n,i,a,c,s,r,o){var l=this;_classCallCheck(this,e),this.playerService=t,this.collectionService=n,this.coreService=i,this.router=a,this.recentlyListened=c,this.pathService=s,this.lastFMService=r,this.configService=o,this.recentlyListenedTracks=[],this.RECENTLYLISTENEDINTERVAL=6e4,this.newListenedTracks=[],this.loading=!0,this.recentlyAdded=[],this.user=new k,this.subscription=this.configService.mode$.subscribe((function(e){l.theme=e})),this.core=this.coreService.getCore(),this.subscription2=this.core.coreParsed$.subscribe((function(e){l.init(!0)})),this.theme=o.mode,this.pathService.announcePage("Home"),localStorage.getItem("lastfm-username")&&(this.username=localStorage.getItem("lastfm-username")),this.init()}return _createClass(e,[{key:"onSubmit",value:function(){var e=this;this.lastFMService.authenticate({user:this.user.name,password:this.user.password}).subscribe((function(t){localStorage.setItem("lastfm-token",t.session.key),localStorage.setItem("lastfm-username",e.user.name),e.username=e.user.name,e.startPolling()}))}},{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.core.isCoreParsed||t)&&localStorage.getItem("lastfm-username")&&this.startPolling(),this.recentlyAdded=this.core.getLatestAdditions(14),Object(f.c)("cached-recently-listened").then((function(t){t&&e.populate(t),e.loading=!1}))}},{key:"ngOnDestroy",value:function(){clearInterval(this.counter),this.subscription.unsubscribe(),this.subscription2.unsubscribe()}},{key:"startPolling",value:function(){var e=this;this.counter||(this.counter=setInterval((function(){e.checkRecentlyListened()}),this.RECENTLYLISTENEDINTERVAL),this.checkRecentlyListened())}},{key:"checkRecentlyListened",value:function(){var e=this;this.newListenedTracks=[],this.loading=!0,"mdb-skipped"!==this.username?this.recentlyListened.getRecentlyListened(this.username).subscribe((function(t){Object(f.d)("cached-recently-listened",t.recenttracks.track),e.populate(t.recenttracks.track)}),(function(e){return console.error(e)})):Object(f.c)("recentlyListened").then((function(t){t&&e.populate(t),e.loading=!1}))}},{key:"setDate",value:function(e){return e["@attr"]&&e["@attr"].nowplaying?new Date:new Date(1e3*Number(e.date.uts))}},{key:"setImage",value:function(e){return e.image&&e.image[e.image.length-1]["#text"]||"/global/images/no-cover.png"}},{key:"populate",value:function(e){var t=this;this.newListenedTracks=[],e.forEach((function(e){var n=new m.a({});n.artist=e.artist["#text"],n.album=e.album["#text"],n.title=e.name,n.image=t.setImage(e),n.nowPlaying=!(!e["@attr"]||!e["@attr"].nowplaying),n.date=t.setDate(e),n.trackArtist=e.artist["#text"],n.isPlaying=!1,n.isPaused=!1,n.isLoved=!1,n.id="".concat(e.artist["#text"],"-").concat(e.album["#text"],"-").concat(e.name),t.newListenedTracks.push(n)})),this.recentlyListenedTracks!==this.newListenedTracks&&(this.recentlyListenedTracks=this.newListenedTracks),this.loading=!1}},{key:"skipLastfm",value:function(){localStorage.setItem("lastfm-username","mdb-skipped"),this.username="mdb-skipped",this.startPolling()}},{key:"playTrack",value:function(e){var t=this,n=this.core.getArtistByName(e.artist);if(n){var i=this.core.getAlbumByArtistAndName(n,e.album);if(i){var a=this.core.getTrackByAlbumAndName(i,e.title);a?(this.playerService.doPlayTrack(a),setTimeout((function(){t.checkRecentlyListened()}),500)):console.warn("track not found",e)}else console.warn("album not found",e)}else console.warn("artist not found",e)}}]),e}(),O.\u0275fac=function(e){return new(e||O)(o.Ib(p.a),o.Ib(g.a),o.Ib(v.a),o.Ib(d.c),o.Ib(b),o.Ib(L.a),o.Ib(y.a),o.Ib(h.a))},O.\u0275cmp=o.Cb({type:O,selectors:[["app-home"]],decls:3,vars:2,consts:[[1,"animated-page"],["class","container",4,"ngIf"],[1,"container"],[1,"row"],[1,"col"],["class","wrapper-home",4,"ngIf"],[1,"wrapper-home"],[1,"list-group","list-recently"],["class","list-group-item d-flex",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex",3,"click"],[1,"image-wrapper","col-3","col-md-2","col-lg-1"],["class","glyph glyph-play","aria-hidden","true",4,"ngIf"],["class","nowplaying-image",3,"src",4,"ngIf"],[1,"details-wrapper","col-6","col-md-7","col-lg-8"],[1,"small","muted"],[1,"time-wrapper","text-right","col-3"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","small muted",4,"ngIf"],["aria-hidden","true",1,"glyph","glyph-play"],[1,"nowplaying-image",3,"src"],[3,"ngClass"],[1,"media-container","col","list-recently-added"],["class","album-panel media-panel",4,"ngFor","ngForOf"],[1,"album-panel","media-panel"],[3,"album"],["role","form",1,"form-horizontal",3,"ngClass","ngSubmit"],["lastfmForm","ngForm"],[1,"form-group","row"],["for","name",1,"col-12","col-sm-4","col-lg-2","col-form-label"],[1,"col","col-sm-8","col-lg-10"],["type","text","id","name","placeholder","e.g. JohnDoe","required","","name","name",1,"form-control",3,"ngModel","ngModelChange"],["name","ngModel"],["for","password",1,"col-12","col-sm-4","col-lg-2","col-form-label"],["type","password","id","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],["password","ngModel"],[1,"col","offset-md-4","offset-lg-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-link",3,"click"]],template:function(e,t){1&e&&(o.Lb(0,"div",0),o.oc(1,W,5,2,"div",1),o.oc(2,F,26,6,"div",1),o.Kb()),2&e&&(o.xb(1),o.cc("ngIf",t.recentlyListenedTracks&&t.username),o.xb(1),o.cc("ngIf",!t.username))},directives:[a.k,a.j,a.i,w.a,c.m,c.d,c.e,c.a,c.j,c.c,c.f],pipes:[a.d],encapsulation:2}),O)}],J=((D=function e(){_classCallCheck(this,e)}).\u0275mod=o.Gb({type:D}),D.\u0275inj=o.Fb({factory:function(e){return new(e||D)},imports:[[d.e.forChild(N)],d.e]}),D),$=((R=function e(){_classCallCheck(this,e)}).\u0275mod=o.Gb({type:R}),R.\u0275inj=o.Fb({factory:function(e){return new(e||R)},providers:[b],imports:[[a.b,J,u.a,c.b]]}),R)}}]);